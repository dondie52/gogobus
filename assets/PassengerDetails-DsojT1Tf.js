import{r as e,j as s,u as a,h as t,c as n,m as i,L as o,p as l,b as d}from"./index-CHY3DGCF.js";import{B as c}from"./Button-BPOJBceX.js";import{I as r}from"./Input-BvWcdI3q.js";import{s as h}from"./Booking.module-D7FNbwNS.js";const g="_passengerForm_18zwr_1",m="_passengerTitle_18zwr_9",u="_formFields_18zwr_17",p=({seatNumber:a,index:t,defaultData:n,onChange:i})=>{const[o,l]=e.useState({fullName:(null==n?void 0:n.full_name)||"",email:(null==n?void 0:n.email)||"",phone:(null==n?void 0:n.phone)||"",idNumber:""});e.useEffect(()=>{i(o)},[o]);const d=(e,s)=>{l(a=>({...a,[e]:s}))};return s.jsxs("div",{className:g,children:[s.jsxs("h3",{className:m,children:["Passenger ",t+1," - Seat ",a]}),s.jsxs("div",{className:u,children:[s.jsx(r,{label:"Full Name",value:o.fullName,onChange:e=>d("fullName",e.target.value),placeholder:"Enter full name",required:!0}),s.jsx(r,{type:"email",label:"Email",value:o.email,onChange:e=>d("email",e.target.value),placeholder:"Enter email",required:!0}),s.jsx(r,{type:"tel",label:"Phone Number",value:o.phone,onChange:e=>d("phone",e.target.value),placeholder:"+26771234567",required:!0}),s.jsx(r,{label:"ID Number (Optional)",value:o.idNumber,onChange:e=>d("idNumber",e.target.value),placeholder:"Enter ID number"})]})]})},f=()=>{const r=a(),g=t(),{user:m}=n(),{selectedRoute:u,selectedSeats:f,passengerDetails:b,setPassengerDetails:y}=i(),[j,S]=e.useState(null),[P,v]=e.useState(!0);e.useEffect(()=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:19",message:"PassengerDetails mounted",data:{selectedSeats:f,selectedSeatsLength:null==f?void 0:f.length,hasSelectedRoute:!!u},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(()=>{})},[f,u]),e.useEffect(()=>{(async()=>{if(null==m?void 0:m.id)try{const e=await l.getProfile(m.id);S(e)}catch(e){d("Failed to load profile",e)}v(!1)})()},[m]),e.useEffect(()=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:36",message:"PassengerDetails useEffect - selectedSeats check",data:{selectedSeats:f,selectedSeatsLength:null==f?void 0:f.length,hasSelectedSeats:!!f,willRedirect:!f||0===f.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(()=>{}),f&&0!==f.length||(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:40",message:"Redirecting - no selectedSeats",data:{selectedSeats:f,selectedSeatsLength:null==f?void 0:f.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(()=>{}),r("/home"))},[f,r]);return P?s.jsx("div",{className:h.loadingContainer,children:s.jsx(o,{size:"large"})}):s.jsxs("div",{className:h.bookingScreen,children:[s.jsxs("div",{className:h.bookingHeader,children:[s.jsx("button",{className:h.backButton,onClick:e=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:146",message:"Back button clicked",data:{currentPath:g.pathname,eventType:null==e?void 0:e.type,defaultPrevented:null==e?void 0:e.defaultPrevented},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});try{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:150",message:"Before navigate call",data:{targetPath:"/home",currentPath:g.pathname},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"B"})}).catch(()=>{}),r("/home"),fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:153",message:"After navigate call",data:{targetPath:"/home"},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"B"})}).catch(()=>{})}catch(s){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:156",message:"Error in navigate",data:{errorMessage:null==s?void 0:s.message,errorStack:null==s?void 0:s.stack},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"})}).catch(()=>{})}},children:"â† Back"}),s.jsx("h1",{children:"Passenger Details"})]}),s.jsxs("div",{className:h.bookingContent,children:[s.jsxs("p",{className:h.instruction,children:["Please provide details for ",f.length," passenger",1!==f.length?"s":""]}),f.map((e,a)=>s.jsx(p,{seatNumber:e,index:a,defaultData:j,onChange:e=>((e,s)=>{const a=[...b];a[e]={...a[e],...s},y(a)})(a,e)},e)),s.jsx("div",{className:h.bookingFooter,children:s.jsx(c,{onClick:()=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:61",message:"handleContinue called",data:{passengerDetailsLength:b.length,selectedSeatsLength:f.length,passengerDetails:b,selectedSeats:f},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{});let e=b;if(b.length!==f.length){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:67",message:"Initializing passenger details",data:{passengerDetailsLength:b.length,selectedSeatsLength:f.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{});const s=f.map((e,s)=>{const a=b[s]||{};return{seatNumber:e,fullName:a.fullName||(null==j?void 0:j.full_name)||"",email:a.email||(null==j?void 0:j.email)||(null==m?void 0:m.email)||"",phone:a.phone||(null==j?void 0:j.phone)||"",idNumber:a.idNumber||""}});y(s),e=s}if(e.length!==f.length)return void alert("Error: Passenger details count does not match selected seats. Please try again.");fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:84",message:"Before validation",data:{detailsToValidateLength:e.length,detailsToValidate:e},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{});const s=e.every(e=>e&&e.fullName&&e.fullName.trim()&&e.email&&e.email.trim()&&e.phone&&e.phone.trim());if(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:90",message:"Validation result",data:{allValid:s,detailsToValidate:e},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{}),!s){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:95",message:"Validation failed",data:{allValid:s,detailsToValidate:e},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{});const a=e.map((e,s)=>{const a=[];return e.fullName||a.push("Full Name"),e.email||a.push("Email"),e.phone||a.push("Phone"),a.length>0?`Passenger ${s+1}: ${a.join(", ")}`:null}).filter(Boolean);return void alert(`Please fill in all required passenger details.\n\nMissing fields:\n${a.join("\n")}`)}fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"PassengerDetails.jsx:101",message:"Navigating to booking summary",data:{navigationPath:"/booking/summary"},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{}),r("/booking/summary")},children:"Continue"})})]})]})};export{f as default};
