import{l as e,s as o,b as n,c as i}from"./index-Bt00Tcmk.js";const s={async sendBookingConfirmation(s){try{if(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Attempting to send booking confirmation email",data:{bookingId:s.bookingId,customerEmail:s.customerEmail,hasEmail:!!s.customerEmail},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),!s.customerEmail)return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"No customer email provided",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),e("Cannot send booking confirmation: no email provided"),{success:!1,error:"No email address provided"};let i,t;try{const e=await o.functions.invoke("send-booking-email",{body:{bookingId:s.bookingId,customerEmail:s.customerEmail,customerName:s.customerName||"Customer",origin:s.origin,destination:s.destination,departureTime:s.departureTime,seats:s.seats||[],totalAmount:s.totalAmount,bookingRef:s.bookingRef||s.bookingId}});i=e.data,t=e.error}catch(a){return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Edge function invoke exception (CORS/network)",data:{errorMessage:null==a?void 0:a.message,errorName:null==a?void 0:a.name},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),{success:!1,error:"Email service unavailable",warning:!0}}return t?(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Edge function error (may not exist)",data:{errorMessage:t.message,errorName:t.name},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),{success:!1,error:"Email service unavailable",warning:!0}):(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Email sent successfully",data:{bookingId:s.bookingId,customerEmail:s.customerEmail},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),n("Booking confirmation email sent",{bookingId:s.bookingId,email:s.customerEmail}),{success:!0,data:i})}catch(t){return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Email sending exception",data:{errorMessage:null==t?void 0:t.message,errorName:null==t?void 0:t.name},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),i("Error sending booking confirmation email",t),{success:!1,error:t.message,warning:!0}}}};export{s as e};
