const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CHY3DGCF.js","assets/index-FXjg0z6j.css"])))=>i.map(i=>d[i]);
import{R as e,j as s,u as t,k as a,i as n,c as i,m as o,r,_ as l}from"./index-CHY3DGCF.js";import{b as c}from"./bookingService-KwW7s8KF.js";import{B as d}from"./Button-BPOJBceX.js";import"./validation-DjNTQiWP.js";var h={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},u=e.createContext&&e.createContext(h),p=function(){return p=Object.assign||function(e){for(var s,t=1,a=arguments.length;t<a;t++)for(var n in s=arguments[t])Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);return e},p.apply(this,arguments)};function m(s){return s&&s.map(function(s,t){return e.createElement(s.tag,p({key:t},s.attr),m(s.child))})}function j(s){return function(t){return e.createElement(g,p({attr:p({},s.attr)},t),m(s.child))}}function g(s){var t=function(t){var a,n=s.attr,i=s.size,o=s.title,r=function(e,s){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(t[a[n]]=e[a[n]])}return t}(s,["attr","size","title"]),l=i||t.size||"1em";return t.className&&(a=t.className),s.className&&(a=(a?a+" ":"")+s.className),e.createElement("svg",p({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,r,{className:a,style:p(p({color:s.color||t.color},t.style),s.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&e.createElement("title",null,o),s.children)};return void 0!==u?e.createElement(u.Consumer,null,function(e){return t(e)}):t(h)}function _(e){return j({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"}}]})(e)}const x="_overlay_aw24v_1",f="_content_aw24v_15",b="_header_aw24v_25",v="_title_aw24v_33",y="_body_aw24v_41",S=({isOpen:e,onClose:t,children:a,title:n})=>e?s.jsx("div",{className:x,onClick:t,children:s.jsxs("div",{className:f,onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:b,children:[n&&s.jsx("h2",{className:v,children:n}),s.jsx(d,{variant:"ghost",size:"small",onClick:t,"aria-label":"Close modal",children:s.jsx(_,{})})]}),s.jsx("div",{className:y,children:a})]})}):null,N={page:"_page_jhu0l_6",header:"_header_jhu0l_14",backBtn:"_backBtn_jhu0l_26",headerContent:"_headerContent_jhu0l_43",loading:"_loading_jhu0l_57",error:"_error_jhu0l_58",spinner:"_spinner_jhu0l_63",spin:"_spin_jhu0l_63",content:"_content_jhu0l_100",tripInfo:"_tripInfo_jhu0l_108",tripRoute:"_tripRoute_jhu0l_115",routeOrigin:"_routeOrigin_jhu0l_123",routeDest:"_routeDest_jhu0l_124",routeArrow:"_routeArrow_jhu0l_130",tripMeta:"_tripMeta_jhu0l_135",legend:"_legend_jhu0l_157",legendItem:"_legendItem_jhu0l_164",legendSeat:"_legendSeat_jhu0l_172",available:"_available_jhu0l_178",selected:"_selected_jhu0l_183",unavailable:"_unavailable_jhu0l_188",busContainer:"_busContainer_jhu0l_195",busFront:"_busFront_jhu0l_203",driver:"_driver_jhu0l_212",door:"_door_jhu0l_224",seatMap:"_seatMap_jhu0l_234",seatRow:"_seatRow_jhu0l_240",rowNumber:"_rowNumber_jhu0l_246",rowSeats:"_rowSeats_jhu0l_254",seatGroup:"_seatGroup_jhu0l_262",aisle:"_aisle_jhu0l_267",seat:"_seat_jhu0l_234",busBack:"_busBack_jhu0l_318",summary:"_summary_jhu0l_332",selectedSeats:"_selectedSeats_jhu0l_338",summaryLabel:"_summaryLabel_jhu0l_342",seatTags:"_seatTags_jhu0l_350",seatTag:"_seatTag_jhu0l_350",noSeats:"_noSeats_jhu0l_384",priceBreakdown:"_priceBreakdown_jhu0l_392",priceRow:"_priceRow_jhu0l_397",total:"_total_jhu0l_406",bottomAction:"_bottomAction_jhu0l_417",actionInfo:"_actionInfo_jhu0l_431",actionSeats:"_actionSeats_jhu0l_437",actionPrice:"_actionPrice_jhu0l_442",continueBtn:"_continueBtn_jhu0l_448"},w=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"m12 19-7-7 7-7"}),s.jsx("path",{d:"M19 12H5"})]}),I=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("circle",{cx:"12",cy:"12",r:"2"}),s.jsx("path",{d:"M12 2v8"}),s.jsx("path",{d:"m4.93 10.93 6.36 2.54"}),s.jsx("path",{d:"m19.07 10.93-6.36 2.54"})]}),k=()=>s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M20 6 9 17l-5-5"})}),C=()=>s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M18 6 6 18M6 6l12 12"})}),T=()=>s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("polyline",{points:"12 6 12 12 16 14"})]}),O=()=>s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),s.jsx("circle",{cx:"12",cy:"10",r:"3"})]});function B(){var e,d;const h=t(),{tripId:u}=a(),[p]=n(),m=parseInt(p.get("passengers")||"1"),{isAuthenticated:j,isEmailVerified:g,user:_}=i(),{setSelectedSeats:x,setSelectedRoute:f}=o(),[b,v]=r.useState(null),[y,B]=r.useState([]),[P,D]=r.useState([]),[E,L]=r.useState(!0),[A,R]=r.useState(null),[M,J]=r.useState(!1);r.useEffect(()=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:70",message:"SeatSelection mounted",data:{tripId:u,passengersNeeded:m,isAuthenticated:j,isEmailVerified:g,userId:null==_?void 0:_.id},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{});u?(async()=>{L(!0),fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:73",message:"Fetching trip data",data:{tripId:u,hasTripId:!!u},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});try{const{data:e,error:s}=await c.getTripById(u);if(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:76",message:"Trip data received",data:{tripId:u,hasTripData:!!e,hasError:!!s,errorMessage:null==s?void 0:s.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),s)throw s;v(e),B((null==e?void 0:e.seats)||[])}catch(e){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:81",message:"Error fetching trip",data:{tripId:u,errorMessage:null==e?void 0:e.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});const{logError:s}=await l(async()=>{const{logError:e}=await import("./index-CHY3DGCF.js").then(e=>e.B);return{logError:e}},__vite__mapDeps([0,1]));s("Fetch error in SeatSelection",e),R(e.message||"Failed to load trip")}finally{L(!1)}})():fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:90",message:"No tripId provided",data:{tripId:u},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{})},[u]);const $=e=>{e.is_available&&D(s=>s.some(s=>s.id===e.id)?s.filter(s=>s.id!==e.id):s.length>=m?[...s.slice(1),e]:[...s,e])},F=(null==b?void 0:b.price)||0,W=F*P.length,z=Math.round(.05*W*100)/100,G=W+z,V=(()=>{if(!y.length)return[];const e={};return y.forEach(s=>{const t=s.seat_row;e[t]||(e[t]=[]),e[t].push(s)}),Object.keys(e).forEach(s=>{e[s].sort((e,s)=>e.seat_column.localeCompare(s.seat_column))}),Object.entries(e).sort(([e],[s])=>parseInt(e)-parseInt(s))})(),q=e=>e.is_available?P.some(s=>s.id===e.id)?"selected":"available":"unavailable";return E?s.jsx("div",{className:N.page,children:s.jsxs("div",{className:N.loading,children:[s.jsx("div",{className:N.spinner}),s.jsx("p",{children:"Loading seat map..."})]})}):A||!b?s.jsx("div",{className:N.page,children:s.jsxs("div",{className:N.error,children:[s.jsx("h2",{children:"Something went wrong"}),s.jsx("p",{children:A||"Trip not found"}),s.jsx("button",{onClick:()=>h(-1),children:"Go Back"})]})}):s.jsxs("div",{className:N.page,children:[s.jsxs("header",{className:N.header,children:[s.jsx("button",{className:N.backBtn,onClick:()=>h(-1),children:s.jsx(w,{})}),s.jsxs("div",{className:N.headerContent,children:[s.jsx("h1",{children:"Select Your Seats"}),s.jsxs("p",{children:["Choose ",m," ",1===m?"seat":"seats"]})]})]}),s.jsxs("div",{className:N.content,children:[s.jsxs("div",{className:N.tripInfo,children:[s.jsxs("div",{className:N.tripRoute,children:[s.jsx("span",{className:N.routeOrigin,children:null==(e=b.routes)?void 0:e.origin}),s.jsx("span",{className:N.routeArrow,children:"→"}),s.jsx("span",{className:N.routeDest,children:null==(d=b.routes)?void 0:d.destination})]}),s.jsxs("div",{className:N.tripMeta,children:[s.jsxs("span",{children:[s.jsx(T,{})," ",(H=b.departure_time,H?new Date(H).toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit"}):"N/A")]}),s.jsxs("span",{children:[s.jsx(O,{})," ",(e=>e?new Date(e).toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short"}):"N/A")(b.departure_time)]})]})]}),s.jsxs("div",{className:N.legend,children:[s.jsxs("div",{className:N.legendItem,children:[s.jsx("div",{className:`${N.legendSeat} ${N.available}`}),s.jsx("span",{children:"Available"})]}),s.jsxs("div",{className:N.legendItem,children:[s.jsx("div",{className:`${N.legendSeat} ${N.selected}`}),s.jsx("span",{children:"Selected"})]}),s.jsxs("div",{className:N.legendItem,children:[s.jsx("div",{className:`${N.legendSeat} ${N.unavailable}`}),s.jsx("span",{children:"Taken"})]})]}),s.jsxs("div",{className:N.busContainer,children:[s.jsxs("div",{className:N.busFront,children:[s.jsxs("div",{className:N.driver,children:[s.jsx(I,{}),s.jsx("span",{children:"Driver"})]}),s.jsx("div",{className:N.door,children:"Door"})]}),s.jsx("div",{className:N.seatMap,children:V.map(([e,t])=>s.jsxs("div",{className:N.seatRow,children:[s.jsx("div",{className:N.rowNumber,children:e}),s.jsxs("div",{className:N.rowSeats,children:[s.jsx("div",{className:N.seatGroup,children:t.filter(e=>["A","B"].includes(e.seat_column)).map(e=>s.jsx("button",{className:`${N.seat} ${N[q(e)]}`,onClick:()=>$(e),disabled:!e.is_available,children:"selected"===q(e)?s.jsx(k,{}):"unavailable"===q(e)?s.jsx(C,{}):s.jsx("span",{children:e.seat_number})},e.id))}),s.jsx("div",{className:N.aisle}),s.jsx("div",{className:N.seatGroup,children:t.filter(e=>["C","D"].includes(e.seat_column)).map(e=>s.jsx("button",{className:`${N.seat} ${N[q(e)]}`,onClick:()=>$(e),disabled:!e.is_available,children:"selected"===q(e)?s.jsx(k,{}):"unavailable"===q(e)?s.jsx(C,{}):s.jsx("span",{children:e.seat_number})},e.id))})]})]},e))}),s.jsx("div",{className:N.busBack,children:s.jsx("span",{children:"Back of Bus"})})]}),s.jsxs("div",{className:N.summary,children:[s.jsxs("div",{className:N.selectedSeats,children:[s.jsx("span",{className:N.summaryLabel,children:"Selected Seats:"}),s.jsx("div",{className:N.seatTags,children:P.length>0?P.map(e=>s.jsxs("span",{className:N.seatTag,children:[e.seat_number,s.jsx("button",{onClick:()=>$(e),children:s.jsx(C,{})})]},e.id)):s.jsx("span",{className:N.noSeats,children:"No seats selected"})})]}),P.length>0&&s.jsxs("div",{className:N.priceBreakdown,children:[s.jsxs("div",{className:N.priceRow,children:[s.jsxs("span",{children:["P",F," × ",P.length," ",1===P.length?"seat":"seats"]}),s.jsxs("span",{children:["P",W.toFixed(2)]})]}),s.jsxs("div",{className:N.priceRow,children:[s.jsx("span",{children:"Service fee"}),s.jsxs("span",{children:["P",z.toFixed(2)]})]}),s.jsxs("div",{className:`${N.priceRow} ${N.total}`,children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:["P",G.toFixed(2)]})]})]})]})]}),s.jsxs("div",{className:N.bottomAction,children:[s.jsxs("div",{className:N.actionInfo,children:[s.jsxs("span",{className:N.actionSeats,children:[P.length,"/",m," seats"]}),s.jsxs("span",{className:N.actionPrice,children:["P",G.toFixed(2)]})]}),s.jsx("button",{className:N.continueBtn,onClick:e=>{var s;fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:383",message:"Continue button clicked",data:{selectedSeatsLength:P.length,passengersNeeded:m,isDisabled:P.length<m,eventType:null==e?void 0:e.type,eventTarget:null==(s=null==e?void 0:e.target)?void 0:s.tagName},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{}),(()=>{var e,s;if(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:136",message:"handleContinue called",data:{selectedSeatsLength:P.length,passengersNeeded:m,isAuthenticated:j,isEmailVerified:g,tripId:u,selectedSeats:P.map(e=>({id:e.id,seat_number:e.seat_number}))},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),P.length<m)fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:139",message:"Early return: insufficient seats",data:{selectedSeatsLength:P.length,passengersNeeded:m},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});else{if(!j)return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:145",message:"Redirecting to login",data:{isAuthenticated:j},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"})}).catch(()=>{}),void h("/login",{state:{returnTo:`/booking/seats/${u}?passengers=${m}`}});if(!g)return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:151",message:"Showing email verification modal",data:{isEmailVerified:g},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"})}).catch(()=>{}),void J(!0);try{const t=P.map(e=>e.seat_number);fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:159",message:"Before setting context and navigation",data:{seatNumbers:t,tripId:u,hasTrip:!!b},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),x(t),b&&f({id:b.id,origin:null==(e=b.routes)?void 0:e.origin,destination:null==(s=b.routes)?void 0:s.destination,departure_time:b.departure_time,arrival_time:b.arrival_time,duration:b.duration,price:b.price}),fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:185",message:"Context set, navigating to passenger details",data:{seatNumbers:t,seatNumbersLength:t.length,hasTrip:!!b,navigationPath:"/booking/passenger-details"},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),setTimeout(()=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:189",message:"Executing navigation after context update",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),h("/booking/passenger-details")},0),fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:174",message:"After navigation call",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{})}catch(t){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SeatSelection.jsx:176",message:"Error in handleContinue",data:{errorMessage:null==t?void 0:t.message,errorStack:null==t?void 0:t.stack},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(()=>{})}}})()},disabled:P.length<m,children:"Continue"})]}),s.jsx(S,{isOpen:M,onClose:()=>J(!1),title:"Email Verification Required",children:s.jsxs("div",{style:{padding:"1rem"},children:[s.jsx("p",{children:"Please verify your email address before making a booking."}),s.jsxs("p",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#666"},children:["A verification email has been sent to ",null==_?void 0:_.email,". Please check your inbox and click the verification link."]}),s.jsxs("div",{style:{marginTop:"1.5rem",display:"flex",gap:"0.5rem"},children:[s.jsx("button",{onClick:()=>J(!1),style:{flex:1,padding:"0.75rem",border:"1px solid #ddd",borderRadius:"8px",background:"white",cursor:"pointer"},children:"Close"}),s.jsx("button",{onClick:()=>{J(!1),h("/profile")},style:{flex:1,padding:"0.75rem",border:"none",borderRadius:"8px",background:"#F5A623",color:"white",cursor:"pointer"},children:"Go to Profile"})]})]})})]});var H}export{B as default};
