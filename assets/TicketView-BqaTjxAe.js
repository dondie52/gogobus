const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-rmaRHAdS.js","assets/index-BLL7Hngr.js","assets/index-CruQL1Ad.css","assets/QRCodeDisplay-BTc7n4dv.js","assets/QRCodeDisplay-EpgLn9sU.css"])))=>i.map(i=>d[i]);
import{c as e,s as t,_ as n,r as i,j as s,u as a,w as r,a as o,L as l,q as c}from"./index-BLL7Hngr.js";import{B as d}from"./Button-9UClSgPh.js";import{Q as u}from"./QRCodeDisplay-BTc7n4dv.js";import{s as _,T as h,a as m,g as x}from"./trackingService-kkv6oYSO.js";const g={name:"GOGOBUS",tagline:"Travel with Confidence",phone:"+267 12 345 678",email:"support@gogobus.co.bw",website:"www.gogobus.co.bw",address:"Plot 123, Main Mall, Gaborone, Botswana"},p={primary:"#1B4D4A",primaryDark:"#153D3A",accent:"#F5A623",success:"#22C55E",gray:"#64748B",lightGray:"#F1F5F9",white:"#FFFFFF",black:"#0F172A"},y=async t=>{const{default:i}=await n(async()=>{const{default:e}=await import("./jspdf.es.min-rmaRHAdS.js").then(e=>e.j);return{default:e}},__vite__mapDeps([0,1,2])),s=t.trips||{},a=s.routes||{},{booking_reference:r,passenger_name:o,passenger_phone:l,passenger_email:c,seat_number:d,total_amount:u,payment_status:_,payment_method:h}=t,{departure_time:m,arrival_time:x,price:y}=s,{origin:k="Origin",destination:j="Destination"}=a,v=new i({orientation:"portrait",unit:"mm",format:[148,210]}),w=148,b=10;let N=b;const f=(e,t,n,i,s=p.lightGray,a=.5)=>{v.setDrawColor(s),v.setLineWidth(a),v.line(e,t,n,i)};((e,t,n,i,s=0)=>{v.setFillColor(i),s>0?v.roundedRect(e,N,t,n,s,s,"F"):v.rect(e,N,t,n,"F")})(0,w,35,p.primary),N=15,v.setFontSize(20),v.setTextColor(p.white),v.setFont("helvetica","bold"),v.text("GOGOBUS",b,N),N=22,v.setFontSize(8),v.setFont("helvetica","normal"),v.text(g.tagline,b,N),v.setFillColor(p.accent),v.roundedRect(108,10,30,12,2,2,"F"),v.setFontSize(7),v.setTextColor(p.white),v.setFont("helvetica","bold"),v.text("E-TICKET",123,17.5,{align:"center"}),N=45,v.setFontSize(18),v.setTextColor(p.black),v.setFont("helvetica","bold");const F=k.length>12?k.substring(0,12):k;v.text(F.toUpperCase(),25,N,{align:"center",maxWidth:40}),v.setFontSize(8),v.setTextColor(p.gray),v.setFont("helvetica","normal"),v.text(k,25,N+5,{align:"center",maxWidth:40}),f(45,N-3,103,N-3,p.lightGray,1),v.setFillColor(p.accent),v.circle(74,N-3,4,"F"),v.setFontSize(6),v.setTextColor(p.white),v.text("BUS",74,N-1.5,{align:"center"}),v.setFontSize(18),v.setTextColor(p.black),v.setFont("helvetica","bold");const C=j.length>12?j.substring(0,12):j;v.text(C.toUpperCase(),123,N,{align:"center",maxWidth:40}),v.setFontSize(8),v.setTextColor(p.gray),v.setFont("helvetica","normal"),v.text(j,123,N+5,{align:"center",maxWidth:40}),N=65;const S=new Date(m),z=S.toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),T=S.toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit"});v.setFillColor(p.lightGray),v.roundedRect(b,N,60,20,3,3,"F"),v.setFontSize(7),v.setTextColor(p.gray),v.text("DATE",15,N+6),v.setFontSize(11),v.setTextColor(p.black),v.setFont("helvetica","bold"),v.text(z,15,N+14),v.setFillColor(p.lightGray),v.roundedRect(78,N,60,20,3,3,"F"),v.setFontSize(7),v.setTextColor(p.gray),v.setFont("helvetica","normal"),v.text("DEPARTURE",83,N+6),v.setFontSize(16),v.setTextColor(p.primary),v.setFont("helvetica","bold"),v.text(T,83,N+15),N=95;for(let e=b;e<138;e+=4)f(e,N,e+2,N,p.lightGray,.5);v.setFillColor(p.white),v.circle(0,N,5,"F"),v.circle(w,N,5,"F"),N=105,v.setFontSize(7),v.setTextColor(p.gray),v.setFont("helvetica","normal"),v.text("PASSENGER",b,N),v.setFontSize(12),v.setTextColor(p.black),v.setFont("helvetica","bold"),v.text(o.toUpperCase(),b,N+6),v.setFontSize(7),v.setTextColor(p.gray),v.setFont("helvetica","normal"),v.text("PHONE",b,N+15),v.setFontSize(10),v.setTextColor(p.black),v.setFont("helvetica","normal"),v.text(l||"N/A",b,N+21),v.setFontSize(7),v.setTextColor(p.gray),v.text("SEAT",108,N),v.setFillColor(p.primary),v.roundedRect(108,N+2,30,18,3,3,"F"),v.setFontSize(16),v.setTextColor(p.white),v.setFont("helvetica","bold"),v.text(d,123,N+14,{align:"center"}),N=140,v.setFontSize(7),v.setTextColor(p.gray),v.setFont("helvetica","normal"),v.text("BOOKING REFERENCE",b,N),v.setFontSize(16),v.setTextColor(p.primary),v.setFont("helvetica","bold");const D=r||"N/A";v.text(D,b,N+8,{maxWidth:98});const B="paid"===_?p.success:p.accent;v.setFillColor(B),v.roundedRect(113,N-2,25,10,2,2,"F"),v.setFontSize(6),v.setTextColor(p.white),v.setFont("helvetica","bold"),v.text(_.toUpperCase(),125.5,N+4,{align:"center"}),N=155,v.setFillColor(p.lightGray),v.roundedRect(103,N,35,35,3,3,"F"),v.setFontSize(6),v.setTextColor(p.gray),v.text("SCAN TO",120.5,N+14,{align:"center"}),v.text("VERIFY",120.5,N+18,{align:"center"});try{const i=await(async t=>{try{const e=await n(()=>import("./QRCodeDisplay-BTc7n4dv.js").then(e=>e.b),__vite__mapDeps([3,1,2,4]));return await e.toDataURL(JSON.stringify(t),{width:150,margin:1,color:{dark:p.primary,light:p.white}})}catch(i){return e("QR Code generation failed",i),null}})({ref:r,id:t.id,v:1});i&&v.addImage(i,"PNG",105,N+2,31,31)}catch($){}v.setFontSize(7),v.setTextColor(p.gray),v.setFont("helvetica","normal"),v.text("AMOUNT PAID",b,N+5),v.setFontSize(20),v.setTextColor(p.black),v.setFont("helvetica","bold"),v.text(`P${Number(u||y).toFixed(2)}`,b,N+14),v.setFontSize(8),v.setTextColor(p.gray),v.setFont("helvetica","normal");const L={card:"Credit/Debit Card",orange_money:"Orange Money",myzaka:"MyZaka",cash:"Cash",bank_transfer:"Bank Transfer"}[h]||h;return v.text(`via ${L}`,b,N+20),N=190,f(b,N,138,N,p.lightGray,.3),N=198,v.setFontSize(6),v.setTextColor(p.gray),v.setFont("helvetica","normal"),v.text(g.phone,b,N),v.text(g.email,74,N,{align:"center"}),v.text(g.website,138,N,{align:"right"}),N=203,v.setFontSize(5),v.text("Please arrive at the station 30 minutes before departure. This ticket is non-transferable.",74,N,{align:"center"}),v},k=async t=>{try{const e=await y(t),n=`GOGOBUS-Ticket-${t.booking_reference}.pdf`;return e.save(n),{success:!0,filename:n}}catch(n){return e("PDF generation error",n),{success:!1,error:n.message}}},j=async t=>{try{const e=await y(t);return{success:!0,blob:e.output("blob")}}catch(n){return e("PDF blob error",n),{success:!1,error:n.message}}},v=async t=>{try{const e=await y(t);return e.autoPrint(),window.open(e.output("bloburl"),"_blank"),{success:!0}}catch(n){return e("Print error",n),{success:!1,error:n.message}}},w="_buttonGroup_1nzce_8",b="_btn_1nzce_17",N="_primary_1nzce_38",f="_secondary_1nzce_50",F="_minimalBtn_1nzce_64",C="_card_1nzce_88",S="_cardHeader_1nzce_96",z="_cardText_1nzce_110",T="_cardActions_1nzce_117",D="_errorMessage_1nzce_133",B="_errorToast_1nzce_145",L="_spinner_1nzce_177",$=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7 10 12 15 17 10"}),s.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),R=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),s.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),s.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]}),P=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"18",cy:"5",r:"3"}),s.jsx("circle",{cx:"6",cy:"12",r:"3"}),s.jsx("circle",{cx:"18",cy:"19",r:"3"}),s.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),s.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),E=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),s.jsx("polyline",{points:"22,6 12,13 2,6"})]}),G=()=>s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:L,children:s.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),O=()=>s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M20 6 9 17l-5-5"})}),A=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),s.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]});function I({bookingData:t,variant:n="button",showPrint:a=!0,showShare:r=!0,showEmail:o=!1,className:l=""}){const[c,d]=i.useState(!1),[u,_]=i.useState(!1),[h,m]=i.useState(!1),[x,g]=i.useState(null),[p,y]=i.useState(""),L=(e,t="")=>{g(e),y(t),setTimeout(()=>{g(null),y("")},3e3)},I=async()=>{if(!c&&t){d(!0);try{const e=await k(t);if(!e.success)throw new Error(e.error);L("success")}catch(n){e("Download error",n),L("error",n.message||"Download failed")}finally{d(!1)}}},M=async()=>{if(!u&&t){_(!0);try{const e=await v(t);if(!e.success)throw new Error(e.error)}catch(n){e("Print error",n),L("error",n.message||"Print failed")}finally{_(!1)}}};return"minimal"===n?s.jsx("button",{className:`${F} ${l}`,onClick:I,disabled:c,children:c?s.jsx(G,{}):s.jsx($,{})}):"card"===n?s.jsxs("div",{className:`${C} ${l}`,children:[s.jsxs("div",{className:S,children:[s.jsx($,{}),s.jsx("span",{children:"Download Your Ticket"})]}),s.jsx("p",{className:z,children:"Get your e-ticket as a PDF file. You can print it or show it on your phone."}),s.jsxs("div",{className:T,children:[s.jsx("button",{className:`${b} ${N}`,onClick:I,disabled:c,children:c?s.jsxs(s.Fragment,{children:[s.jsx(G,{}),"Generating..."]}):"success"===x?s.jsxs(s.Fragment,{children:[s.jsx(O,{}),"Downloaded!"]}):s.jsxs(s.Fragment,{children:[s.jsx($,{}),"Download PDF"]})}),a&&s.jsxs("button",{className:`${b} ${f}`,onClick:M,disabled:u,children:[u?s.jsx(G,{}):s.jsx(R,{}),"Print"]})]}),"error"===x&&s.jsxs("div",{className:D,children:[s.jsx(A,{}),p||"Something went wrong"]})]}):s.jsxs("div",{className:`${w} ${l}`,children:[s.jsx("button",{className:`${b} ${N}`,onClick:I,disabled:c,children:c?s.jsxs(s.Fragment,{children:[s.jsx(G,{}),"Generating..."]}):"success"===x?s.jsxs(s.Fragment,{children:[s.jsx(O,{}),"Downloaded!"]}):s.jsxs(s.Fragment,{children:[s.jsx($,{}),"Download Ticket"]})}),a&&s.jsx("button",{className:`${b} ${f}`,onClick:M,disabled:u,title:"Print ticket",children:u?s.jsx(G,{}):s.jsx(R,{})}),r&&s.jsx("button",{className:`${b} ${f}`,onClick:async()=>{var n,i,s,a;if(!h&&t){m(!0);try{if(navigator.share){const e={title:`GOGOBUS Ticket - ${t.booking_reference}`,text:`My bus ticket: ${null==(i=null==(n=t.trips)?void 0:n.routes)?void 0:i.origin} â†’ ${null==(a=null==(s=t.trips)?void 0:s.routes)?void 0:a.destination}. Booking ref: ${t.booking_reference}`,url:window.location.href};if(navigator.canShare&&navigator.canShare({files:[]})){const{blob:n}=await j(t);if(n){const i=new File([n],`GOGOBUS-Ticket-${t.booking_reference}.pdf`,{type:"application/pdf"});e.files=[i]}}await navigator.share(e),L("success")}else await navigator.clipboard.writeText(window.location.href),L("success")}catch(r){"AbortError"!==r.name&&(e("Share error",r),L("error","Share failed"))}finally{m(!1)}}},disabled:h,title:"Share ticket",children:h?s.jsx(G,{}):s.jsx(P,{})}),o&&s.jsx("button",{className:`${b} ${f}`,onClick:async()=>{var e,n,i,s,a;if(!t)return;const r=encodeURIComponent(`GOGOBUS Ticket - ${t.booking_reference}`),o=encodeURIComponent(`My GOGOBUS ticket:\n\nRoute: ${null==(n=null==(e=t.trips)?void 0:e.routes)?void 0:n.origin} â†’ ${null==(s=null==(i=t.trips)?void 0:i.routes)?void 0:s.destination}\nDate: ${new Date(null==(a=t.trips)?void 0:a.departure_time).toLocaleDateString()}\nBooking Reference: ${t.booking_reference}\nSeat: ${t.seat_number}\n\nView ticket: ${window.location.href}`);window.location.href=`mailto:?subject=${r}&body=${o}`},title:"Email ticket",children:s.jsx(E,{})}),"error"===x&&s.jsxs("div",{className:B,children:[s.jsx(A,{}),p||"Something went wrong"]})]})}const M="_card_zylro_1",U="_header_zylro_14",V="_headerIcon_zylro_23",W="_headerTitle_zylro_28",H="_loadingState_zylro_37",Q="_errorState_zylro_38",Y="_emptyState_zylro_39",J="_mapPreview_zylro_49",K="_previewMap_zylro_58",q="_mapContainer_zylro_63",Z="_trackingMap_zylro_71",X="_emptyContent_zylro_76",ee="_loadingSpinner_zylro_84",te="_errorIcon_zylro_98",ne="_emptyIcon_zylro_99",ie="_retryButton_zylro_108",se="_emptyText_zylro_124",ae="_emptySubtext_zylro_132",re="_content_zylro_139",oe="_infoRow_zylro_145",le="_infoLabel_zylro_157",ce="_infoValue_zylro_164",de="_lastUpdated_zylro_172",ue="_updateDot_zylro_184",_e="_mapButton_zylro_197",he="_mapButtonIcon_zylro_221",me="_mapButtonArrow_zylro_225";function xe(e){if(!e)return"Unknown";const t=new Date(e),n=new Date-t,i=Math.floor(n/1e3),s=Math.floor(i/60),a=Math.floor(s/60);return i<10?"Just now":i<60?`${i} sec ago`:s<60?`${s} min ago`:a<24?`${a} hr ago`:t.toLocaleDateString()}function ge(e){return e?e.locationName?e.locationName:e.lat&&e.lng?`${e.lat.toFixed(4)}Â°, ${e.lng.toFixed(4)}Â°`:"Location unavailable":"Location unavailable"}function pe({routeId:e,tripId:t,trip:n,bookingId:r,route:o}){const l=a(),[c,d]=i.useState(null),[u,g]=i.useState(!0),[p,y]=i.useState(null),[k,j]=i.useState(null),v=t||e;i.useEffect(()=>{if(!v)return void g(!1);let e=!0;return async function(){try{g(!0),y(null);const t=await x(v);e&&(d(t),j((null==t?void 0:t.recorded_at)||null))}catch(t){e&&y("Failed to load tracking data")}finally{e&&g(!1)}}(),()=>{e=!1}},[v]),i.useEffect(()=>{if(!v)return;const e=_(v,e=>{d(e),j((null==e?void 0:e.recorded_at)||(new Date).toISOString())});return()=>{e()}},[v]),i.useEffect(()=>{if(!k)return;const e=setInterval(()=>{j(e=>e)},1e4);return()=>clearInterval(e)},[k]);const w=i.useCallback(()=>{const n=e||t;n&&l(`/tracking/${n}`)},[l,e,t]);if(u)return s.jsxs("div",{className:M,children:[s.jsxs("div",{className:U,children:[s.jsx("span",{className:V,children:"ðŸ“"}),s.jsx("h3",{className:W,children:"Live Tracking"})]}),s.jsxs("div",{className:H,children:[s.jsx("div",{className:ee}),s.jsx("span",{children:"Loading tracking data..."})]})]});if(p)return s.jsxs("div",{className:M,children:[s.jsxs("div",{className:U,children:[s.jsx("span",{className:V,children:"ðŸ“"}),s.jsx("h3",{className:W,children:"Live Tracking"})]}),s.jsxs("div",{className:Q,children:[s.jsx("span",{className:te,children:"âš ï¸"}),s.jsx("p",{children:p}),s.jsx("button",{className:ie,onClick:()=>window.location.reload(),type:"button",children:"Retry"})]})]});if(!c){const e=(null==o?void 0:o.origin_lat)&&(null==o?void 0:o.origin_lng)?{lat:o.origin_lat,lng:o.origin_lng,name:o.origin}:null,t=(null==o?void 0:o.destination_lat)&&(null==o?void 0:o.destination_lng)?{lat:o.destination_lat,lng:o.destination_lng,name:o.destination}:null;return s.jsxs("div",{className:M,children:[s.jsxs("div",{className:U,children:[s.jsx("span",{className:V,children:"ðŸ“"}),s.jsx("h3",{className:W,children:"Live Tracking"})]}),s.jsxs("div",{className:Y,children:[(e||t)&&s.jsx("div",{className:J,children:s.jsx(h,{location:null,origin:e,destination:t,className:K})}),s.jsxs("div",{className:X,children:[s.jsx("span",{className:ne,children:"ðŸšŒ"}),s.jsx("p",{className:se,children:"Live tracking will be available once the bus departs."}),s.jsx("p",{className:ae,children:"Check back closer to departure time."})]}),v&&s.jsxs("button",{type:"button",className:_e,onClick:w,"aria-label":"Open live map view",children:[s.jsx("span",{className:he,children:"ðŸ—ºï¸"}),"View Route Map",s.jsx("span",{className:me,children:"â†’"})]})]})]})}return s.jsxs("div",{className:M,children:[s.jsxs("div",{className:U,children:[s.jsx("span",{className:V,children:"ðŸ“"}),s.jsx("h3",{className:W,children:"Live Tracking"}),c.status&&s.jsx(m,{status:c.status,size:"small"})]}),s.jsx("div",{className:q,children:s.jsx(h,{location:c,origin:(null==o?void 0:o.origin_lat)&&(null==o?void 0:o.origin_lng)?{lat:o.origin_lat,lng:o.origin_lng,name:o.origin}:null,destination:(null==o?void 0:o.destination_lat)&&(null==o?void 0:o.destination_lng)?{lat:o.destination_lat,lng:o.destination_lng,name:o.destination}:null,className:Z})}),s.jsxs("div",{className:re,children:[s.jsxs("div",{className:oe,children:[s.jsx("span",{className:le,children:"Current Location"}),s.jsx("span",{className:ce,children:ge(c)})]}),null!=c.speed&&s.jsxs("div",{className:oe,children:[s.jsx("span",{className:le,children:"Speed"}),s.jsxs("span",{className:ce,children:[Math.round(c.speed)," km/h"]})]}),s.jsxs("div",{className:oe,children:[s.jsx("span",{className:le,children:"ETA"}),s.jsx("span",{className:ce,children:(null==n?void 0:n.eta)||"Estimating..."})]}),s.jsxs("div",{className:de,children:[s.jsx("span",{className:ue}),"Last updated: ",xe(k)]})]}),s.jsxs("button",{type:"button",className:_e,onClick:w,"aria-label":"Open live map view",children:[s.jsx("span",{className:he,children:"ðŸ—ºï¸"}),"Open Live Map",s.jsx("span",{className:me,children:"â†’"})]})]})}const ye={ticketViewScreen:"_ticketViewScreen_1uky6_1",loadingContainer:"_loadingContainer_1uky6_8",errorContainer:"_errorContainer_1uky6_9",ticketViewHeader:"_ticketViewHeader_1uky6_23",backButton:"_backButton_1uky6_30",ticketViewContent:"_ticketViewContent_1uky6_54",ticketCard:"_ticketCard_1uky6_59",ticketHeader:"_ticketHeader_1uky6_66",companyInfo:"_companyInfo_1uky6_75",companyLogo:"_companyLogo_1uky6_81",companyName:"_companyName_1uky6_85",bookingRef:"_bookingRef_1uky6_93",statusBadge:"_statusBadge_1uky6_99",confirmed:"_confirmed_1uky6_108",cancelled:"_cancelled_1uky6_113",ticketRoute:"_ticketRoute_1uky6_118",routePoint:"_routePoint_1uky6_128",city:"_city_1uky6_135",time:"_time_1uky6_142",routeLine:"_routeLine_1uky6_148",arrow:"_arrow_1uky6_156",duration:"_duration_1uky6_162",ticketDetails:"_ticketDetails_1uky6_168",detailRow:"_detailRow_1uky6_172",price:"_price_1uky6_194",trackingSection:"_trackingSection_1uky6_200",ticketDownloadSection:"_ticketDownloadSection_1uky6_205",ticketActions:"_ticketActions_1uky6_210"},ke=()=>{var t,n;const{id:_}=r(),h=a(),{user:m}=o(),[x,g]=i.useState(null),[p,y]=i.useState(!0),[k,j]=i.useState(!1),[v,w]=i.useState("");i.useEffect(()=>{(async()=>{if(null==m?void 0:m.id){y(!0);try{const e=(await c.getUserBookings(m.id)).find(e=>e.id===_);e?g(e):w("Ticket not found")}catch(t){e("Failed to load booking",t),w("Failed to load ticket. Please try again.")}finally{y(!1)}}})()},[_,m]);const b=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return e}};if(p)return s.jsx("div",{className:ye.loadingContainer,children:s.jsx(l,{size:"large"})});if(v||!x)return s.jsxs("div",{className:ye.errorContainer,children:[s.jsx("p",{children:v||"Ticket not found"}),s.jsx(d,{onClick:()=>h("/tickets"),children:"Back to Tickets"})]});const N=x.schedule||{},f=N.route||{},F=N.bus||{},C=F.company||{},S=(()=>{var e,t,n,i;if(!x)return null;const s=x.booking_reference||x.booking_ref||x.id;return{id:x.id,booking_reference:s,passenger_name:x.passenger_name||(null==(e=x.user)?void 0:e.name)||"Passenger",passenger_phone:x.passenger_phone||(null==(t=x.user)?void 0:t.phone)||"",passenger_email:x.passenger_email||(null==(n=x.user)?void 0:n.email)||"",seat_number:(null==(i=x.seats)?void 0:i[0])||x.seat_number||"N/A",total_amount:x.total_price||x.total_amount||0,payment_status:x.payment_status||x.status||"pending",payment_method:x.payment_method||"card",trips:{departure_time:N.departure_time||x.created_at,arrival_time:N.arrival_time,price:N.price||x.total_price||0,routes:{origin:f.origin||"",destination:f.destination||"",distance_km:f.distance_km,duration_minutes:f.duration_minutes},buses:F||{}}}})();return s.jsxs("div",{className:ye.ticketViewScreen,children:[s.jsxs("div",{className:ye.ticketViewHeader,children:[s.jsx("button",{className:ye.backButton,onClick:()=>h("/tickets"),children:"â† Back"}),s.jsx("h1",{children:"Ticket Details"})]}),s.jsx("div",{className:ye.ticketViewContent,children:s.jsxs("div",{className:ye.ticketCard,children:[s.jsxs("div",{className:ye.ticketHeader,children:[s.jsxs("div",{className:ye.companyInfo,children:[s.jsx("span",{className:ye.companyLogo,children:C.logo||"ðŸšŒ"}),s.jsxs("div",{children:[s.jsx("div",{className:ye.companyName,children:C.name||"Bus Company"}),s.jsxs("div",{className:ye.bookingRef,children:["Booking #",x.id]})]})]}),s.jsx("div",{className:`${ye.statusBadge} ${ye[x.status]}`,children:x.status||"confirmed"})]}),s.jsxs("div",{className:ye.ticketRoute,children:[s.jsxs("div",{className:ye.routePoint,children:[s.jsx("span",{className:ye.city,children:f.origin||"Origin"}),s.jsx("span",{className:ye.time,children:b(N.departure_time)})]}),s.jsxs("div",{className:ye.routeLine,children:[s.jsx("span",{className:ye.arrow,children:"â†’"}),s.jsx("span",{className:ye.duration,children:N.duration||"N/A"})]}),s.jsxs("div",{className:ye.routePoint,children:[s.jsx("span",{className:ye.city,children:f.destination||"Destination"}),s.jsx("span",{className:ye.time,children:b(N.arrival_time)})]})]}),s.jsxs("div",{className:ye.ticketDetails,children:[s.jsxs("div",{className:ye.detailRow,children:[s.jsx("span",{children:"Date"}),s.jsx("span",{children:(e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})(N.departure_time||x.created_at)})]}),s.jsxs("div",{className:ye.detailRow,children:[s.jsx("span",{children:"Seats"}),s.jsx("span",{children:(null==(t=x.seats)?void 0:t.join(", "))||"N/A"})]}),s.jsxs("div",{className:ye.detailRow,children:[s.jsx("span",{children:"Total Price"}),s.jsxs("span",{className:ye.price,children:["P",(null==(n=x.total_price)?void 0:n.toFixed(2))||"0.00"]})]})]}),s.jsx(u,{bookingId:x.id,route:f,seats:x.seats}),((null==f?void 0:f.id)||(null==N?void 0:N.id))&&s.jsx("div",{className:ye.trackingSection,children:s.jsx(pe,{routeId:f.id,tripId:null==N?void 0:N.id,trip:x.schedule,bookingId:x.id,route:f})}),S&&s.jsx("div",{className:ye.ticketDownloadSection,children:s.jsx(I,{bookingData:S,variant:"card",showPrint:!0,showShare:!0,showEmail:!1})}),"cancelled"!==x.status&&s.jsx("div",{className:ye.ticketActions,children:s.jsx(d,{variant:"outline",onClick:async()=>{if(window.confirm("Are you sure you want to cancel this booking?")){j(!0);try{await c.cancelBooking(_),g(e=>({...e,status:"cancelled"})),alert("Booking cancelled successfully")}catch(t){e("Failed to cancel booking",t),alert("Failed to cancel booking. Please try again.")}finally{j(!1)}}},disabled:k,children:k?"Cancelling...":"Cancel Booking"})})]})})]})};export{ke as default};
