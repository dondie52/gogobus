import{u as e,r as s,c as a,j as r}from"./index-CFOqP2ng.js";import{a as t}from"./adminService-VIzb5-_F.js";const n={scannerApp:"_scannerApp_l92xr_33",header:"_header_l92xr_43",backBtn:"_backBtn_l92xr_52",headerContent:"_headerContent_l92xr_70",headerTitle:"_headerTitle_l92xr_74",headerSubtitle:"_headerSubtitle_l92xr_80",headerLogo:"_headerLogo_l92xr_85",modeToggle:"_modeToggle_l92xr_96",modeBtn:"_modeBtn_l92xr_104",active:"_active_l92xr_122",scannerContainer:"_scannerContainer_l92xr_129",cameraViewport:"_cameraViewport_l92xr_134",cameraVideo:"_cameraVideo_l92xr_144",scannerOverlay:"_scannerOverlay_l92xr_150",scanFrame:"_scanFrame_l92xr_159",scanCorner:"_scanCorner_l92xr_165",tl:"_tl_l92xr_172",tr:"_tr_l92xr_180",bl:"_bl_l92xr_188",br:"_br_l92xr_196",scanLine:"_scanLine_l92xr_204",cameraPlaceholder:"_cameraPlaceholder_l92xr_225",cameraError:"_cameraError_l92xr_236",manualEntry:"_manualEntry_l92xr_247",manualEntryTitle:"_manualEntryTitle_l92xr_256",manualEntrySubtitle:"_manualEntrySubtitle_l92xr_263",referenceInputGroup:"_referenceInputGroup_l92xr_270",referenceInput:"_referenceInput_l92xr_270",searchBtn:"_searchBtn_l92xr_303",resultContainer:"_resultContainer_l92xr_327",resultCard:"_resultCard_l92xr_333",slideUp:"_slideUp_l92xr_1",resultStatus:"_resultStatus_l92xr_351",success:"_success_l92xr_356",error:"_error_l92xr_361",warning:"_warning_l92xr_366",alreadyBoarded:"_alreadyBoarded_l92xr_371",statusIcon:"_statusIcon_l92xr_376",statusTitle:"_statusTitle_l92xr_380",statusSubtitle:"_statusSubtitle_l92xr_386",resultDetails:"_resultDetails_l92xr_391",bookingRef:"_bookingRef_l92xr_396",detailRow:"_detailRow_l92xr_408",detailIcon:"_detailIcon_l92xr_420",detailContent:"_detailContent_l92xr_432",detailLabel:"_detailLabel_l92xr_436",detailValue:"_detailValue_l92xr_442",seatBadge:"_seatBadge_l92xr_448",resultActions:"_resultActions_l92xr_459",actionBtn:"_actionBtn_l92xr_465",primary:"_primary_l92xr_480",secondary:"_secondary_l92xr_492",loadingContainer:"_loadingContainer_l92xr_510",loadingSpinner:"_loadingSpinner_l92xr_515",spin:"_spin_l92xr_1",loadingText:"_loadingText_l92xr_531",statsBar:"_statsBar_l92xr_537",statItem:"_statItem_l92xr_544",statValue:"_statValue_l92xr_552",statLabel:"_statLabel_l92xr_558"},i=()=>r.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),r.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),r.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),r.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),r.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),l=()=>r.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),r.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),d=()=>r.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),r.jsx("path",{d:"M6 8h.01M10 8h.01M14 8h.01M18 8h.01M8 12h.01M12 12h.01M16 12h.01M7 16h10"})]}),o=()=>r.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:r.jsx("path",{d:"M20 6 9 17l-5-5"})}),c=()=>r.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),r.jsx("path",{d:"M12 9v4"}),r.jsx("path",{d:"M12 17h.01"})]}),h=()=>r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),r.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),x=()=>r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),r.jsx("path",{d:"M13 5v2"}),r.jsx("path",{d:"M13 17v2"}),r.jsx("path",{d:"M13 11v2"})]}),u=()=>r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),r.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),_=()=>r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("polyline",{points:"12 6 12 12 16 14"})]}),j=()=>r.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:r.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),m=()=>r.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"m12 19-7-7 7-7"}),r.jsx("path",{d:"M19 12H5"})]}),v=()=>r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),r.jsx("path",{d:"M21 3v5h-5"}),r.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),r.jsx("path",{d:"M8 16H3v5"})]}),p=()=>r.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),r.jsx("path",{d:"m9 11 3 3L22 4"})]}),g=()=>r.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("path",{d:"m15 9-6 6"}),r.jsx("path",{d:"m9 9 6 6"})]}),k=()=>r.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M8 6v6m8-6v6M5 18v2m14-2v2M3 6h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6ZM3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2"}),r.jsx("circle",{cx:"7",cy:"15",r:"1"}),r.jsx("circle",{cx:"17",cy:"15",r:"1"})]});function b(){const b=e(),[N,y]=s.useState("camera"),[C,L]=s.useState(""),[w,B]=s.useState(!1),[f,M]=s.useState(null),[S,V]=s.useState(null),[I,$]=s.useState(!1),[T,E]=s.useState({scanned:0,boarded:0}),R=s.useRef(null),W=s.useRef(null),A=s.useCallback(async()=>{try{V(null);const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});R.current&&(R.current.srcObject=e,W.current=e,$(!0))}catch(e){a("Camera error",e),V("Unable to access camera. Please check permissions or use manual entry."),$(!1)}},[]),P=s.useCallback(()=>{W.current&&(W.current.getTracks().forEach(e=>e.stop()),W.current=null),R.current&&(R.current.srcObject=null),$(!1)},[]);s.useEffect(()=>("camera"===N?A():P(),()=>P()),[N,A,P]);const D=async(e=C)=>{if(e.trim()){B(!0),M(null);try{const{data:s,error:a}=await t.getBookingByReference(e.trim());E(e=>({...e,scanned:e.scanned+1})),a||!s?M({booking:null,status:"invalid"}):s.is_boarded?M({booking:s,status:"already_boarded"}):"paid"!==s.payment_status?M({booking:s,status:"unpaid"}):M({booking:s,status:"valid"})}catch(s){a("Search error",s),M({booking:null,status:"invalid"})}finally{B(!1)}}},H=async()=>{if(null==f?void 0:f.booking){B(!0);try{const{error:e}=await t.markAsBoarded(f.booking.id);e||(E(e=>({...e,boarded:e.boarded+1})),M({booking:{...f.booking,is_boarded:!0,boarded_at:(new Date).toISOString()},status:"boarded_success"}))}catch(e){a("Boarding error",e)}finally{B(!1)}}},F=()=>{M(null),L(""),"camera"===N&&A()},O=e=>e?new Date(e).toLocaleString("en-BW",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return r.jsxs("div",{className:n.scannerApp,children:[r.jsxs("header",{className:n.header,children:[r.jsx("button",{className:n.backBtn,onClick:()=>b("/admin"),children:r.jsx(m,{})}),r.jsxs("div",{className:n.headerContent,children:[r.jsx("div",{className:n.headerTitle,children:"Boarding Scanner"}),r.jsx("div",{className:n.headerSubtitle,children:"Scan tickets to verify and board passengers"})]}),r.jsx("div",{className:n.headerLogo,children:r.jsx(k,{})})]}),!f&&r.jsxs("div",{className:n.modeToggle,children:[r.jsxs("button",{className:`${n.modeBtn} ${"camera"===N?n.active:""}`,onClick:()=>y("camera"),children:[r.jsx(l,{}),"Camera"]}),r.jsxs("button",{className:`${n.modeBtn} ${"manual"===N?n.active:""}`,onClick:()=>y("manual"),children:[r.jsx(d,{}),"Manual"]})]}),w&&!f&&r.jsxs("div",{className:n.loadingContainer,children:[r.jsx("div",{className:n.loadingSpinner}),r.jsx("div",{className:n.loadingText,children:"Verifying ticket..."})]}),f&&(()=>{var e,s,a,t,i;if(!f)return null;const{booking:l,status:d}=f,m={valid:{class:"success",icon:r.jsx(p,{}),title:"Valid Ticket",subtitle:"Ready to board"},invalid:{class:"error",icon:r.jsx(g,{}),title:"Not Found",subtitle:"This booking reference is invalid"},already_boarded:{class:"alreadyBoarded",icon:r.jsx(c,{style:{width:64,height:64}}),title:"Already Boarded",subtitle:`Boarded at ${(null==l?void 0:l.boarded_at)?O(l.boarded_at):"N/A"}`},unpaid:{class:"warning",icon:r.jsx(c,{style:{width:64,height:64}}),title:"Payment Pending",subtitle:"Ticket has not been paid for"},boarded_success:{class:"success",icon:r.jsx(p,{}),title:"Boarded!",subtitle:"Passenger successfully checked in"}}[d];return r.jsx("div",{className:n.resultContainer,children:r.jsxs("div",{className:n.resultCard,children:[r.jsxs("div",{className:`${n.resultStatus} ${n[m.class]}`,children:[r.jsx("div",{className:n.statusIcon,children:m.icon}),r.jsx("div",{className:n.statusTitle,children:m.title}),r.jsx("div",{className:n.statusSubtitle,children:m.subtitle})]}),l&&r.jsxs("div",{className:n.resultDetails,children:[r.jsx("div",{className:n.bookingRef,children:l.booking_reference}),r.jsxs("div",{className:n.detailRow,children:[r.jsx("div",{className:n.detailIcon,children:r.jsx(h,{})}),r.jsxs("div",{className:n.detailContent,children:[r.jsx("div",{className:n.detailLabel,children:"Passenger"}),r.jsx("div",{className:n.detailValue,children:l.passenger_name})]})]}),r.jsxs("div",{className:n.detailRow,children:[r.jsx("div",{className:n.detailIcon,children:r.jsx(j,{})}),r.jsxs("div",{className:n.detailContent,children:[r.jsx("div",{className:n.detailLabel,children:"Phone"}),r.jsx("div",{className:n.detailValue,children:l.passenger_phone})]})]}),r.jsxs("div",{className:n.detailRow,children:[r.jsx("div",{className:n.detailIcon,children:r.jsx(u,{})}),r.jsxs("div",{className:n.detailContent,children:[r.jsx("div",{className:n.detailLabel,children:"Route"}),r.jsxs("div",{className:n.detailValue,children:[(null==(s=null==(e=l.trips)?void 0:e.routes)?void 0:s.origin)||"N/A"," → ",(null==(t=null==(a=l.trips)?void 0:a.routes)?void 0:t.destination)||"N/A"]})]})]}),r.jsxs("div",{className:n.detailRow,children:[r.jsx("div",{className:n.detailIcon,children:r.jsx(_,{})}),r.jsxs("div",{className:n.detailContent,children:[r.jsx("div",{className:n.detailLabel,children:"Departure"}),r.jsx("div",{className:n.detailValue,children:O(null==(i=l.trips)?void 0:i.departure_time)})]})]}),r.jsxs("div",{className:n.detailRow,children:[r.jsx("div",{className:n.detailIcon,children:r.jsx(x,{})}),r.jsx("div",{className:n.detailContent,children:r.jsx("div",{className:n.detailLabel,children:"Seat Number"})}),r.jsx("div",{className:n.seatBadge,children:l.seat_number})]})]}),r.jsxs("div",{className:n.resultActions,children:["valid"===d&&r.jsxs("button",{className:`${n.actionBtn} ${n.primary}`,onClick:H,disabled:w,children:[r.jsx(o,{}),"Confirm Boarding"]}),("boarded_success"===d||"already_boarded"===d||"invalid"===d||"unpaid"===d)&&r.jsxs("button",{className:`${n.actionBtn} ${n.primary}`,onClick:F,children:[r.jsx(v,{}),"Scan Next"]}),"valid"===d&&r.jsx("button",{className:`${n.actionBtn} ${n.secondary}`,onClick:F,children:"Cancel"})]})]})})})(),!w&&!f&&r.jsx("div",{className:n.scannerContainer,children:"camera"===N?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:n.cameraViewport,children:[r.jsx("video",{ref:R,className:n.cameraVideo,autoPlay:!0,playsInline:!0,muted:!0}),!I&&!S&&r.jsxs("div",{className:n.cameraPlaceholder,children:[r.jsx(l,{}),r.jsx("p",{children:"Starting camera..."})]}),I&&r.jsx("div",{className:n.scannerOverlay,children:r.jsxs("div",{className:n.scanFrame,children:[r.jsx("div",{className:`${n.scanCorner} ${n.tl}`}),r.jsx("div",{className:`${n.scanCorner} ${n.tr}`}),r.jsx("div",{className:`${n.scanCorner} ${n.bl}`}),r.jsx("div",{className:`${n.scanCorner} ${n.br}`}),r.jsx("div",{className:n.scanLine})]})})]}),S&&r.jsx("div",{className:n.cameraError,children:S})]}):r.jsxs("div",{className:n.manualEntry,children:[r.jsx("div",{className:n.manualEntryTitle,children:"Enter Booking Reference"}),r.jsx("div",{className:n.manualEntrySubtitle,children:"Type the code shown on the passenger's ticket"}),r.jsxs("div",{className:n.referenceInputGroup,children:[r.jsx("input",{type:"text",className:n.referenceInput,placeholder:"BK••••••",value:C,onChange:e=>L(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&D(),maxLength:8,autoFocus:!0}),r.jsx("button",{className:n.searchBtn,onClick:()=>D(),disabled:!C.trim(),children:r.jsx(i,{})})]})]})}),r.jsxs("div",{className:n.statsBar,children:[r.jsxs("div",{className:n.statItem,children:[r.jsx("div",{className:n.statValue,children:T.scanned}),r.jsx("div",{className:n.statLabel,children:"Scanned"})]}),r.jsxs("div",{className:n.statItem,children:[r.jsx("div",{className:n.statValue,children:T.boarded}),r.jsx("div",{className:n.statLabel,children:"Boarded"})]}),r.jsxs("div",{className:n.statItem,children:[r.jsx("div",{className:n.statValue,children:T.scanned-T.boarded}),r.jsx("div",{className:n.statLabel,children:"Pending"})]})]})]})}export{b as default};
