const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-CyV1d27L.js","assets/index-GPZqme8R.js","assets/index-BLI6m-np.css"])))=>i.map(i=>d[i]);
import{c as e,s as t,_ as n,r as i,j as s,w as o,u as r,a,L as l,q as c}from"./index-GPZqme8R.js";import{B as d}from"./Button-CTIz5iMA.js";import{Q as u}from"./QRCodeDisplay-CTTx_BNo.js";const h={name:"GOGOBUS",tagline:"Travel with Confidence",phone:"+267 12 345 678",email:"support@gogobus.co.bw",website:"www.gogobus.co.bw",address:"Plot 123, Main Mall, Gaborone, Botswana"},x={primary:"#1B4D4A",primaryDark:"#153D3A",accent:"#F5A623",success:"#22C55E",gray:"#64748B",lightGray:"#F1F5F9",white:"#FFFFFF",black:"#0F172A"},m=async t=>{const{default:i}=await n(async()=>{const{default:e}=await import("./jspdf.es.min-CyV1d27L.js").then(e=>e.j);return{default:e}},__vite__mapDeps([0,1,2])),{booking_reference:s,passenger_name:o,passenger_phone:r,passenger_email:a,seat_number:l,total_amount:c,payment_status:d,payment_method:u,trips:{departure_time:m,arrival_time:_,price:w,routes:{origin:g,destination:y},buses:p}}=t,k=new i({orientation:"portrait",unit:"mm",format:[148,210]}),j=148,v=10;let F=v;const b=(e,t,n,i,s=x.lightGray,o=.5)=>{k.setDrawColor(s),k.setLineWidth(o),k.line(e,t,n,i)};((e,t,n,i,s=0)=>{k.setFillColor(i),s>0?k.roundedRect(e,F,t,n,s,s,"F"):k.rect(e,F,t,n,"F")})(0,j,35,x.primary),F=15,k.setFontSize(20),k.setTextColor(x.white),k.setFont("helvetica","bold"),k.text("GOGOBUS",v,F),F=22,k.setFontSize(8),k.setFont("helvetica","normal"),k.text(h.tagline,v,F),k.setFillColor(x.accent),k.roundedRect(108,10,30,12,2,2,"F"),k.setFontSize(7),k.setTextColor(x.white),k.setFont("helvetica","bold"),k.text("E-TICKET",123,17.5,{align:"center"}),F=45,k.setFontSize(24),k.setTextColor(x.black),k.setFont("helvetica","bold"),k.text(g.substring(0,3).toUpperCase(),25,F,{align:"center"}),k.setFontSize(9),k.setTextColor(x.gray),k.setFont("helvetica","normal"),k.text(g,25,F+6,{align:"center"}),b(45,F-3,103,F-3,x.lightGray,1),k.setFillColor(x.accent),k.circle(74,F-3,4,"F"),k.setFontSize(6),k.setTextColor(x.white),k.text("BUS",74,F-1.5,{align:"center"}),k.setFontSize(24),k.setTextColor(x.black),k.setFont("helvetica","bold"),k.text(y.substring(0,3).toUpperCase(),123,F,{align:"center"}),k.setFontSize(9),k.setTextColor(x.gray),k.setFont("helvetica","normal"),k.text(y,123,F+6,{align:"center"}),F=65;const f=new Date(m),C=f.toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),S=f.toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit"});k.setFillColor(x.lightGray),k.roundedRect(v,F,60,20,3,3,"F"),k.setFontSize(7),k.setTextColor(x.gray),k.text("DATE",15,F+6),k.setFontSize(11),k.setTextColor(x.black),k.setFont("helvetica","bold"),k.text(C,15,F+14),k.setFillColor(x.lightGray),k.roundedRect(78,F,60,20,3,3,"F"),k.setFontSize(7),k.setTextColor(x.gray),k.setFont("helvetica","normal"),k.text("DEPARTURE",83,F+6),k.setFontSize(16),k.setTextColor(x.primary),k.setFont("helvetica","bold"),k.text(S,83,F+15),F=95;for(let e=v;e<138;e+=4)b(e,F,e+2,F,x.lightGray,.5);k.setFillColor(x.white),k.circle(0,F,5,"F"),k.circle(j,F,5,"F"),F=105,k.setFontSize(7),k.setTextColor(x.gray),k.setFont("helvetica","normal"),k.text("PASSENGER",v,F),k.setFontSize(12),k.setTextColor(x.black),k.setFont("helvetica","bold"),k.text(o.toUpperCase(),v,F+6),k.setFontSize(7),k.setTextColor(x.gray),k.setFont("helvetica","normal"),k.text("PHONE",v,F+15),k.setFontSize(10),k.setTextColor(x.black),k.setFont("helvetica","normal"),k.text(r||"N/A",v,F+21),k.setFontSize(7),k.setTextColor(x.gray),k.text("SEAT",108,F),k.setFillColor(x.primary),k.roundedRect(108,F+2,30,18,3,3,"F"),k.setFontSize(16),k.setTextColor(x.white),k.setFont("helvetica","bold"),k.text(l,123,F+14,{align:"center"}),F=140,k.setFontSize(7),k.setTextColor(x.gray),k.setFont("helvetica","normal"),k.text("BOOKING REFERENCE",v,F),k.setFontSize(18),k.setTextColor(x.primary),k.setFont("helvetica","bold"),k.text(s,v,F+8);const N="paid"===d?x.success:x.accent;k.setFillColor(N),k.roundedRect(113,F-2,25,10,2,2,"F"),k.setFontSize(6),k.setTextColor(x.white),k.setFont("helvetica","bold"),k.text(d.toUpperCase(),125.5,F+4,{align:"center"}),F=155,k.setFillColor(x.lightGray),k.roundedRect(103,F,35,35,3,3,"F"),k.setFontSize(6),k.setTextColor(x.gray),k.text("SCAN TO",120.5,F+14,{align:"center"}),k.text("VERIFY",120.5,F+18,{align:"center"});try{const i=await(async t=>{try{const e=await n(()=>import("./browser-SFIkLt_d.js").then(e=>e.b),[]);return await e.toDataURL(JSON.stringify(t),{width:150,margin:1,color:{dark:x.primary,light:x.white}})}catch(i){return e("QR Code generation failed",i),null}})({ref:s,id:t.id,v:1});i&&k.addImage(i,"PNG",105,F+2,31,31)}catch(z){}k.setFontSize(7),k.setTextColor(x.gray),k.setFont("helvetica","normal"),k.text("AMOUNT PAID",v,F+5),k.setFontSize(20),k.setTextColor(x.black),k.setFont("helvetica","bold"),k.text(`P${Number(c||w).toFixed(2)}`,v,F+14),k.setFontSize(8),k.setTextColor(x.gray),k.setFont("helvetica","normal");const T={card:"Credit/Debit Card",orange_money:"Orange Money",myzaka:"MyZaka",cash:"Cash",bank_transfer:"Bank Transfer"}[u]||u;return k.text(`via ${T}`,v,F+20),F=190,b(v,F,138,F,x.lightGray,.3),F=198,k.setFontSize(6),k.setTextColor(x.gray),k.setFont("helvetica","normal"),k.text(h.phone,v,F),k.text(h.email,74,F,{align:"center"}),k.text(h.website,138,F,{align:"right"}),F=203,k.setFontSize(5),k.text("Please arrive at the station 30 minutes before departure. This ticket is non-transferable.",74,F,{align:"center"}),k},_=async t=>{try{const e=await m(t),n=`GOGOBUS-Ticket-${t.booking_reference}.pdf`;return e.save(n),{success:!0,filename:n}}catch(n){return e("PDF generation error",n),{success:!1,error:n.message}}},w=async t=>{try{const e=await m(t);return{success:!0,blob:e.output("blob")}}catch(n){return e("PDF blob error",n),{success:!1,error:n.message}}},g=async t=>{try{const e=await m(t);return e.autoPrint(),window.open(e.output("bloburl"),"_blank"),{success:!0}}catch(n){return e("Print error",n),{success:!1,error:n.message}}},y="_buttonGroup_1nzce_8",p="_btn_1nzce_17",k="_primary_1nzce_38",j="_secondary_1nzce_50",v="_minimalBtn_1nzce_64",F="_card_1nzce_88",b="_cardHeader_1nzce_96",f="_cardText_1nzce_110",C="_cardActions_1nzce_117",S="_errorMessage_1nzce_133",N="_errorToast_1nzce_145",T="_spinner_1nzce_177",z=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7 10 12 15 17 10"}),s.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),B=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),s.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),s.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]}),D=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"18",cy:"5",r:"3"}),s.jsx("circle",{cx:"6",cy:"12",r:"3"}),s.jsx("circle",{cx:"18",cy:"19",r:"3"}),s.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),s.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),$=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),s.jsx("polyline",{points:"22,6 12,13 2,6"})]}),R=()=>s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:T,children:s.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),P=()=>s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M20 6 9 17l-5-5"})}),G=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),s.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]});function L({bookingData:t,variant:n="button",showPrint:o=!0,showShare:r=!0,showEmail:a=!1,className:l=""}){const[c,d]=i.useState(!1),[u,h]=i.useState(!1),[x,m]=i.useState(!1),[T,L]=i.useState(null),[E,A]=i.useState(""),O=(e,t="")=>{L(e),A(t),setTimeout(()=>{L(null),A("")},3e3)},U=async()=>{if(!c&&t){d(!0);try{const e=await _(t);if(!e.success)throw new Error(e.error);O("success")}catch(n){e("Download error",n),O("error",n.message||"Download failed")}finally{d(!1)}}},V=async()=>{if(!u&&t){h(!0);try{const e=await g(t);if(!e.success)throw new Error(e.error)}catch(n){e("Print error",n),O("error",n.message||"Print failed")}finally{h(!1)}}};return"minimal"===n?s.jsx("button",{className:`${v} ${l}`,onClick:U,disabled:c,children:c?s.jsx(R,{}):s.jsx(z,{})}):"card"===n?s.jsxs("div",{className:`${F} ${l}`,children:[s.jsxs("div",{className:b,children:[s.jsx(z,{}),s.jsx("span",{children:"Download Your Ticket"})]}),s.jsx("p",{className:f,children:"Get your e-ticket as a PDF file. You can print it or show it on your phone."}),s.jsxs("div",{className:C,children:[s.jsx("button",{className:`${p} ${k}`,onClick:U,disabled:c,children:c?s.jsxs(s.Fragment,{children:[s.jsx(R,{}),"Generating..."]}):"success"===T?s.jsxs(s.Fragment,{children:[s.jsx(P,{}),"Downloaded!"]}):s.jsxs(s.Fragment,{children:[s.jsx(z,{}),"Download PDF"]})}),o&&s.jsxs("button",{className:`${p} ${j}`,onClick:V,disabled:u,children:[u?s.jsx(R,{}):s.jsx(B,{}),"Print"]})]}),"error"===T&&s.jsxs("div",{className:S,children:[s.jsx(G,{}),E||"Something went wrong"]})]}):s.jsxs("div",{className:`${y} ${l}`,children:[s.jsx("button",{className:`${p} ${k}`,onClick:U,disabled:c,children:c?s.jsxs(s.Fragment,{children:[s.jsx(R,{}),"Generating..."]}):"success"===T?s.jsxs(s.Fragment,{children:[s.jsx(P,{}),"Downloaded!"]}):s.jsxs(s.Fragment,{children:[s.jsx(z,{}),"Download Ticket"]})}),o&&s.jsx("button",{className:`${p} ${j}`,onClick:V,disabled:u,title:"Print ticket",children:u?s.jsx(R,{}):s.jsx(B,{})}),r&&s.jsx("button",{className:`${p} ${j}`,onClick:async()=>{var n,i,s,o;if(!x&&t){m(!0);try{if(navigator.share){const e={title:`GOGOBUS Ticket - ${t.booking_reference}`,text:`My bus ticket: ${null==(i=null==(n=t.trips)?void 0:n.routes)?void 0:i.origin} â†’ ${null==(o=null==(s=t.trips)?void 0:s.routes)?void 0:o.destination}. Booking ref: ${t.booking_reference}`,url:window.location.href};if(navigator.canShare&&navigator.canShare({files:[]})){const{blob:n}=await w(t);if(n){const i=new File([n],`GOGOBUS-Ticket-${t.booking_reference}.pdf`,{type:"application/pdf"});e.files=[i]}}await navigator.share(e),O("success")}else await navigator.clipboard.writeText(window.location.href),O("success")}catch(r){"AbortError"!==r.name&&(e("Share error",r),O("error","Share failed"))}finally{m(!1)}}},disabled:x,title:"Share ticket",children:x?s.jsx(R,{}):s.jsx(D,{})}),a&&s.jsx("button",{className:`${p} ${j}`,onClick:async()=>{var e,n,i,s,o;if(!t)return;const r=encodeURIComponent(`GOGOBUS Ticket - ${t.booking_reference}`),a=encodeURIComponent(`My GOGOBUS ticket:\n\nRoute: ${null==(n=null==(e=t.trips)?void 0:e.routes)?void 0:n.origin} â†’ ${null==(s=null==(i=t.trips)?void 0:i.routes)?void 0:s.destination}\nDate: ${new Date(null==(o=t.trips)?void 0:o.departure_time).toLocaleDateString()}\nBooking Reference: ${t.booking_reference}\nSeat: ${t.seat_number}\n\nView ticket: ${window.location.href}`);window.location.href=`mailto:?subject=${r}&body=${a}`},title:"Email ticket",children:s.jsx($,{})}),"error"===T&&s.jsxs("div",{className:N,children:[s.jsx(G,{}),E||"Something went wrong"]})]})}const E={ticketViewScreen:"_ticketViewScreen_1wylw_1",loadingContainer:"_loadingContainer_1wylw_8",errorContainer:"_errorContainer_1wylw_9",ticketViewHeader:"_ticketViewHeader_1wylw_23",backButton:"_backButton_1wylw_30",ticketViewContent:"_ticketViewContent_1wylw_54",ticketCard:"_ticketCard_1wylw_59",ticketHeader:"_ticketHeader_1wylw_66",companyInfo:"_companyInfo_1wylw_75",companyLogo:"_companyLogo_1wylw_81",companyName:"_companyName_1wylw_85",bookingRef:"_bookingRef_1wylw_93",statusBadge:"_statusBadge_1wylw_99",confirmed:"_confirmed_1wylw_108",cancelled:"_cancelled_1wylw_113",ticketRoute:"_ticketRoute_1wylw_118",routePoint:"_routePoint_1wylw_128",city:"_city_1wylw_135",time:"_time_1wylw_142",routeLine:"_routeLine_1wylw_148",arrow:"_arrow_1wylw_156",duration:"_duration_1wylw_162",ticketDetails:"_ticketDetails_1wylw_168",detailRow:"_detailRow_1wylw_172",price:"_price_1wylw_194",ticketDownloadSection:"_ticketDownloadSection_1wylw_200",ticketActions:"_ticketActions_1wylw_205"},A=()=>{var t,n;const{id:h}=o(),x=r(),{user:m}=a(),[_,w]=i.useState(null),[g,y]=i.useState(!0),[p,k]=i.useState(!1),[j,v]=i.useState("");i.useEffect(()=>{(async()=>{if(null==m?void 0:m.id){y(!0);try{const e=(await c.getUserBookings(m.id)).find(e=>e.id===h);e?w(e):v("Ticket not found")}catch(t){e("Failed to load booking",t),v("Failed to load ticket. Please try again.")}finally{y(!1)}}})()},[h,m]);if(g)return s.jsx("div",{className:E.loadingContainer,children:s.jsx(l,{size:"large"})});if(j||!_)return s.jsxs("div",{className:E.errorContainer,children:[s.jsx("p",{children:j||"Ticket not found"}),s.jsx(d,{onClick:()=>x("/tickets"),children:"Back to Tickets"})]});const F=_.schedule||{},b=F.route||{},f=F.bus||{},C=f.company||{},S=_?{id:_.id,booking_reference:_.booking_reference||`BK${_.id.substring(0,8).toUpperCase()}`,passenger_name:_.passenger_name||(null==(N=_.user)?void 0:N.name)||"Passenger",passenger_phone:_.passenger_phone||(null==(T=_.user)?void 0:T.phone)||"",passenger_email:_.passenger_email||(null==(z=_.user)?void 0:z.email)||"",seat_number:(null==(B=_.seats)?void 0:B[0])||_.seat_number||"N/A",total_amount:_.total_price||_.total_amount||0,payment_status:_.payment_status||_.status||"pending",payment_method:_.payment_method||"card",trips:{departure_time:F.departure_time||_.created_at,arrival_time:F.arrival_time,price:F.price||_.total_price||0,routes:{origin:b.origin||"",destination:b.destination||"",distance_km:b.distance_km,duration_minutes:b.duration_minutes},buses:f||{}}}:null;var N,T,z,B;return s.jsxs("div",{className:E.ticketViewScreen,children:[s.jsxs("div",{className:E.ticketViewHeader,children:[s.jsx("button",{className:E.backButton,onClick:()=>x("/tickets"),children:"â† Back"}),s.jsx("h1",{children:"Ticket Details"})]}),s.jsx("div",{className:E.ticketViewContent,children:s.jsxs("div",{className:E.ticketCard,children:[s.jsxs("div",{className:E.ticketHeader,children:[s.jsxs("div",{className:E.companyInfo,children:[s.jsx("span",{className:E.companyLogo,children:C.logo||"ðŸšŒ"}),s.jsxs("div",{children:[s.jsx("div",{className:E.companyName,children:C.name||"Bus Company"}),s.jsxs("div",{className:E.bookingRef,children:["Booking #",_.id]})]})]}),s.jsx("div",{className:`${E.statusBadge} ${E[_.status]}`,children:_.status||"confirmed"})]}),s.jsxs("div",{className:E.ticketRoute,children:[s.jsxs("div",{className:E.routePoint,children:[s.jsx("span",{className:E.city,children:b.origin||"Origin"}),s.jsx("span",{className:E.time,children:F.departure_time||"N/A"})]}),s.jsxs("div",{className:E.routeLine,children:[s.jsx("span",{className:E.arrow,children:"â†’"}),s.jsx("span",{className:E.duration,children:F.duration||"N/A"})]}),s.jsxs("div",{className:E.routePoint,children:[s.jsx("span",{className:E.city,children:b.destination||"Destination"}),s.jsx("span",{className:E.time,children:F.arrival_time||"N/A"})]})]}),s.jsxs("div",{className:E.ticketDetails,children:[s.jsxs("div",{className:E.detailRow,children:[s.jsx("span",{children:"Date"}),s.jsx("span",{children:(e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})(F.departure_time||_.created_at)})]}),s.jsxs("div",{className:E.detailRow,children:[s.jsx("span",{children:"Seats"}),s.jsx("span",{children:(null==(t=_.seats)?void 0:t.join(", "))||"N/A"})]}),s.jsxs("div",{className:E.detailRow,children:[s.jsx("span",{children:"Total Price"}),s.jsxs("span",{className:E.price,children:["P",(null==(n=_.total_price)?void 0:n.toFixed(2))||"0.00"]})]})]}),s.jsx(u,{bookingId:_.id,route:b,seats:_.seats}),S&&s.jsx("div",{className:E.ticketDownloadSection,children:s.jsx(L,{bookingData:S,variant:"card",showPrint:!0,showShare:!0,showEmail:!1})}),"cancelled"!==_.status&&s.jsx("div",{className:E.ticketActions,children:s.jsx(d,{variant:"outline",onClick:async()=>{if(window.confirm("Are you sure you want to cancel this booking?")){k(!0);try{await c.cancelBooking(h),w(e=>({...e,status:"cancelled"})),alert("Booking cancelled successfully")}catch(t){e("Failed to cancel booking",t),alert("Failed to cancel booking. Please try again.")}finally{k(!1)}}},disabled:p,children:p?"Cancelling...":"Cancel Booking"})})]})})]})};export{A as default};
