const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BKhXCF24.js","assets/index-FXjg0z6j.css"])))=>i.map(i=>d[i]);
import{R as e,j as s,u as t,k as a,i as r,c as i,m as n,r as l,_ as o}from"./index-BKhXCF24.js";import{b as c}from"./bookingService-Dkbri9jD.js";import{B as d}from"./Button-DBYBD_di.js";import"./validation-DjNTQiWP.js";var h={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},u=e.createContext&&e.createContext(h),j=function(){return j=Object.assign||function(e){for(var s,t=1,a=arguments.length;t<a;t++)for(var r in s=arguments[t])Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);return e},j.apply(this,arguments)};function _(s){return s&&s.map(function(s,t){return e.createElement(s.tag,j({key:t},s.attr),_(s.child))})}function m(s){return function(t){return e.createElement(x,j({attr:j({},s.attr)},t),_(s.child))}}function x(s){var t=function(t){var a,r=s.attr,i=s.size,n=s.title,l=function(e,s){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)s.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(t[a[r]]=e[a[r]])}return t}(s,["attr","size","title"]),o=i||t.size||"1em";return t.className&&(a=t.className),s.className&&(a=(a?a+" ":"")+s.className),e.createElement("svg",j({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,l,{className:a,style:j(j({color:s.color||t.color},t.style),s.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),n&&e.createElement("title",null,n),s.children)};return void 0!==u?e.createElement(u.Consumer,null,function(e){return t(e)}):t(h)}function p(e){return m({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"}}]})(e)}const v="_overlay_aw24v_1",g="_content_aw24v_15",b="_header_aw24v_25",N="_title_aw24v_33",f="_body_aw24v_41",k=({isOpen:e,onClose:t,children:a,title:r})=>e?s.jsx("div",{className:v,onClick:t,children:s.jsxs("div",{className:g,onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:b,children:[r&&s.jsx("h2",{className:N,children:r}),s.jsx(d,{variant:"ghost",size:"small",onClick:t,"aria-label":"Close modal",children:s.jsx(p,{})})]}),s.jsx("div",{className:f,children:a})]})}):null,w={page:"_page_jhu0l_6",header:"_header_jhu0l_14",backBtn:"_backBtn_jhu0l_26",headerContent:"_headerContent_jhu0l_43",loading:"_loading_jhu0l_57",error:"_error_jhu0l_58",spinner:"_spinner_jhu0l_63",spin:"_spin_jhu0l_63",content:"_content_jhu0l_100",tripInfo:"_tripInfo_jhu0l_108",tripRoute:"_tripRoute_jhu0l_115",routeOrigin:"_routeOrigin_jhu0l_123",routeDest:"_routeDest_jhu0l_124",routeArrow:"_routeArrow_jhu0l_130",tripMeta:"_tripMeta_jhu0l_135",legend:"_legend_jhu0l_157",legendItem:"_legendItem_jhu0l_164",legendSeat:"_legendSeat_jhu0l_172",available:"_available_jhu0l_178",selected:"_selected_jhu0l_183",unavailable:"_unavailable_jhu0l_188",busContainer:"_busContainer_jhu0l_195",busFront:"_busFront_jhu0l_203",driver:"_driver_jhu0l_212",door:"_door_jhu0l_224",seatMap:"_seatMap_jhu0l_234",seatRow:"_seatRow_jhu0l_240",rowNumber:"_rowNumber_jhu0l_246",rowSeats:"_rowSeats_jhu0l_254",seatGroup:"_seatGroup_jhu0l_262",aisle:"_aisle_jhu0l_267",seat:"_seat_jhu0l_234",busBack:"_busBack_jhu0l_318",summary:"_summary_jhu0l_332",selectedSeats:"_selectedSeats_jhu0l_338",summaryLabel:"_summaryLabel_jhu0l_342",seatTags:"_seatTags_jhu0l_350",seatTag:"_seatTag_jhu0l_350",noSeats:"_noSeats_jhu0l_384",priceBreakdown:"_priceBreakdown_jhu0l_392",priceRow:"_priceRow_jhu0l_397",total:"_total_jhu0l_406",bottomAction:"_bottomAction_jhu0l_417",actionInfo:"_actionInfo_jhu0l_431",actionSeats:"_actionSeats_jhu0l_437",actionPrice:"_actionPrice_jhu0l_442",continueBtn:"_continueBtn_jhu0l_448"},y=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"m12 19-7-7 7-7"}),s.jsx("path",{d:"M19 12H5"})]}),S=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("circle",{cx:"12",cy:"12",r:"2"}),s.jsx("path",{d:"M12 2v8"}),s.jsx("path",{d:"m4.93 10.93 6.36 2.54"}),s.jsx("path",{d:"m19.07 10.93-6.36 2.54"})]}),C=()=>s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M20 6 9 17l-5-5"})}),B=()=>s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M18 6 6 18M6 6l12 12"})}),L=()=>s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("polyline",{points:"12 6 12 12 16 14"})]}),O=()=>s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),s.jsx("circle",{cx:"12",cy:"10",r:"3"})]});function I(){var e,d;const h=t(),{tripId:u}=a(),[j]=r(),_=parseInt(j.get("passengers")||"1"),{isAuthenticated:m,isEmailVerified:x,user:p}=i(),{setSelectedSeats:v,setSelectedRoute:g}=n(),[b,N]=l.useState(null),[f,I]=l.useState([]),[P,R]=l.useState([]),[E,T]=l.useState(!0),[A,$]=l.useState(null),[M,D]=l.useState(!1);l.useEffect(()=>{u&&(async()=>{T(!0);try{const{data:e,error:s}=await c.getTripById(u);if(s)throw s;N(e),I((null==e?void 0:e.seats)||[])}catch(e){const{logError:s}=await o(async()=>{const{logError:e}=await import("./index-BKhXCF24.js").then(e=>e.B);return{logError:e}},__vite__mapDeps([0,1]));s("Fetch error in SeatSelection",e),$(e.message||"Failed to load trip")}finally{T(!1)}})()},[u]);const F=e=>{e.is_available&&R(s=>s.some(s=>s.id===e.id)?s.filter(s=>s.id!==e.id):s.length>=_?[...s.slice(1),e]:[...s,e])},W=(null==b?void 0:b.price)||0,z=W*P.length,G=Math.round(.05*z*100)/100,V=z+G,q=(()=>{if(!f.length)return[];const e={};return f.forEach(s=>{const t=s.seat_row;e[t]||(e[t]=[]),e[t].push(s)}),Object.keys(e).forEach(s=>{e[s].sort((e,s)=>e.seat_column.localeCompare(s.seat_column))}),Object.entries(e).sort(([e],[s])=>parseInt(e)-parseInt(s))})(),H=e=>e.is_available?P.some(s=>s.id===e.id)?"selected":"available":"unavailable";return E?s.jsx("div",{className:w.page,children:s.jsxs("div",{className:w.loading,children:[s.jsx("div",{className:w.spinner}),s.jsx("p",{children:"Loading seat map..."})]})}):A||!b?s.jsx("div",{className:w.page,children:s.jsxs("div",{className:w.error,children:[s.jsx("h2",{children:"Something went wrong"}),s.jsx("p",{children:A||"Trip not found"}),s.jsx("button",{onClick:()=>h(-1),children:"Go Back"})]})}):s.jsxs("div",{className:w.page,children:[s.jsxs("header",{className:w.header,children:[s.jsx("button",{className:w.backBtn,onClick:()=>h(-1),children:s.jsx(y,{})}),s.jsxs("div",{className:w.headerContent,children:[s.jsx("h1",{children:"Select Your Seats"}),s.jsxs("p",{children:["Choose ",_," ",1===_?"seat":"seats"]})]})]}),s.jsxs("div",{className:w.content,children:[s.jsxs("div",{className:w.tripInfo,children:[s.jsxs("div",{className:w.tripRoute,children:[s.jsx("span",{className:w.routeOrigin,children:null==(e=b.routes)?void 0:e.origin}),s.jsx("span",{className:w.routeArrow,children:"→"}),s.jsx("span",{className:w.routeDest,children:null==(d=b.routes)?void 0:d.destination})]}),s.jsxs("div",{className:w.tripMeta,children:[s.jsxs("span",{children:[s.jsx(L,{})," ",(Y=b.departure_time,Y?new Date(Y).toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit"}):"N/A")]}),s.jsxs("span",{children:[s.jsx(O,{})," ",(e=>e?new Date(e).toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short"}):"N/A")(b.departure_time)]})]})]}),s.jsxs("div",{className:w.legend,children:[s.jsxs("div",{className:w.legendItem,children:[s.jsx("div",{className:`${w.legendSeat} ${w.available}`}),s.jsx("span",{children:"Available"})]}),s.jsxs("div",{className:w.legendItem,children:[s.jsx("div",{className:`${w.legendSeat} ${w.selected}`}),s.jsx("span",{children:"Selected"})]}),s.jsxs("div",{className:w.legendItem,children:[s.jsx("div",{className:`${w.legendSeat} ${w.unavailable}`}),s.jsx("span",{children:"Taken"})]})]}),s.jsxs("div",{className:w.busContainer,children:[s.jsxs("div",{className:w.busFront,children:[s.jsxs("div",{className:w.driver,children:[s.jsx(S,{}),s.jsx("span",{children:"Driver"})]}),s.jsx("div",{className:w.door,children:"Door"})]}),s.jsx("div",{className:w.seatMap,children:q.map(([e,t])=>s.jsxs("div",{className:w.seatRow,children:[s.jsx("div",{className:w.rowNumber,children:e}),s.jsxs("div",{className:w.rowSeats,children:[s.jsx("div",{className:w.seatGroup,children:t.filter(e=>["A","B"].includes(e.seat_column)).map(e=>s.jsx("button",{className:`${w.seat} ${w[H(e)]}`,onClick:()=>F(e),disabled:!e.is_available,children:"selected"===H(e)?s.jsx(C,{}):"unavailable"===H(e)?s.jsx(B,{}):s.jsx("span",{children:e.seat_number})},e.id))}),s.jsx("div",{className:w.aisle}),s.jsx("div",{className:w.seatGroup,children:t.filter(e=>["C","D"].includes(e.seat_column)).map(e=>s.jsx("button",{className:`${w.seat} ${w[H(e)]}`,onClick:()=>F(e),disabled:!e.is_available,children:"selected"===H(e)?s.jsx(C,{}):"unavailable"===H(e)?s.jsx(B,{}):s.jsx("span",{children:e.seat_number})},e.id))})]})]},e))}),s.jsx("div",{className:w.busBack,children:s.jsx("span",{children:"Back of Bus"})})]}),s.jsxs("div",{className:w.summary,children:[s.jsxs("div",{className:w.selectedSeats,children:[s.jsx("span",{className:w.summaryLabel,children:"Selected Seats:"}),s.jsx("div",{className:w.seatTags,children:P.length>0?P.map(e=>s.jsxs("span",{className:w.seatTag,children:[e.seat_number,s.jsx("button",{onClick:()=>F(e),children:s.jsx(B,{})})]},e.id)):s.jsx("span",{className:w.noSeats,children:"No seats selected"})})]}),P.length>0&&s.jsxs("div",{className:w.priceBreakdown,children:[s.jsxs("div",{className:w.priceRow,children:[s.jsxs("span",{children:["P",W," × ",P.length," ",1===P.length?"seat":"seats"]}),s.jsxs("span",{children:["P",z.toFixed(2)]})]}),s.jsxs("div",{className:w.priceRow,children:[s.jsx("span",{children:"Service fee"}),s.jsxs("span",{children:["P",G.toFixed(2)]})]}),s.jsxs("div",{className:`${w.priceRow} ${w.total}`,children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:["P",V.toFixed(2)]})]})]})]})]}),s.jsxs("div",{className:w.bottomAction,children:[s.jsxs("div",{className:w.actionInfo,children:[s.jsxs("span",{className:w.actionSeats,children:[P.length,"/",_," seats"]}),s.jsxs("span",{className:w.actionPrice,children:["P",V.toFixed(2)]})]}),s.jsx("button",{className:w.continueBtn,onClick:e=>{(()=>{var e,s;if(!(P.length<_))if(m)if(x)try{const t=P.map(e=>e.seat_number);v(t),b&&g({id:b.id,origin:null==(e=b.routes)?void 0:e.origin,destination:null==(s=b.routes)?void 0:s.destination,departure_time:b.departure_time,arrival_time:b.arrival_time,duration:b.duration,price:b.price}),setTimeout(()=>{h("/booking/passenger-details")},0)}catch(t){}else D(!0);else h("/login",{state:{returnTo:`/booking/seats/${u}?passengers=${_}`}})})()},disabled:P.length<_,children:"Continue"})]}),s.jsx(k,{isOpen:M,onClose:()=>D(!1),title:"Email Verification Required",children:s.jsxs("div",{style:{padding:"1rem"},children:[s.jsx("p",{children:"Please verify your email address before making a booking."}),s.jsxs("p",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#666"},children:["A verification email has been sent to ",null==p?void 0:p.email,". Please check your inbox and click the verification link."]}),s.jsxs("div",{style:{marginTop:"1.5rem",display:"flex",gap:"0.5rem"},children:[s.jsx("button",{onClick:()=>D(!1),style:{flex:1,padding:"0.75rem",border:"1px solid #ddd",borderRadius:"8px",background:"white",cursor:"pointer"},children:"Close"}),s.jsx("button",{onClick:()=>{D(!1),h("/profile")},style:{flex:1,padding:"0.75rem",border:"none",borderRadius:"8px",background:"#F5A623",color:"white",cursor:"pointer"},children:"Go to Profile"})]})]})})]});var Y}export{I as default};
