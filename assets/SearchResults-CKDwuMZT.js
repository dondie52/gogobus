import{u as e,i as s,r as a,j as t,d as i,b as n}from"./index-CHY3DGCF.js";import{b as r}from"./bookingService-KwW7s8KF.js";import"./validation-DjNTQiWP.js";const l="_searchPage_1pt2a_6",o="_header_1pt2a_13",d="_backBtn_1pt2a_25",c="_headerContent_1pt2a_42",h="_headerTitle_1pt2a_46",p="_headerMeta_1pt2a_53",u="_modifyBtn_1pt2a_71",x="_filters_1pt2a_88",_="_filterGroup_1pt2a_98",j="_resultsCount_1pt2a_120",m="_content_1pt2a_128",v="_loading_1pt2a_136",g="_spinner_1pt2a_141",b="_error_1pt2a_161",f="_empty_1pt2a_162",y="_tripsList_1pt2a_213",N="_tripCard_1pt2a_219",k="_tripMain_1pt2a_232",w="_tripTimes_1pt2a_242",S="_timeBlock_1pt2a_248",I="_time_1pt2a_248",T="_city_1pt2a_260",C="_duration_1pt2a_265",B="_durationLine_1pt2a_273",L="_durationDot_1pt2a_279",D="_durationDash_1pt2a_287",O="_busInfo_1pt2a_312",P="_busName_1pt2a_316",M="_busType_1pt2a_323",W="_amenities_1pt2a_330",A="_amenity_1pt2a_335",R="_seatsInfo_1pt2a_348",$="_seatsCount_1pt2a_353",J="_low_1pt2a_363",H="_priceAction_1pt2a_370",E="_price_1pt2a_370",q="_priceAmount_1pt2a_382",F="_priceLabel_1pt2a_389",G="_selectBtn_1pt2a_394",U="_lowSeatsWarning_1pt2a_422",V=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"m12 19-7-7 7-7"}),t.jsx("path",{d:"M19 12H5"})]}),Z=()=>t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M8 6v6m8-6v6M5 18v2m14-2v2M3 6h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6ZM3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2"}),t.jsx("circle",{cx:"7",cy:"15",r:"1"}),t.jsx("circle",{cx:"17",cy:"15",r:"1"})]}),z=()=>t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),t.jsx("circle",{cx:"9",cy:"7",r:"4"})]}),K=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M5 12.55a11 11 0 0 1 14.08 0"}),t.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),t.jsx("circle",{cx:"12",cy:"20",r:"1"})]}),Q=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),t.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"22"}),t.jsx("path",{d:"m20 16-4-4 4-4"}),t.jsx("path",{d:"m4 8 4 4-4 4"}),t.jsx("path",{d:"m16 4-4 4-4-4"}),t.jsx("path",{d:"m8 20 4-4 4 4"})]}),X=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M18.36 6.64a9 9 0 1 1-12.73 0"}),t.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"12"})]}),Y=()=>t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"m9 18 6-6-6-6"})}),ee=()=>t.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),se=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),t.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),t.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),t.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),ae=({type:e})=>({wifi:t.jsx(K,{}),ac:t.jsx(Q,{}),power:t.jsx(X,{})}[e]||null);function te(){const K=e(),[Q]=s(),X=Q.get("from")||"",te=Q.get("to")||"",ie=Q.get("date")||"",ne=parseInt(Q.get("passengers")||"1"),[re,le]=a.useState([]),[oe,de]=a.useState(!0),[ce,he]=a.useState(null),[pe,ue]=a.useState("departure"),[xe,_e]=a.useState("all");a.useEffect(()=>{(async()=>{if(!X||!te||!ie)return he("Invalid search parameters"),void de(!1);de(!0),he(null);try{const{data:e,error:s}=await r.searchTrips({origin:X,destination:te,date:ie,passengers:ne});if(s)throw s;fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SearchResults.jsx:108",message:"Trips loaded",data:{tripsCount:(null==e?void 0:e.length)||0,tripIds:null==e?void 0:e.map(e=>null==e?void 0:e.id).filter(Boolean),tripsWithIds:null==e?void 0:e.filter(e=>null==e?void 0:e.id).length,tripsWithoutIds:null==e?void 0:e.filter(e=>!(null==e?void 0:e.id)).length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),le(e||[])}catch(e){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SearchResults.jsx:117",message:"Search error occurred",data:{errorMessage:null==e?void 0:e.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),n("Search error",e),he(e.message||"Failed to search trips")}finally{de(!1)}})()},[X,te,ie,ne]);const je=[...re].filter(e=>{var s;return"all"===xe||(null==(s=e.buses)?void 0:s.bus_type)===xe}).sort((e,s)=>{var a,t;switch(pe){case"price":return e.price-s.price;case"duration":return((null==(a=e.routes)?void 0:a.duration_minutes)||0)-((null==(t=s.routes)?void 0:t.duration_minutes)||0);default:return new Date(e.departure_time)-new Date(s.departure_time)}}),me=e=>new Date(e).toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit"}),ve=e=>new Date(e).toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short"}),ge=e=>{if(!e)return"N/A";return`${Math.floor(e/60)}h ${e%60}m`},be=[...new Set(re.map(e=>{var s;return null==(s=e.buses)?void 0:s.bus_type}).filter(Boolean))];return t.jsxs("div",{className:l,children:[t.jsxs("header",{className:o,children:[t.jsx("button",{className:d,onClick:e=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SearchResults.jsx:196",message:"Back button clicked",data:{currentPath:window.location.pathname},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),window.history.length>1?K(-1):K("/home")},children:t.jsx(V,{})}),t.jsxs("div",{className:c,children:[t.jsxs("h1",{className:h,children:[X," → ",te]}),t.jsxs("div",{className:p,children:[t.jsxs("span",{children:[t.jsx(se,{})," ",ve(ie)]}),t.jsxs("span",{children:[t.jsx(z,{})," ",ne," ",1===ne?"Passenger":"Passengers"]})]})]}),t.jsx(i,{to:"/",className:u,children:"Modify"})]}),re.length>0&&t.jsxs("div",{className:x,children:[t.jsxs("div",{className:_,children:[t.jsx("label",{children:"Sort by:"}),t.jsxs("select",{value:pe,onChange:e=>ue(e.target.value),children:[t.jsx("option",{value:"departure",children:"Departure Time"}),t.jsx("option",{value:"price",children:"Price (Low to High)"}),t.jsx("option",{value:"duration",children:"Duration"})]})]}),be.length>1&&t.jsxs("div",{className:_,children:[t.jsx("label",{children:"Bus Type:"}),t.jsxs("select",{value:xe,onChange:e=>_e(e.target.value),children:[t.jsx("option",{value:"all",children:"All Types"}),be.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:j,children:[je.length," ",1===je.length?"bus":"buses"," found"]})]}),t.jsx("div",{className:m,children:oe?t.jsxs("div",{className:v,children:[t.jsx("div",{className:g}),t.jsx("p",{children:"Searching for available buses..."})]}):ce?t.jsxs("div",{className:b,children:[t.jsx(ee,{}),t.jsx("h2",{children:"Oops! Something went wrong"}),t.jsx("p",{children:ce}),t.jsx("button",{onClick:()=>K("/"),children:"Back to Search"})]}):0===je.length?t.jsxs("div",{className:f,children:[t.jsx(Z,{}),t.jsx("h2",{children:"No buses found"}),t.jsxs("p",{children:["No buses available from ",X," to ",te," on ",ve(ie),". Try a different date or route."]}),t.jsx("button",{onClick:()=>K("/"),children:"Search Again"})]}):t.jsx("div",{className:y,children:je.map(e=>{var s,a,i,n,r;const l=e.available_seats<ne;return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SearchResults.jsx:252",message:"Rendering trip card",data:{tripId:null==e?void 0:e.id,availableSeats:null==e?void 0:e.available_seats,passengers:ne,isButtonDisabled:l,hasTripId:!!(null==e?void 0:e.id)},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(()=>{}),t.jsxs("div",{className:N,children:[t.jsxs("div",{className:k,children:[t.jsxs("div",{className:w,children:[t.jsxs("div",{className:S,children:[t.jsx("span",{className:I,children:me(e.departure_time)}),t.jsx("span",{className:T,children:X})]}),t.jsxs("div",{className:C,children:[t.jsxs("div",{className:B,children:[t.jsx("div",{className:L}),t.jsx("div",{className:D}),t.jsx(Z,{}),t.jsx("div",{className:D}),t.jsx("div",{className:L})]}),t.jsx("span",{children:ge(null==(s=e.routes)?void 0:s.duration_minutes)})]}),t.jsxs("div",{className:S,children:[t.jsx("span",{className:I,children:e.arrival_time?me(e.arrival_time):"~"+me(new Date(new Date(e.departure_time).getTime()+6e4*((null==(a=e.routes)?void 0:a.duration_minutes)||0)))}),t.jsx("span",{className:T,children:te})]})]}),t.jsxs("div",{className:O,children:[t.jsx("div",{className:P,children:(null==(i=e.buses)?void 0:i.bus_name)||"Standard Bus"}),t.jsx("div",{className:M,children:(null==(n=e.buses)?void 0:n.bus_type)||"standard"}),(null==(r=e.buses)?void 0:r.amenities)&&e.buses.amenities.length>0&&t.jsx("div",{className:W,children:e.buses.amenities.map(e=>t.jsx("span",{className:A,title:e,children:t.jsx(ae,{type:e})},e))})]}),t.jsx("div",{className:R,children:t.jsxs("span",{className:`${$} ${e.available_seats<=5?J:""}`,children:[e.available_seats," ",1===e.available_seats?"seat":"seats"," left"]})}),t.jsxs("div",{className:H,children:[t.jsxs("div",{className:E,children:[t.jsx("span",{className:q,children:(o=e.price,`P${o}`)}),t.jsx("span",{className:F,children:"per person"})]}),t.jsxs("button",{className:G,type:"button","data-trip-id":e.id,onClick:s=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SearchResults.jsx:349",message:"Select button onClick handler called",data:{tripId:null==e?void 0:e.id,availableSeats:null==e?void 0:e.available_seats,passengers:ne,isDisabled:(null==e?void 0:e.available_seats)<ne},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),s.stopPropagation(),(e=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SearchResults.jsx:169",message:"handleSelectTrip called",data:{tripId:null==e?void 0:e.id,tripIdType:typeof(null==e?void 0:e.id),passengers:ne,passengersType:typeof ne,availableSeats:null==e?void 0:e.available_seats,isDisabled:(null==e?void 0:e.available_seats)<ne},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SearchResults.jsx:170",message:"Before navigation",data:{tripId:null==e?void 0:e.id,passengers:ne,navigationUrl:`/booking/seats/${null==e?void 0:e.id}?passengers=${ne}`,hasTripId:!!(null==e?void 0:e.id),hasPassengers:!!ne},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),K(`/booking/seats/${e.id}?passengers=${ne}`),fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SearchResults.jsx:172",message:"After navigate call",data:{tripId:null==e?void 0:e.id,passengers:ne},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{})})(e)},disabled:e.available_seats<ne,children:["Select",t.jsx(Y,{style:{pointerEvents:"none"}})]})]})]}),e.available_seats<=5&&e.available_seats>=ne&&t.jsxs("div",{className:U,children:["⚡ Only ",e.available_seats," seats remaining - Book now!"]})]},e.id);var o})})})]})}export{te as default};
