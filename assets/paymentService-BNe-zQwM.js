import{c as e,M as t,y as a,z as n,l as o,s as r,b as s,A as i,B as c,v as d,f as m,D as u}from"./index-xoP6dWRh.js";const l={NETWORK_ERROR:"NETWORK_ERROR",TIMEOUT:"TIMEOUT",CONNECTION_FAILED:"CONNECTION_FAILED",INSUFFICIENT_FUNDS:"INSUFFICIENT_FUNDS",PAYMENT_CANCELLED:"PAYMENT_CANCELLED",PAYMENT_FAILED:"PAYMENT_FAILED",INVALID_CARD:"INVALID_CARD",EXPIRED_CARD:"EXPIRED_CARD",DECLINED:"DECLINED",DPO_INVALID_TOKEN:"DPO_INVALID_TOKEN",DPO_EXPIRED_TOKEN:"DPO_EXPIRED_TOKEN",DPO_INVALID_AMOUNT:"DPO_INVALID_AMOUNT",ORANGE_INVALID_PHONE:"ORANGE_INVALID_PHONE",ORANGE_USER_CANCELLED:"ORANGE_USER_CANCELLED",ORANGE_TIMEOUT:"ORANGE_TIMEOUT",UNKNOWN_ERROR:"UNKNOWN_ERROR",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",INVALID_REQUEST:"INVALID_REQUEST"},p={[l.NETWORK_ERROR]:"Connection failed. Please check your internet connection and try again.",[l.TIMEOUT]:"Request timed out. Please try again.",[l.CONNECTION_FAILED]:"Unable to connect to payment service. Please try again later.",[l.INSUFFICIENT_FUNDS]:"Insufficient funds. Please try another payment method or add funds to your account.",[l.PAYMENT_CANCELLED]:"Payment was cancelled. You can try again when ready.",[l.PAYMENT_FAILED]:"Payment failed. Please check your payment details and try again.",[l.INVALID_CARD]:"Invalid card details. Please check your card number and try again.",[l.EXPIRED_CARD]:"Your card has expired. Please use a different card.",[l.DECLINED]:"Payment was declined by your bank. Please contact your bank or try another payment method.",[l.DPO_INVALID_TOKEN]:"Payment session expired. Please start a new payment.",[l.DPO_EXPIRED_TOKEN]:"Payment session expired. Please start a new payment.",[l.DPO_INVALID_AMOUNT]:"Invalid payment amount. Please contact support.",[l.ORANGE_INVALID_PHONE]:"Invalid phone number. Please check your Orange Money phone number.",[l.ORANGE_USER_CANCELLED]:"Payment was cancelled. Please try again when ready.",[l.ORANGE_TIMEOUT]:"Payment timed out. Please try again.",[l.UNKNOWN_ERROR]:"An unexpected error occurred. Please try again or contact support.",[l.SERVICE_UNAVAILABLE]:"Payment service is temporarily unavailable. Please try again later.",[l.INVALID_REQUEST]:"Invalid payment request. Please check your details and try again."},y=e=>{var t;if(!e)return l.UNKNOWN_ERROR;const a=(null==(t=e.message)?void 0:t.toLowerCase())||"",n=e.toString().toLowerCase();return a.includes("network")||a.includes("fetch")||a.includes("connection")?l.NETWORK_ERROR:a.includes("timeout")||n.includes("timeout")?l.TIMEOUT:a.includes("insufficient")||a.includes("funds")?l.INSUFFICIENT_FUNDS:a.includes("cancelled")||a.includes("cancel")?l.PAYMENT_CANCELLED:a.includes("declined")||a.includes("rejected")?l.DECLINED:a.includes("expired")?l.EXPIRED_CARD:a.includes("invalid card")||a.includes("card number")?l.INVALID_CARD:a.includes("dpo")&&a.includes("token")?l.DPO_INVALID_TOKEN:a.includes("orange")&&a.includes("phone")?l.ORANGE_INVALID_PHONE:l.UNKNOWN_ERROR},f=e=>{const t=y(e);return p[t]||p[l.UNKNOWN_ERROR]},g=async(t,a,n={})=>{try{const o={error_code:y(a),error_message:a.message||a.toString(),error_stack:a.stack,context:JSON.stringify(n),created_at:(new Date).toISOString()},{error:r}=await t.from("payment_errors").insert(o);r&&e("Payment Error",o)}catch(o){e("Failed to log payment error",o)}},E={async sendBookingConfirmation(t){try{if(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Attempting to send booking confirmation email",data:{bookingId:t.bookingId,customerEmail:t.customerEmail,hasEmail:!!t.customerEmail},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),!t.customerEmail)return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"No customer email provided",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),o("Cannot send booking confirmation: no email provided"),{success:!1,error:"No email address provided"};let e,n;try{const a=await r.functions.invoke("send-booking-email",{body:{bookingId:t.bookingId,customerEmail:t.customerEmail,customerName:t.customerName||"Customer",origin:t.origin,destination:t.destination,departureTime:t.departureTime,seats:t.seats||[],totalAmount:t.totalAmount,bookingRef:t.bookingRef||t.bookingId}});e=a.data,n=a.error}catch(a){return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Edge function invoke exception (CORS/network)",data:{errorMessage:null==a?void 0:a.message,errorName:null==a?void 0:a.name},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),{success:!1,error:"Email service unavailable",warning:!0}}return n?(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Edge function error (may not exist)",data:{errorMessage:n.message,errorName:n.name},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),{success:!1,error:"Email service unavailable",warning:!0}):(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Email sent successfully",data:{bookingId:t.bookingId,customerEmail:t.customerEmail},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),s("Booking confirmation email sent",{bookingId:t.bookingId,email:t.customerEmail}),{success:!0,data:e})}catch(n){return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"emailService.js:sendBookingConfirmation",message:"Email sending exception",data:{errorMessage:null==n?void 0:n.message,errorName:null==n?void 0:n.name},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{}),e("Error sending booking confirmation email",n),{success:!1,error:n.message,warning:!0}}}},_={API_URL:"https://secure.3gdirectpay.com/API/v6/",COMPANY_TOKEN:"",SERVICE_TYPE:"",CURRENCY:"BWP",COUNTRY:"BW"},N={API_URL:"https://api.orange.com/orange-money-webpay/bw/v1",MERCHANT_KEY:"",RETURN_URL:"",CANCEL_URL:"",NOTIF_URL:""},w={SUCCESS_URL:"/booking/confirmation",CANCEL_URL:"/booking/payment",WEBHOOK_URL:"/api/payment/webhook"},I={CARD:{id:"card",name:"Credit/Debit Card",description:"Pay with Visa or Mastercard",icon:"card",enabled:!0,provider:"dpo",fees:{type:"percentage",value:2.5}},ORANGE_MONEY:{id:"orange_money",name:"Orange Money",description:"Pay with Orange Money wallet",icon:"orange",enabled:!0,provider:"orange",fees:{type:"flat",value:5}},MYZAKA:{id:"myzaka",name:"Mascom MyZaka",description:"Pay with MyZaka mobile money",icon:"myzaka",enabled:!0,provider:"dpo",fees:{type:"flat",value:5}},SMEGA:{id:"smega",name:"BTC Smega",description:"Pay with Smega mobile money",icon:"smega",enabled:!0,provider:"dpo",fees:{type:"flat",value:5}},BANK_TRANSFER:{id:"bank_transfer",name:"Bank Transfer",description:"Pay via EFT bank transfer",icon:"bank",enabled:!0,provider:"manual",fees:{type:"flat",value:0}},CASH:{id:"cash",name:"Pay at Station",description:"Pay cash at the bus station",icon:"cash",enabled:!0,provider:"manual",fees:{type:"flat",value:0}}},R=(e,t)=>{const a=I[e.toUpperCase()]||I.CARD,{fees:n}=a;return"percentage"===n.type?Math.round(t*(n.value/100)*100)/100:n.value},h=()=>`GGB-${Date.now().toString(36)}-${Math.random().toString(36).substring(2,8)}`.toUpperCase(),O=e=>Math.round(100*e),k=async t=>{try{const{data:e,error:a}=await r.from("payments").select("*").eq("transaction_ref",t).single();if(a||!e)throw new Error("Payment not found");if(!e.provider_token)throw new Error("No payment token found");const n={CompanyToken:_.COMPANY_TOKEN,Request:"verifyToken",TransactionToken:e.provider_token},o=await P("verifyToken",n);let s="pending";"000"===o.Result?s="completed":"901"===o.Result?s="failed":"904"===o.Result&&(s="cancelled");const{data:i}=await r.from("payments").update({status:s,provider_status:o.ResultExplanation,completed_at:"completed"===s?(new Date).toISOString():null}).eq("id",e.id).select().single();return"completed"===s&&await r.from("bookings").update({payment_status:"paid",payment_method:e.payment_method,payment_reference:t}).eq("id",e.booking_id),{success:"completed"===s,status:s,payment:i,message:o.ResultExplanation}}catch(a){return e("DPO Verification Error",a),await g(r,a,{action:"verifyDPOPayment",transactionRef:t}),{success:!1,status:"error",error:f(a)}}},P=async(e,t)=>(o("DPO credentials not configured. Using mock response."),C(e,t)),C=(e,t)=>{var a;return"createToken"===e?{Result:"000",ResultExplanation:"Transaction created successfully",TransToken:"MOCK-TOKEN-"+Date.now(),TransRef:"MOCK-REF-"+Date.now()}:"verifyToken"===e?{Result:"000",ResultExplanation:"Transaction paid",TransactionAmount:(null==(a=t.Transaction)?void 0:a.PaymentAmount)||"",TransactionCurrency:"BWP"}:{Result:"999",ResultExplanation:"Unknown action"}},b=async t=>{try{const{data:e}=await r.from("payments").select("*").eq("transaction_ref",t).single();if(!e)throw new Error("Payment not found");const a=await D("status",{order_id:t,pay_token:e.provider_ref});let n="pending";return"SUCCESS"===a.status?n="completed":"FAILED"===a.status?n="failed":"CANCELLED"===a.status&&(n="cancelled"),await r.from("payments").update({status:n,provider_status:a.status,completed_at:"completed"===n?(new Date).toISOString():null}).eq("id",e.id),"completed"===n&&await r.from("bookings").update({payment_status:"paid",payment_method:"orange_money",payment_reference:t}).eq("id",e.booking_id),{success:"completed"===n,status:n}}catch(a){return e("Orange Money Verification Error",a),await g(r,a,{action:"verifyOrangeMoneyPayment",transactionRef:t}),{success:!1,status:"error",error:f(a)}}},D=async(e,t)=>(o("Orange Money credentials not configured. Using mock response."),T(e)),T=(e,t)=>"init"===e?{status:"INITIATED",pay_token:"OM-TOKEN-"+Date.now(),payment_url:`https://mock-orange-pay.com/pay?token=OM-TOKEN-${Date.now()}`}:"status"===e?{status:"SUCCESS"}:{status:"ERROR",message:"Unknown action"},v=async t=>{const{bookingId:a,amount:n,paymentMethod:s,customerName:i,customerEmail:c,customerPhone:d,description:m}=t,l=`MOCK-${Date.now()}`;try{if(!a)throw new Error("Booking ID is required");if(!n||n<=0)throw new Error("Invalid payment amount");const t=u({customerEmail:c,customerName:i,customerPhone:d,description:m}),{data:y,error:f}=await r.from("payments").insert({booking_id:a,transaction_ref:l,amount:n,currency:"BWP",payment_method:s,provider:"mock",status:"completed",customer_email:t.customerEmail,customer_name:t.customerName,customer_phone:t.customerPhone,metadata:{description:t.description,is_mock:!0,note:"Mock payment - payment will be completed at station"},completed_at:(new Date).toISOString()}).select().single();if(f)throw f;const{error:g}=await r.from("bookings").update({payment_status:"paid",payment_method:s,payment_reference:l,status:"confirmed",updated_at:(new Date).toISOString()}).eq("id",a);g&&e("Failed to update booking status",g);try{const{data:e}=await r.from("bookings").select("*, schedule:schedules(departure_time, route:routes(origin, destination))").eq("id",a).single();if(e){const a=e.schedule,o=null==a?void 0:a.route;await E.sendBookingConfirmation({bookingId:e.id,customerEmail:t.customerEmail,customerName:t.customerName,origin:e.origin||(null==o?void 0:o.origin)||"Unknown",destination:e.destination||(null==o?void 0:o.destination)||"Unknown",departureTime:e.departure_time||(null==a?void 0:a.departure_time)||"",seats:Array.isArray(e.seats)?e.seats:[],totalAmount:n,bookingRef:e.booking_ref||e.id})}}catch(p){o("Failed to send booking confirmation email",p)}return{success:!0,transactionRef:l,paymentId:y.id,message:"Payment completed (mock) - ticket reserved"}}catch(y){return e("Mock Payment Error",y),await g(r,y,{action:"mockConfirmPayment",bookingId:a,transactionRef:l}),{success:!1,error:y.message||"Mock payment failed"}}},A={PAYMENT_METHODS:I,getEnabledPaymentMethods:()=>Object.values(I).filter(e=>e.enabled),calculateFees:R,calculateTotal:(e,t,a)=>{const n=R(a,e);return{baseAmount:e,serviceFee:t,paymentFee:n,total:e+t+n}},initiatePayment:async e=>v(e),verifyPayment:async e=>{try{const{data:t}=await r.from("payments").select("*").eq("transaction_ref",e).single();if(!t)throw new Error("Payment not found");switch(t.provider){case"dpo":return k(e);case"orange":return b(e);case"manual":return{success:"completed"===t.status,status:t.status,payment:t};default:return{success:!1,error:"Unknown provider"}}}catch(t){return{success:!1,error:t.message}}},getPaymentByRef:async e=>{const{data:t,error:a}=await r.from("payments").select("\n      *,\n      bookings (\n        id,\n        booking_reference,\n        passenger_name,\n        trips (\n          departure_time,\n          routes (origin, destination)\n        )\n      )\n    ").eq("transaction_ref",e).single();return a?{data:null,error:a}:{data:t,error:null}},getBookingPayments:async e=>{const{data:t,error:a}=await r.from("payments").select("*").eq("booking_id",e).order("created_at",{ascending:!1});return a?{data:[],error:a}:{data:t,error:null}},mockConfirmPayment:v,createDPOPayment:async t=>{var a,n;const{bookingId:o,amount:s,customerEmail:l,customerName:p,customerPhone:y,description:E,paymentMethod:N="card"}=t;if(!o||!i(o))throw new Error("Invalid booking ID");if(!s||!c(s))throw new Error("Invalid payment amount");if(!l||!d(l))throw new Error("Invalid customer email");if(y&&!m(y))throw new Error("Invalid customer phone number");const I=h();try{const{data:e}=await r.auth.getSession(),{data:t}=await r.from("bookings").select("id, user_id").eq("id",o).single(),i=u({customerEmail:l,customerName:p,customerPhone:y,description:E}),{data:c,error:d}=await r.from("payments").insert({booking_id:o,transaction_ref:I,amount:s,currency:_.CURRENCY,payment_method:N,provider:"dpo",status:"pending",customer_email:i.customerEmail,customer_name:i.customerName,customer_phone:i.customerPhone,metadata:{description:i.description}}).select().single();if(d)throw d;const m={CompanyToken:_.COMPANY_TOKEN,Request:"createToken",Transaction:{PaymentAmount:s.toFixed(2),PaymentCurrency:_.CURRENCY,CompanyRef:I,RedirectURL:`${window.location.origin}${w.SUCCESS_URL}?ref=${I}`,BackURL:`${window.location.origin}${w.CANCEL_URL}?ref=${I}`,CompanyRefUnique:1,PTL:30},Services:{Service:{ServiceType:_.SERVICE_TYPE,ServiceDescription:E||"GOGOBUS Bus Ticket",ServiceDate:(new Date).toISOString().split("T")[0]}},Customer:{CustomerFirstName:(null==(a=i.customerName)?void 0:a.split(" ")[0])||"Customer",CustomerLastName:(null==(n=i.customerName)?void 0:n.split(" ").slice(1).join(" "))||"",CustomerEmail:i.customerEmail,CustomerPhone:i.customerPhone,CustomerCountry:_.COUNTRY}},f=await P("createToken",m);if("000"!==f.Result)throw new Error(f.ResultExplanation||"Payment initiation failed");return await r.from("payments").update({provider_token:f.TransToken,provider_ref:f.TransRef}).eq("id",c.id),{success:!0,transactionRef:I,paymentId:c.id,token:f.TransToken,paymentUrl:`https://secure.3gdirectpay.com/payv2.php?ID=${f.TransToken}`}}catch(R){return e("DPO Payment Error",R),await g(r,R,{action:"createDPOPayment",bookingId:o,transactionRef:I}),{success:!1,error:f(R)}}},verifyDPOPayment:k,createOrangeMoneyPayment:async t=>{const{bookingId:a,amount:n,customerPhone:o,customerName:s,description:i}=t,c=h();try{const{data:e}=await r.auth.getSession(),{data:t}=await r.from("bookings").select("id, user_id").eq("id",a).single(),{data:d,error:m}=await r.from("payments").insert({booking_id:a,transaction_ref:c,amount:n,currency:"BWP",payment_method:"orange_money",provider:"orange",status:"pending",customer_phone:o,customer_name:s,metadata:{description:i}}).select().single();if(m)throw m;const u={merchant_key:N.MERCHANT_KEY,currency:"OUV",order_id:c,amount:O(n),return_url:`${window.location.origin}${w.SUCCESS_URL}?ref=${c}`,cancel_url:`${window.location.origin}${w.CANCEL_URL}?ref=${c}`,notif_url:`${window.location.origin}${w.WEBHOOK_URL}`,lang:"en",reference:i||"GOGOBUS Bus Ticket"},l=await D("init",u);if("INITIATED"!==l.status)throw new Error(l.message||"Orange Money payment initiation failed");return await r.from("payments").update({provider_ref:l.pay_token,provider_token:l.payment_url}).eq("id",d.id),{success:!0,transactionRef:c,paymentId:d.id,paymentUrl:l.payment_url,payToken:l.pay_token}}catch(d){return e("Orange Money Error",d),await g(r,d,{action:"createOrangeMoneyPayment",bookingId:a,transactionRef:c}),{success:!1,error:f(d)}}},verifyOrangeMoneyPayment:b,pollOrangeMoneyStatus:async(e,t=12e4)=>{const a=Date.now();return new Promise((n,o)=>{const s=async()=>{try{if(Date.now()-a>t)return void o(new Error("Payment polling timeout"));const{data:i}=await r.from("payments").select("*").eq("transaction_ref",e).single();if(!i||!i.provider_ref)return void o(new Error("Payment not found"));const c=await D("status",{order_id:e,pay_token:i.provider_ref});let d="pending";if("SUCCESS"===c.status||"PAID"===c.status?d="completed":"FAILED"===c.status||"ERROR"===c.status?d="failed":"CANCELLED"===c.status&&(d="cancelled"),await r.from("payments").update({status:d,provider_status:c.status,completed_at:"completed"===d?(new Date).toISOString():null}).eq("id",i.id),"completed"===d||"failed"===d||"cancelled"===d)return"completed"===d&&await r.from("bookings").update({payment_status:"paid",payment_method:"orange_money",payment_reference:e}).eq("id",i.booking_id),void n({success:"completed"===d,status:d,payment:i});setTimeout(s,5e3)}catch(i){if(!i.message.includes("timeout"))return void o(i);Date.now()-a<t?setTimeout(s,5e3):o(new Error("Payment polling timeout"))}};s()})},createManualPayment:async t=>{const{bookingId:a,amount:n,paymentMethod:o,customerName:s,customerPhone:i,notes:c}=t,d=h();try{const{data:e}=await r.auth.getSession(),{data:t}=await r.from("bookings").select("id, user_id").eq("id",a).single(),{data:m,error:u}=await r.from("payments").insert({booking_id:a,transaction_ref:d,amount:n,currency:"BWP",payment_method:o,provider:"manual",status:"pending",customer_name:s,customer_phone:i,metadata:{notes:c,requires_confirmation:!0}}).select().single();if(u)throw u;return await r.from("bookings").update({payment_status:"pending",payment_method:o}).eq("id",a),{success:!0,transactionRef:d,paymentId:m.id,message:"cash"===o?"Please pay at the bus station before departure":"Please complete the bank transfer and upload proof of payment",bankDetails:"bank_transfer"===o?{bankName:"First National Bank Botswana",accountName:"GOGOBUS (Pty) Ltd",accountNumber:"62XXXXXXXX",branchCode:"282267",reference:d}:null}}catch(m){return e("Manual Payment Error",m),{success:!1,error:m.message}}},confirmManualPayment:async(t,a)=>{try{const{data:e}=await r.from("payments").select("*").eq("transaction_ref",t).single();if(!e)throw new Error("Payment not found");return await r.from("payments").update({status:"completed",completed_at:(new Date).toISOString(),confirmed_by:a}).eq("id",e.id),await r.from("bookings").update({payment_status:"paid",payment_reference:t}).eq("id",e.booking_id),{success:!0}}catch(n){return e("Manual Payment Confirmation Error",n),{success:!1,error:n.message}}},requestRefund:async(t,a,n)=>{try{const{data:e}=await r.from("payments").select("*").eq("transaction_ref",t).single();if(!e)throw new Error("Payment not found");if("completed"!==e.status)throw new Error("Payment not completed");const{data:o,error:s}=await r.from("refunds").insert({payment_id:e.id,booking_id:e.booking_id,amount:e.amount,reason:a,status:"pending",requested_by:n}).select().single();if(s)throw s;return await r.from("payments").update({status:"refund_requested"}).eq("id",e.id),{success:!0,refund:o}}catch(o){return e("Refund Request Error",o),{success:!1,error:o.message}}},processRefund:async(t,a,n)=>{try{const{data:i}=await r.from("refunds").select("*, payments(*)").eq("id",t).single();if(!i)throw new Error("Refund not found");const c=n?"approved":"rejected";if(await r.from("refunds").update({status:c,processed_by:a,processed_at:(new Date).toISOString()}).eq("id",t),n){const a=i.payments;let n=null;try{"dpo"===a.provider&&a.provider_token?n=await(async()=>(o("DPO credentials not configured. Skipping refund API call."),{success:!0,providerRef:"MOCK-REFUND-"+Date.now()}))(a.provider_token,i.amount,i.reason):"orange"===a.provider&&a.provider_ref&&(n=await(async()=>(o("Orange Money credentials not configured. Skipping refund API call."),{success:!0,providerRef:"MOCK-REFUND-"+Date.now()}))(a.transaction_ref,a.provider_ref,i.amount,i.reason)),n&&n.providerRef&&await r.from("refunds").update({provider_ref:n.providerRef,status:"processing"}).eq("id",t)}catch(s){e("Provider refund API error",s),await g(r,s,{action:"processRefund",refundId:t,provider:a.provider})}await r.from("payments").update({status:"refunded"}).eq("id",i.payment_id),await r.from("bookings").update({payment_status:"refunded"}).eq("id",i.booking_id)}else await r.from("payments").update({status:"completed"}).eq("id",i.payment_id);return{success:!0,status:c}}catch(i){return e("Process Refund Error",i),await g(r,i,{action:"processRefund",refundId:t}),{success:!1,error:f(i)}}}};export{E as e,A as p};
