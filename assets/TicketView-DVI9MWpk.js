const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-L3BQqFhh.js","assets/index-S2ZdPJqa.js","assets/index-CruQL1Ad.css","assets/QRCodeDisplay-BmkXcOK3.js","assets/QRCodeDisplay-EpgLn9sU.css"])))=>i.map(i=>d[i]);
import{c as e,s as t,_ as i,r as n,j as s,w as o,u as r,a,L as c,q as l}from"./index-S2ZdPJqa.js";import{B as d}from"./Button-B1iOS7jC.js";import{Q as u}from"./QRCodeDisplay-BmkXcOK3.js";import{L as h}from"./LiveTrackingCard-DVGPhBr5.js";import"./trackingService-ClyeaWrg.js";const x={name:"GOGOBUS",tagline:"Travel with Confidence",phone:"+267 12 345 678",email:"support@gogobus.co.bw",website:"www.gogobus.co.bw",address:"Plot 123, Main Mall, Gaborone, Botswana"},m={primary:"#1B4D4A",primaryDark:"#153D3A",accent:"#F5A623",success:"#22C55E",gray:"#64748B",lightGray:"#F1F5F9",white:"#FFFFFF",black:"#0F172A"},_=async t=>{const{default:n}=await i(async()=>{const{default:e}=await import("./jspdf.es.min-L3BQqFhh.js").then(e=>e.j);return{default:e}},__vite__mapDeps([0,1,2])),s=t.trips||{},o=s.routes||{},{booking_reference:r,passenger_name:a,passenger_phone:c,passenger_email:l,seat_number:d,total_amount:u,payment_status:h,payment_method:_}=t,{departure_time:k,arrival_time:g,price:y}=s,{origin:p="Origin",destination:j="Destination"}=o,w=new n({orientation:"portrait",unit:"mm",format:[148,210]}),v=148,F=10;let b=F;const f=(e,t,i,n,s=m.lightGray,o=.5)=>{w.setDrawColor(s),w.setLineWidth(o),w.line(e,t,i,n)};((e,t,i,n,s=0)=>{w.setFillColor(n),s>0?w.roundedRect(e,b,t,i,s,s,"F"):w.rect(e,b,t,i,"F")})(0,v,35,m.primary),b=15,w.setFontSize(20),w.setTextColor(m.white),w.setFont("helvetica","bold"),w.text("GOGOBUS",F,b),b=22,w.setFontSize(8),w.setFont("helvetica","normal"),w.text(x.tagline,F,b),w.setFillColor(m.accent),w.roundedRect(108,10,30,12,2,2,"F"),w.setFontSize(7),w.setTextColor(m.white),w.setFont("helvetica","bold"),w.text("E-TICKET",123,17.5,{align:"center"}),b=45,w.setFontSize(18),w.setTextColor(m.black),w.setFont("helvetica","bold");const C=p.length>12?p.substring(0,12):p;w.text(C.toUpperCase(),25,b,{align:"center",maxWidth:40}),w.setFontSize(8),w.setTextColor(m.gray),w.setFont("helvetica","normal"),w.text(p,25,b+5,{align:"center",maxWidth:40}),f(45,b-3,103,b-3,m.lightGray,1),w.setFillColor(m.accent),w.circle(74,b-3,4,"F"),w.setFontSize(6),w.setTextColor(m.white),w.text("BUS",74,b-1.5,{align:"center"}),w.setFontSize(18),w.setTextColor(m.black),w.setFont("helvetica","bold");const S=j.length>12?j.substring(0,12):j;w.text(S.toUpperCase(),123,b,{align:"center",maxWidth:40}),w.setFontSize(8),w.setTextColor(m.gray),w.setFont("helvetica","normal"),w.text(j,123,b+5,{align:"center",maxWidth:40}),b=65;const N=new Date(k),T=N.toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),z=N.toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit"});w.setFillColor(m.lightGray),w.roundedRect(F,b,60,20,3,3,"F"),w.setFontSize(7),w.setTextColor(m.gray),w.text("DATE",15,b+6),w.setFontSize(11),w.setTextColor(m.black),w.setFont("helvetica","bold"),w.text(T,15,b+14),w.setFillColor(m.lightGray),w.roundedRect(78,b,60,20,3,3,"F"),w.setFontSize(7),w.setTextColor(m.gray),w.setFont("helvetica","normal"),w.text("DEPARTURE",83,b+6),w.setFontSize(16),w.setTextColor(m.primary),w.setFont("helvetica","bold"),w.text(z,83,b+15),b=95;for(let e=F;e<138;e+=4)f(e,b,e+2,b,m.lightGray,.5);w.setFillColor(m.white),w.circle(0,b,5,"F"),w.circle(v,b,5,"F"),b=105,w.setFontSize(7),w.setTextColor(m.gray),w.setFont("helvetica","normal"),w.text("PASSENGER",F,b),w.setFontSize(12),w.setTextColor(m.black),w.setFont("helvetica","bold"),w.text(a.toUpperCase(),F,b+6),w.setFontSize(7),w.setTextColor(m.gray),w.setFont("helvetica","normal"),w.text("PHONE",F,b+15),w.setFontSize(10),w.setTextColor(m.black),w.setFont("helvetica","normal"),w.text(c||"N/A",F,b+21),w.setFontSize(7),w.setTextColor(m.gray),w.text("SEAT",108,b),w.setFillColor(m.primary),w.roundedRect(108,b+2,30,18,3,3,"F"),w.setFontSize(16),w.setTextColor(m.white),w.setFont("helvetica","bold"),w.text(d,123,b+14,{align:"center"}),b=140,w.setFontSize(7),w.setTextColor(m.gray),w.setFont("helvetica","normal"),w.text("BOOKING REFERENCE",F,b),w.setFontSize(16),w.setTextColor(m.primary),w.setFont("helvetica","bold");const D=r||"N/A";w.text(D,F,b+8,{maxWidth:98});const B="paid"===h?m.success:m.accent;w.setFillColor(B),w.roundedRect(113,b-2,25,10,2,2,"F"),w.setFontSize(6),w.setTextColor(m.white),w.setFont("helvetica","bold"),w.text(h.toUpperCase(),125.5,b+4,{align:"center"}),b=155,w.setFillColor(m.lightGray),w.roundedRect(103,b,35,35,3,3,"F"),w.setFontSize(6),w.setTextColor(m.gray),w.text("SCAN TO",120.5,b+14,{align:"center"}),w.text("VERIFY",120.5,b+18,{align:"center"});try{const n=await(async t=>{try{const e=await i(()=>import("./QRCodeDisplay-BmkXcOK3.js").then(e=>e.b),__vite__mapDeps([3,1,2,4]));return await e.toDataURL(JSON.stringify(t),{width:150,margin:1,color:{dark:m.primary,light:m.white}})}catch(n){return e("QR Code generation failed",n),null}})({ref:r,id:t.id,v:1});n&&w.addImage(n,"PNG",105,b+2,31,31)}catch(R){}w.setFontSize(7),w.setTextColor(m.gray),w.setFont("helvetica","normal"),w.text("AMOUNT PAID",F,b+5),w.setFontSize(20),w.setTextColor(m.black),w.setFont("helvetica","bold"),w.text(`P${Number(u||y).toFixed(2)}`,F,b+14),w.setFontSize(8),w.setTextColor(m.gray),w.setFont("helvetica","normal");const $={card:"Credit/Debit Card",orange_money:"Orange Money",myzaka:"MyZaka",cash:"Cash",bank_transfer:"Bank Transfer"}[_]||_;return w.text(`via ${$}`,F,b+20),b=190,f(F,b,138,b,m.lightGray,.3),b=198,w.setFontSize(6),w.setTextColor(m.gray),w.setFont("helvetica","normal"),w.text(x.phone,F,b),w.text(x.email,74,b,{align:"center"}),w.text(x.website,138,b,{align:"right"}),b=203,w.setFontSize(5),w.text("Please arrive at the station 30 minutes before departure. This ticket is non-transferable.",74,b,{align:"center"}),w},k=async t=>{try{const e=await _(t),i=`GOGOBUS-Ticket-${t.booking_reference}.pdf`;return e.save(i),{success:!0,filename:i}}catch(i){return e("PDF generation error",i),{success:!1,error:i.message}}},g=async t=>{try{const e=await _(t);return{success:!0,blob:e.output("blob")}}catch(i){return e("PDF blob error",i),{success:!1,error:i.message}}},y=async t=>{try{const e=await _(t);return e.autoPrint(),window.open(e.output("bloburl"),"_blank"),{success:!0}}catch(i){return e("Print error",i),{success:!1,error:i.message}}},p="_buttonGroup_1nzce_8",j="_btn_1nzce_17",w="_primary_1nzce_38",v="_secondary_1nzce_50",F="_minimalBtn_1nzce_64",b="_card_1nzce_88",f="_cardHeader_1nzce_96",C="_cardText_1nzce_110",S="_cardActions_1nzce_117",N="_errorMessage_1nzce_133",T="_errorToast_1nzce_145",z="_spinner_1nzce_177",D=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7 10 12 15 17 10"}),s.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),B=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),s.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),s.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]}),$=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"18",cy:"5",r:"3"}),s.jsx("circle",{cx:"6",cy:"12",r:"3"}),s.jsx("circle",{cx:"18",cy:"19",r:"3"}),s.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),s.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),R=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),s.jsx("polyline",{points:"22,6 12,13 2,6"})]}),L=()=>s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:z,children:s.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),P=()=>s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M20 6 9 17l-5-5"})}),G=()=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),s.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]});function A({bookingData:t,variant:i="button",showPrint:o=!0,showShare:r=!0,showEmail:a=!1,className:c=""}){const[l,d]=n.useState(!1),[u,h]=n.useState(!1),[x,m]=n.useState(!1),[_,z]=n.useState(null),[A,E]=n.useState(""),O=(e,t="")=>{z(e),E(t),setTimeout(()=>{z(null),E("")},3e3)},U=async()=>{if(!l&&t){d(!0);try{const e=await k(t);if(!e.success)throw new Error(e.error);O("success")}catch(i){e("Download error",i),O("error",i.message||"Download failed")}finally{d(!1)}}},I=async()=>{if(!u&&t){h(!0);try{const e=await y(t);if(!e.success)throw new Error(e.error)}catch(i){e("Print error",i),O("error",i.message||"Print failed")}finally{h(!1)}}};return"minimal"===i?s.jsx("button",{className:`${F} ${c}`,onClick:U,disabled:l,children:l?s.jsx(L,{}):s.jsx(D,{})}):"card"===i?s.jsxs("div",{className:`${b} ${c}`,children:[s.jsxs("div",{className:f,children:[s.jsx(D,{}),s.jsx("span",{children:"Download Your Ticket"})]}),s.jsx("p",{className:C,children:"Get your e-ticket as a PDF file. You can print it or show it on your phone."}),s.jsxs("div",{className:S,children:[s.jsx("button",{className:`${j} ${w}`,onClick:U,disabled:l,children:l?s.jsxs(s.Fragment,{children:[s.jsx(L,{}),"Generating..."]}):"success"===_?s.jsxs(s.Fragment,{children:[s.jsx(P,{}),"Downloaded!"]}):s.jsxs(s.Fragment,{children:[s.jsx(D,{}),"Download PDF"]})}),o&&s.jsxs("button",{className:`${j} ${v}`,onClick:I,disabled:u,children:[u?s.jsx(L,{}):s.jsx(B,{}),"Print"]})]}),"error"===_&&s.jsxs("div",{className:N,children:[s.jsx(G,{}),A||"Something went wrong"]})]}):s.jsxs("div",{className:`${p} ${c}`,children:[s.jsx("button",{className:`${j} ${w}`,onClick:U,disabled:l,children:l?s.jsxs(s.Fragment,{children:[s.jsx(L,{}),"Generating..."]}):"success"===_?s.jsxs(s.Fragment,{children:[s.jsx(P,{}),"Downloaded!"]}):s.jsxs(s.Fragment,{children:[s.jsx(D,{}),"Download Ticket"]})}),o&&s.jsx("button",{className:`${j} ${v}`,onClick:I,disabled:u,title:"Print ticket",children:u?s.jsx(L,{}):s.jsx(B,{})}),r&&s.jsx("button",{className:`${j} ${v}`,onClick:async()=>{var i,n,s,o;if(!x&&t){m(!0);try{if(navigator.share){const e={title:`GOGOBUS Ticket - ${t.booking_reference}`,text:`My bus ticket: ${null==(n=null==(i=t.trips)?void 0:i.routes)?void 0:n.origin} â†’ ${null==(o=null==(s=t.trips)?void 0:s.routes)?void 0:o.destination}. Booking ref: ${t.booking_reference}`,url:window.location.href};if(navigator.canShare&&navigator.canShare({files:[]})){const{blob:i}=await g(t);if(i){const n=new File([i],`GOGOBUS-Ticket-${t.booking_reference}.pdf`,{type:"application/pdf"});e.files=[n]}}await navigator.share(e),O("success")}else await navigator.clipboard.writeText(window.location.href),O("success")}catch(r){"AbortError"!==r.name&&(e("Share error",r),O("error","Share failed"))}finally{m(!1)}}},disabled:x,title:"Share ticket",children:x?s.jsx(L,{}):s.jsx($,{})}),a&&s.jsx("button",{className:`${j} ${v}`,onClick:async()=>{var e,i,n,s,o;if(!t)return;const r=encodeURIComponent(`GOGOBUS Ticket - ${t.booking_reference}`),a=encodeURIComponent(`My GOGOBUS ticket:\n\nRoute: ${null==(i=null==(e=t.trips)?void 0:e.routes)?void 0:i.origin} â†’ ${null==(s=null==(n=t.trips)?void 0:n.routes)?void 0:s.destination}\nDate: ${new Date(null==(o=t.trips)?void 0:o.departure_time).toLocaleDateString()}\nBooking Reference: ${t.booking_reference}\nSeat: ${t.seat_number}\n\nView ticket: ${window.location.href}`);window.location.href=`mailto:?subject=${r}&body=${a}`},title:"Email ticket",children:s.jsx(R,{})}),"error"===_&&s.jsxs("div",{className:T,children:[s.jsx(G,{}),A||"Something went wrong"]})]})}const E={ticketViewScreen:"_ticketViewScreen_1uky6_1",loadingContainer:"_loadingContainer_1uky6_8",errorContainer:"_errorContainer_1uky6_9",ticketViewHeader:"_ticketViewHeader_1uky6_23",backButton:"_backButton_1uky6_30",ticketViewContent:"_ticketViewContent_1uky6_54",ticketCard:"_ticketCard_1uky6_59",ticketHeader:"_ticketHeader_1uky6_66",companyInfo:"_companyInfo_1uky6_75",companyLogo:"_companyLogo_1uky6_81",companyName:"_companyName_1uky6_85",bookingRef:"_bookingRef_1uky6_93",statusBadge:"_statusBadge_1uky6_99",confirmed:"_confirmed_1uky6_108",cancelled:"_cancelled_1uky6_113",ticketRoute:"_ticketRoute_1uky6_118",routePoint:"_routePoint_1uky6_128",city:"_city_1uky6_135",time:"_time_1uky6_142",routeLine:"_routeLine_1uky6_148",arrow:"_arrow_1uky6_156",duration:"_duration_1uky6_162",ticketDetails:"_ticketDetails_1uky6_168",detailRow:"_detailRow_1uky6_172",price:"_price_1uky6_194",trackingSection:"_trackingSection_1uky6_200",ticketDownloadSection:"_ticketDownloadSection_1uky6_205",ticketActions:"_ticketActions_1uky6_210"},O=()=>{var t,i;const{id:x}=o(),m=r(),{user:_}=a(),[k,g]=n.useState(null),[y,p]=n.useState(!0),[j,w]=n.useState(!1),[v,F]=n.useState("");n.useEffect(()=>{(async()=>{if(null==_?void 0:_.id){p(!0);try{const e=(await l.getUserBookings(_.id)).find(e=>e.id===x);e?g(e):F("Ticket not found")}catch(t){e("Failed to load booking",t),F("Failed to load ticket. Please try again.")}finally{p(!1)}}})()},[x,_]);const b=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return e}};if(y)return s.jsx("div",{className:E.loadingContainer,children:s.jsx(c,{size:"large"})});if(v||!k)return s.jsxs("div",{className:E.errorContainer,children:[s.jsx("p",{children:v||"Ticket not found"}),s.jsx(d,{onClick:()=>m("/tickets"),children:"Back to Tickets"})]});const f=k.schedule||{},C=f.route||{},S=f.bus||{},N=S.company||{},T=(()=>{var e,t,i,n;if(!k)return null;const s=k.booking_reference||k.booking_ref||k.id;return{id:k.id,booking_reference:s,passenger_name:k.passenger_name||(null==(e=k.user)?void 0:e.name)||"Passenger",passenger_phone:k.passenger_phone||(null==(t=k.user)?void 0:t.phone)||"",passenger_email:k.passenger_email||(null==(i=k.user)?void 0:i.email)||"",seat_number:(null==(n=k.seats)?void 0:n[0])||k.seat_number||"N/A",total_amount:k.total_price||k.total_amount||0,payment_status:k.payment_status||k.status||"pending",payment_method:k.payment_method||"card",trips:{departure_time:f.departure_time||k.created_at,arrival_time:f.arrival_time,price:f.price||k.total_price||0,routes:{origin:C.origin||"",destination:C.destination||"",distance_km:C.distance_km,duration_minutes:C.duration_minutes},buses:S||{}}}})();return s.jsxs("div",{className:E.ticketViewScreen,children:[s.jsxs("div",{className:E.ticketViewHeader,children:[s.jsx("button",{className:E.backButton,onClick:()=>m("/tickets"),children:"â† Back"}),s.jsx("h1",{children:"Ticket Details"})]}),s.jsx("div",{className:E.ticketViewContent,children:s.jsxs("div",{className:E.ticketCard,children:[s.jsxs("div",{className:E.ticketHeader,children:[s.jsxs("div",{className:E.companyInfo,children:[s.jsx("span",{className:E.companyLogo,children:N.logo||"ðŸšŒ"}),s.jsxs("div",{children:[s.jsx("div",{className:E.companyName,children:N.name||"Bus Company"}),s.jsxs("div",{className:E.bookingRef,children:["Booking #",k.id]})]})]}),s.jsx("div",{className:`${E.statusBadge} ${E[k.status]}`,children:k.status||"confirmed"})]}),s.jsxs("div",{className:E.ticketRoute,children:[s.jsxs("div",{className:E.routePoint,children:[s.jsx("span",{className:E.city,children:C.origin||"Origin"}),s.jsx("span",{className:E.time,children:b(f.departure_time)})]}),s.jsxs("div",{className:E.routeLine,children:[s.jsx("span",{className:E.arrow,children:"â†’"}),s.jsx("span",{className:E.duration,children:f.duration||"N/A"})]}),s.jsxs("div",{className:E.routePoint,children:[s.jsx("span",{className:E.city,children:C.destination||"Destination"}),s.jsx("span",{className:E.time,children:b(f.arrival_time)})]})]}),s.jsxs("div",{className:E.ticketDetails,children:[s.jsxs("div",{className:E.detailRow,children:[s.jsx("span",{children:"Date"}),s.jsx("span",{children:(e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})(f.departure_time||k.created_at)})]}),s.jsxs("div",{className:E.detailRow,children:[s.jsx("span",{children:"Seats"}),s.jsx("span",{children:(null==(t=k.seats)?void 0:t.join(", "))||"N/A"})]}),s.jsxs("div",{className:E.detailRow,children:[s.jsx("span",{children:"Total Price"}),s.jsxs("span",{className:E.price,children:["P",(null==(i=k.total_price)?void 0:i.toFixed(2))||"0.00"]})]})]}),s.jsx(u,{bookingId:k.id,route:C,seats:k.seats}),((null==C?void 0:C.id)||(null==f?void 0:f.id))&&s.jsx("div",{className:E.trackingSection,children:s.jsx(h,{routeId:C.id,tripId:null==f?void 0:f.id,trip:k.schedule,bookingId:k.id,route:C})}),T&&s.jsx("div",{className:E.ticketDownloadSection,children:s.jsx(A,{bookingData:T,variant:"card",showPrint:!0,showShare:!0,showEmail:!1})}),"cancelled"!==k.status&&s.jsx("div",{className:E.ticketActions,children:s.jsx(d,{variant:"outline",onClick:async()=>{if(window.confirm("Are you sure you want to cancel this booking?")){w(!0);try{await l.cancelBooking(x),g(e=>({...e,status:"cancelled"})),alert("Booking cancelled successfully")}catch(t){e("Failed to cancel booking",t),alert("Failed to cancel booking. Please try again.")}finally{w(!1)}}},disabled:j,children:j?"Cancelling...":"Cancel Booking"})})]})})]})};export{O as default};
