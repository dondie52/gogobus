import{u as e,m as s,a as t,o as n,r as i,c as a,j as o,q as r,U as d}from"./index-DVEiCBCW.js";import{p as c}from"./paymentService-C7Tz_eG6.js";import"./emailService-DQ_9VNGC.js";const l="_paymentPage_48kcz_6",h="_header_48kcz_13",u="_backBtn_48kcz_25",m="_headerTitle_48kcz_42",p="_secureIcon_48kcz_49",x="_content_48kcz_60",g="_tripSummary_48kcz_68",j="_tripHeader_48kcz_76",v="_tripRoute_48kcz_86",_="_routePoint_48kcz_92",y="_routeDot_48kcz_100",k="_destination_48kcz_108",f="_routeLine_48kcz_113",b="_tripDetails_48kcz_121",w="_tripDetail_48kcz_121",N="_section_48kcz_144",P="_sectionTitle_48kcz_148",S="_methodsList_48kcz_157",z="_methodCard_48kcz_163",I="_selected_48kcz_180",C="_methodRadio_48kcz_185",T="_methodIcon_48kcz_203",M="_brandLogos_48kcz_213",L="_providerLogo_48kcz_225",B="_methodInfo_48kcz_233",O="_methodName_48kcz_238",F="_methodDesc_48kcz_245",D="_methodFee_48kcz_250",W="_priceCard_48kcz_261",R="_priceRow_48kcz_268",$="_total_48kcz_277",E="_priceDivider_48kcz_283",J="_securityBadge_48kcz_291",A="_securityText_48kcz_307",V="_errorMessage_48kcz_325",G="_mockPaymentNotice_48kcz_338",H="_mockPaymentText_48kcz_356",U="_payButton_48kcz_375",Z="_spinner_48kcz_408",q="_terms_48kcz_419",Y=()=>o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),o.jsx("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]}),K=()=>o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",ry:"2"}),o.jsx("path",{d:"M9 22v-4h6v4"}),o.jsx("path",{d:"M8 6h.01M16 6h.01M12 6h.01M12 10h.01M12 14h.01M16 10h.01M16 14h.01M8 10h.01M8 14h.01"})]}),Q=()=>o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M20 6 9 17l-5-5"})}),X=()=>o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),o.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),ee=()=>o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"m12 19-7-7 7-7"}),o.jsx("path",{d:"M19 12H5"})]}),se=()=>o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M8 6v6m8-6v6M5 18v2m14-2v2M3 6h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6ZM3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2"}),o.jsx("circle",{cx:"7",cy:"15",r:"1"}),o.jsx("circle",{cx:"17",cy:"15",r:"1"})]}),te=()=>o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),o.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),o.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),ne=()=>o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),o.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),ie=()=>o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),o.jsx("path",{d:"M13 5v2"}),o.jsx("path",{d:"M13 17v2"}),o.jsx("path",{d:"M13 11v2"})]}),ae=()=>o.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),o.jsx("path",{d:"m9 12 2 2 4-4"})]}),oe=()=>o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:Z,children:o.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),re={card:()=>o.jsxs("div",{className:M,children:[o.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/120px-Visa_Inc._logo.svg.png",alt:"Visa"}),o.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/120px-Mastercard-logo.svg.png",alt:"Mastercard"})]}),orange:()=>o.jsx("div",{className:L,style:{background:"#FF6600"},children:o.jsx("span",{style:{color:"white",fontWeight:700},children:"Orange"})}),myzaka:()=>o.jsx("div",{className:L,style:{background:"#00A651"},children:o.jsx("span",{style:{color:"white",fontWeight:700},children:"MyZaka"})}),smega:()=>o.jsx("div",{className:L,style:{background:"#003366"},children:o.jsx("span",{style:{color:"white",fontWeight:700},children:"Smega"})}),bank:()=>o.jsx(K,{}),cash:()=>o.jsx("span",{style:{fontSize:"32px"},children:"ðŸ’µ"})};function de(){var M;const L=e();s();const{user:Z}=t(),{booking:K,selectedRoute:de,selectedSeats:ce,passengerDetails:le}=n();i.useEffect(()=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:114",message:"Payment component mounted",data:{hasUser:!!Z,userId:null==Z?void 0:Z.id,hasSelectedRoute:!!de,selectedRouteId:null==de?void 0:de.id,selectedSeatsCount:null==ce?void 0:ce.length,passengerDetailsCount:null==le?void 0:le.length,currentPath:window.location.hash},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{})},[]);const[he,ue]=i.useState("card"),[me,pe]=i.useState(!1),[xe,ge]=i.useState(null),[je,ve]=i.useState([]),[_e,ye]=i.useState(null),ke=((null==de?void 0:de.price)||150)*((null==ce?void 0:ce.length)||1),fe=Math.round(.05*ke*100)/100,be=K||{tripId:(null==de?void 0:de.id)||"mock-trip-id",route:de||{origin:"Gaborone",destination:"Maun",departureTime:new Date(Date.now()+864e5).toISOString()},seats:ce||["2A"],passenger:le&&le[0]||{name:(null==(M=null==Z?void 0:Z.user_metadata)?void 0:M.full_name)||"Guest",phone:"+267 71 234 567",email:(null==Z?void 0:Z.email)||"guest@example.com"},basePrice:ke,serviceFee:fe},we=e=>{try{const s=c.calculateTotal(be.basePrice||0,be.serviceFee||0,e||"card");ye(s)}catch(s){a("Error calculating price breakdown",s),ye(null)}};i.useEffect(()=>{try{const e=c.getEnabledPaymentMethods();ve(e||[]),be.basePrice&&be.serviceFee&&we("card")}catch(e){a("Error loading payment methods",e),ve([])}},[be.basePrice,be.serviceFee]);const Ne=e=>`P${e.toFixed(2)}`;return i.useEffect(()=>{if(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:310",message:"Payment useEffect - checking context data",data:{hasSelectedRoute:!!de,selectedRouteId:null==de?void 0:de.id,selectedSeatsCount:null==ce?void 0:ce.length,passengerDetailsCount:null==le?void 0:le.length,currentPath:window.location.hash},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{}),!de||!ce||0===ce.length){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:312",message:"Payment redirecting - missing data",data:{hasSelectedRoute:!!de,selectedSeatsCount:null==ce?void 0:ce.length,redirectTarget:"/booking/summary"},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{});const e=setTimeout(()=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:315",message:"Payment executing redirect to summary",data:{redirectTarget:"/booking/summary"},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{}),L("/booking/summary")},500);return()=>clearTimeout(e)}fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:318",message:"Payment has valid data - no redirect",data:{hasSelectedRoute:!!de,selectedSeatsCount:null==ce?void 0:ce.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{})},[de,ce,L,le]),de&&ce&&0!==ce.length?o.jsxs("div",{className:l,children:[o.jsxs("header",{className:h,children:[o.jsx("button",{className:u,onClick:()=>L(-1),children:o.jsx(ee,{})}),o.jsx("h1",{className:m,children:"Payment"}),o.jsxs("div",{className:p,children:[o.jsx(X,{}),o.jsx("span",{children:"Secure"})]})]}),o.jsxs("div",{className:x,children:[o.jsxs("div",{className:g,children:[o.jsxs("div",{className:j,children:[o.jsx(se,{}),o.jsx("span",{children:"Trip Summary"})]}),o.jsxs("div",{className:v,children:[o.jsxs("div",{className:_,children:[o.jsx("div",{className:y}),o.jsx("span",{children:(null==de?void 0:de.origin)||be.route.origin})]}),o.jsx("div",{className:f}),o.jsxs("div",{className:_,children:[o.jsx("div",{className:`${y} ${k}`}),o.jsx("span",{children:(null==de?void 0:de.destination)||be.route.destination})]})]}),o.jsxs("div",{className:b,children:[((null==de?void 0:de.departure_time)||be.route.departureTime)&&o.jsxs("div",{className:w,children:[o.jsx(te,{}),o.jsx("span",{children:(null==de?void 0:de.departure_time)||(e=>{if(!e)return"N/A";try{return new Date(e).toLocaleString("en-BW",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch(s){return e}})(be.route.departureTime)})]}),be.passenger&&o.jsxs("div",{className:w,children:[o.jsx(ne,{}),o.jsx("span",{children:be.passenger.name||be.passenger.full_name})]}),o.jsxs("div",{className:w,children:[o.jsx(ie,{}),o.jsxs("span",{children:["Seat ",be.seats.join(", ")]})]})]})]}),o.jsxs("div",{className:N,children:[o.jsx("h2",{className:P,children:"Select Payment Method"}),o.jsx("div",{className:S,children:je.map(e=>o.jsxs("div",{className:`${z} ${he===e.id?I:""}`,onClick:()=>{return s=e.id,ue(s),we(s),void ge(null);var s},children:[o.jsx("div",{className:C,children:he===e.id&&o.jsx(Q,{})}),o.jsx("div",{className:T,children:re[e.icon]?re[e.icon]():o.jsx(Y,{})}),o.jsxs("div",{className:B,children:[o.jsx("div",{className:O,children:e.name}),o.jsx("div",{className:F,children:e.description})]}),e.fees.value>0&&o.jsx("div",{className:D,children:"percentage"===e.fees.type?`${e.fees.value}% fee`:`P${e.fees.value} fee`})]},e.id))})]}),o.jsxs("div",{className:G,children:[o.jsx(ae,{}),o.jsxs("div",{className:H,children:[o.jsx("strong",{children:"Payment will be completed at the station."}),o.jsx("span",{children:"Ticket reserved now."})]})]}),_e&&o.jsxs("div",{className:N,children:[o.jsx("h2",{className:P,children:"Price Breakdown"}),o.jsxs("div",{className:W,children:[o.jsxs("div",{className:R,children:[o.jsx("span",{children:"Ticket Price"}),o.jsx("span",{children:Ne(_e.baseAmount)})]}),o.jsxs("div",{className:R,children:[o.jsx("span",{children:"Service Fee"}),o.jsx("span",{children:Ne(_e.serviceFee)})]}),_e.paymentFee>0&&o.jsxs("div",{className:R,children:[o.jsx("span",{children:"Payment Fee"}),o.jsx("span",{children:Ne(_e.paymentFee)})]}),o.jsx("div",{className:E}),o.jsxs("div",{className:`${R} ${$}`,children:[o.jsx("span",{children:"Total"}),o.jsx("span",{children:Ne(_e.total)})]})]})]}),o.jsxs("div",{className:J,children:[o.jsx(ae,{}),o.jsxs("div",{className:A,children:[o.jsx("strong",{children:"Secure Payment"}),o.jsx("span",{children:"Your payment is protected with 256-bit SSL encryption"})]})]}),xe&&o.jsx("div",{className:V,children:xe}),o.jsx("button",{className:U,onClick:async()=>{var e,s,t;pe(!0),ge(null);try{let n=null==K?void 0:K.id;if(!n&&(null==de?void 0:de.id)&&(null==Z?void 0:Z.id)&&(null==ce?void 0:ce.length)>0&&(null==le?void 0:le.length)>0){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:186",message:"Creating booking - before validation",data:{hasPriceBreakdown:!!_e,priceBreakdownTotal:null==_e?void 0:_e.total,priceBreakdownBase:null==_e?void 0:_e.baseAmount,priceBreakdownService:null==_e?void 0:_e.serviceFee,priceBreakdownPayment:null==_e?void 0:_e.paymentFee,selectedRouteId:null==de?void 0:de.id,userId:null==Z?void 0:Z.id,seatsCount:null==ce?void 0:ce.length,passengersCount:null==le?void 0:le.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"L"})}).catch(()=>{});let t=_e;if(!t||null===t.total||void 0===t.total){const e=be.basePrice||ke,s=be.serviceFee||fe;t=c.calculateTotal(e,s,he),ye(t),fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:192",message:"Recalculated priceBreakdown",data:{recalculatedTotal:t.total,baseAmount:e,serviceFeeAmount:s,selectedMethod:he},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"L"})}).catch(()=>{})}const i=(null==t?void 0:t.total)||(be.basePrice||ke)+(be.serviceFee||fe);if(!i||i<=0)throw new Error("Invalid booking total. Please refresh and try again.");const a=le[0],o={schedule_id:de.id,user_id:Z.id,seats:ce,passengers:le,total_amount:i,total_price:i,passenger_name:(null==a?void 0:a.fullName)||(null==a?void 0:a.name)||"Guest",passenger_email:(null==a?void 0:a.email)||(null==Z?void 0:Z.email)||"",passenger_phone:(null==a?void 0:a.phone)||"",origin:de.origin,destination:de.destination,departure_time:de.departure_time,payment_status:"unpaid",status:"pending"};fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:210",message:"Sending booking data",data:{total_amount:o.total_amount,total_price:o.total_price,schedule_id:o.schedule_id,user_id:o.user_id,seatsCount:null==(e=o.seats)?void 0:e.length,passengersCount:null==(s=o.passengers)?void 0:s.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"L"})}).catch(()=>{});n=(await r.createBooking(o)).id,fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:217",message:"Booking created successfully",data:{bookingId:n},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"L"})}).catch(()=>{})}if(!n)throw new Error("Unable to create booking. Please try again.");const i=be.passenger||(null==le?void 0:le[0])||{},a={bookingId:n,amount:(null==_e?void 0:_e.total)||(be.basePrice||ke)+(be.serviceFee||fe),paymentMethod:he,customerName:i.name||i.fullName||i.full_name||(null==(t=null==Z?void 0:Z.user_metadata)?void 0:t.full_name)||"Guest",customerEmail:i.email||(null==Z?void 0:Z.email)||"",customerPhone:i.phone||i.phone_number||"",description:`GOGOBUS: ${(null==de?void 0:de.origin)||be.route.origin} â†’ ${(null==de?void 0:de.destination)||be.route.destination}`},o=await c.initiatePayment(a);if(!o.success)throw new Error(o.error);d&&L(`/booking/confirmation?ref=${o.transactionRef}&method=${he}`)}catch(n){a("Payment error",n),ge(n.message||"Payment failed. Please try again.")}finally{pe(!1)}},disabled:me,children:me?o.jsxs(o.Fragment,{children:[o.jsx(oe,{}),"Processing..."]}):o.jsxs(o.Fragment,{children:[o.jsx(X,{}),"Pay ",_e?Ne(_e.total):""]})}),o.jsxs("p",{className:q,children:["By proceeding, you agree to our"," ",o.jsx("a",{href:"/terms",children:"Terms of Service"})," and"," ",o.jsx("a",{href:"/privacy",children:"Privacy Policy"})]})]})]}):o.jsx("div",{className:l,children:o.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[o.jsx("p",{children:"Loading payment information..."}),o.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9rem",color:"#666"},children:"Redirecting to booking summary..."})]})})}export{de as default};
