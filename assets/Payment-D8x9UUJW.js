import{u as e,m as s,a as i,o as n,r as t,j as a,q as r,U as o,c as d}from"./index-BY3fVUfY.js";import{p as l}from"./paymentService-CaTXR31x.js";import"./emailService-BEJaWvWz.js";const c="_paymentPage_48kcz_6",h="_header_48kcz_13",u="_backBtn_48kcz_25",m="_headerTitle_48kcz_42",x="_secureIcon_48kcz_49",p="_content_48kcz_60",j="_tripSummary_48kcz_68",v="_tripHeader_48kcz_76",_="_tripRoute_48kcz_86",g="_routePoint_48kcz_92",k="_routeDot_48kcz_100",y="_destination_48kcz_108",f="_routeLine_48kcz_113",w="_tripDetails_48kcz_121",N="_tripDetail_48kcz_121",b="_section_48kcz_144",z="_sectionTitle_48kcz_148",P="_methodsList_48kcz_157",M="_methodCard_48kcz_163",S="_selected_48kcz_180",L="_methodRadio_48kcz_185",B="_methodIcon_48kcz_203",T="_brandLogos_48kcz_213",C="_providerLogo_48kcz_225",I="_methodInfo_48kcz_233",F="_methodName_48kcz_238",W="_methodDesc_48kcz_245",D="_methodFee_48kcz_250",$="_priceCard_48kcz_261",O="_priceRow_48kcz_268",R="_total_48kcz_277",A="_priceDivider_48kcz_283",E="_securityBadge_48kcz_291",V="_securityText_48kcz_307",G="_errorMessage_48kcz_325",H="_mockPaymentNotice_48kcz_338",J="_mockPaymentText_48kcz_356",U="_payButton_48kcz_375",Z="_spinner_48kcz_408",q="_terms_48kcz_419",Y=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),a.jsx("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]}),K=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",ry:"2"}),a.jsx("path",{d:"M9 22v-4h6v4"}),a.jsx("path",{d:"M8 6h.01M16 6h.01M12 6h.01M12 10h.01M12 14h.01M16 10h.01M16 14h.01M8 10h.01M8 14h.01"})]}),Q=()=>a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M20 6 9 17l-5-5"})}),X=()=>a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),a.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),ee=()=>a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"m12 19-7-7 7-7"}),a.jsx("path",{d:"M19 12H5"})]}),se=()=>a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M8 6v6m8-6v6M5 18v2m14-2v2M3 6h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6ZM3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2"}),a.jsx("circle",{cx:"7",cy:"15",r:"1"}),a.jsx("circle",{cx:"17",cy:"15",r:"1"})]}),ie=()=>a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),a.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),a.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),ne=()=>a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),a.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),te=()=>a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),a.jsx("path",{d:"M13 5v2"}),a.jsx("path",{d:"M13 17v2"}),a.jsx("path",{d:"M13 11v2"})]}),ae=()=>a.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),a.jsx("path",{d:"m9 12 2 2 4-4"})]}),re=()=>a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:Z,children:a.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),oe={card:()=>a.jsxs("div",{className:T,children:[a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/120px-Visa_Inc._logo.svg.png",alt:"Visa"}),a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/120px-Mastercard-logo.svg.png",alt:"Mastercard"})]}),orange:()=>a.jsx("div",{className:C,style:{background:"#FF6600"},children:a.jsx("span",{style:{color:"white",fontWeight:700},children:"Orange"})}),myzaka:()=>a.jsx("div",{className:C,style:{background:"#00A651"},children:a.jsx("span",{style:{color:"white",fontWeight:700},children:"MyZaka"})}),smega:()=>a.jsx("div",{className:C,style:{background:"#003366"},children:a.jsx("span",{style:{color:"white",fontWeight:700},children:"Smega"})}),bank:()=>a.jsx(K,{}),cash:()=>a.jsx("span",{style:{fontSize:"32px"},children:"ðŸ’µ"})};function de(){var T;const C=e();s();const{user:Z}=i(),{booking:K,selectedRoute:de,selectedSeats:le,passengerDetails:ce}=n(),[he,ue]=t.useState("card"),[me,xe]=t.useState(!1),[pe,je]=t.useState(null),[ve,_e]=t.useState([]),[ge,ke]=t.useState(null),ye=((null==de?void 0:de.price)||150)*((null==le?void 0:le.length)||1),fe=Math.round(.05*ye*100)/100,we=K||{tripId:(null==de?void 0:de.id)||"mock-trip-id",route:de||{origin:"Gaborone",destination:"Maun",departureTime:new Date(Date.now()+864e5).toISOString()},seats:le||["2A"],passenger:ce&&ce[0]||{name:(null==(T=null==Z?void 0:Z.user_metadata)?void 0:T.full_name)||"Guest",phone:"+267 71 234 567",email:(null==Z?void 0:Z.email)||"guest@example.com"},basePrice:ye,serviceFee:fe},Ne=e=>{const s=l.calculateTotal(we.basePrice,we.serviceFee,e);ke(s)};t.useEffect(()=>{const e=l.getEnabledPaymentMethods();_e(e),we.basePrice&&we.serviceFee&&Ne("card")},[we.basePrice,we.serviceFee]);const be=e=>`P${e.toFixed(2)}`;return t.useEffect(()=>{if(!de||!le||0===le.length){const e=setTimeout(()=>{C("/booking/summary")},500);return()=>clearTimeout(e)}},[de,le,C]),de&&le&&0!==le.length?a.jsxs("div",{className:c,children:[a.jsxs("header",{className:h,children:[a.jsx("button",{className:u,onClick:()=>C(-1),children:a.jsx(ee,{})}),a.jsx("h1",{className:m,children:"Payment"}),a.jsxs("div",{className:x,children:[a.jsx(X,{}),a.jsx("span",{children:"Secure"})]})]}),a.jsxs("div",{className:p,children:[a.jsxs("div",{className:j,children:[a.jsxs("div",{className:v,children:[a.jsx(se,{}),a.jsx("span",{children:"Trip Summary"})]}),a.jsxs("div",{className:_,children:[a.jsxs("div",{className:g,children:[a.jsx("div",{className:k}),a.jsx("span",{children:(null==de?void 0:de.origin)||we.route.origin})]}),a.jsx("div",{className:f}),a.jsxs("div",{className:g,children:[a.jsx("div",{className:`${k} ${y}`}),a.jsx("span",{children:(null==de?void 0:de.destination)||we.route.destination})]})]}),a.jsxs("div",{className:w,children:[((null==de?void 0:de.departure_time)||we.route.departureTime)&&a.jsxs("div",{className:N,children:[a.jsx(ie,{}),a.jsx("span",{children:(null==de?void 0:de.departure_time)||(ze=we.route.departureTime,new Date(ze).toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}))})]}),we.passenger&&a.jsxs("div",{className:N,children:[a.jsx(ne,{}),a.jsx("span",{children:we.passenger.name||we.passenger.full_name})]}),a.jsxs("div",{className:N,children:[a.jsx(te,{}),a.jsxs("span",{children:["Seat ",we.seats.join(", ")]})]})]})]}),a.jsxs("div",{className:b,children:[a.jsx("h2",{className:z,children:"Select Payment Method"}),a.jsx("div",{className:P,children:ve.map(e=>a.jsxs("div",{className:`${M} ${he===e.id?S:""}`,onClick:()=>{return s=e.id,ue(s),Ne(s),void je(null);var s},children:[a.jsx("div",{className:L,children:he===e.id&&a.jsx(Q,{})}),a.jsx("div",{className:B,children:oe[e.icon]?oe[e.icon]():a.jsx(Y,{})}),a.jsxs("div",{className:I,children:[a.jsx("div",{className:F,children:e.name}),a.jsx("div",{className:W,children:e.description})]}),e.fees.value>0&&a.jsx("div",{className:D,children:"percentage"===e.fees.type?`${e.fees.value}% fee`:`P${e.fees.value} fee`})]},e.id))})]}),a.jsxs("div",{className:H,children:[a.jsx(ae,{}),a.jsxs("div",{className:J,children:[a.jsx("strong",{children:"Payment will be completed at the station."}),a.jsx("span",{children:"Ticket reserved now."})]})]}),ge&&a.jsxs("div",{className:b,children:[a.jsx("h2",{className:z,children:"Price Breakdown"}),a.jsxs("div",{className:$,children:[a.jsxs("div",{className:O,children:[a.jsx("span",{children:"Ticket Price"}),a.jsx("span",{children:be(ge.baseAmount)})]}),a.jsxs("div",{className:O,children:[a.jsx("span",{children:"Service Fee"}),a.jsx("span",{children:be(ge.serviceFee)})]}),ge.paymentFee>0&&a.jsxs("div",{className:O,children:[a.jsx("span",{children:"Payment Fee"}),a.jsx("span",{children:be(ge.paymentFee)})]}),a.jsx("div",{className:A}),a.jsxs("div",{className:`${O} ${R}`,children:[a.jsx("span",{children:"Total"}),a.jsx("span",{children:be(ge.total)})]})]})]}),a.jsxs("div",{className:E,children:[a.jsx(ae,{}),a.jsxs("div",{className:V,children:[a.jsx("strong",{children:"Secure Payment"}),a.jsx("span",{children:"Your payment is protected with 256-bit SSL encryption"})]})]}),pe&&a.jsx("div",{className:G,children:pe}),a.jsx("button",{className:U,onClick:async()=>{var e,s,i;xe(!0),je(null);try{let n=null==K?void 0:K.id;if(!n&&(null==de?void 0:de.id)&&(null==Z?void 0:Z.id)&&(null==le?void 0:le.length)>0&&(null==ce?void 0:ce.length)>0){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:186",message:"Creating booking - before validation",data:{hasPriceBreakdown:!!ge,priceBreakdownTotal:null==ge?void 0:ge.total,priceBreakdownBase:null==ge?void 0:ge.baseAmount,priceBreakdownService:null==ge?void 0:ge.serviceFee,priceBreakdownPayment:null==ge?void 0:ge.paymentFee,selectedRouteId:null==de?void 0:de.id,userId:null==Z?void 0:Z.id,seatsCount:null==le?void 0:le.length,passengersCount:null==ce?void 0:ce.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"L"})}).catch(()=>{});let i=ge;if(!i||null===i.total||void 0===i.total){const e=we.basePrice||ye,s=we.serviceFee||fe;i=l.calculateTotal(e,s,he),ke(i),fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:192",message:"Recalculated priceBreakdown",data:{recalculatedTotal:i.total,baseAmount:e,serviceFeeAmount:s,selectedMethod:he},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"L"})}).catch(()=>{})}const t=(null==i?void 0:i.total)||(we.basePrice||ye)+(we.serviceFee||fe);if(!t||t<=0)throw new Error("Invalid booking total. Please refresh and try again.");const a=ce[0],o={schedule_id:de.id,user_id:Z.id,seats:le,passengers:ce,total_amount:t,total_price:t,passenger_name:(null==a?void 0:a.fullName)||(null==a?void 0:a.name)||"Guest",passenger_email:(null==a?void 0:a.email)||(null==Z?void 0:Z.email)||"",passenger_phone:(null==a?void 0:a.phone)||"",origin:de.origin,destination:de.destination,departure_time:de.departure_time,payment_status:"unpaid",status:"pending"};fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:210",message:"Sending booking data",data:{total_amount:o.total_amount,total_price:o.total_price,schedule_id:o.schedule_id,user_id:o.user_id,seatsCount:null==(e=o.seats)?void 0:e.length,passengersCount:null==(s=o.passengers)?void 0:s.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"L"})}).catch(()=>{});n=(await r.createBooking(o)).id,fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:217",message:"Booking created successfully",data:{bookingId:n},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"L"})}).catch(()=>{})}if(!n)throw new Error("Unable to create booking. Please try again.");const t=we.passenger||(null==ce?void 0:ce[0])||{},a={bookingId:n,amount:(null==ge?void 0:ge.total)||(we.basePrice||ye)+(we.serviceFee||fe),paymentMethod:he,customerName:t.name||t.fullName||t.full_name||(null==(i=null==Z?void 0:Z.user_metadata)?void 0:i.full_name)||"Guest",customerEmail:t.email||(null==Z?void 0:Z.email)||"",customerPhone:t.phone||t.phone_number||"",description:`GOGOBUS: ${(null==de?void 0:de.origin)||we.route.origin} â†’ ${(null==de?void 0:de.destination)||we.route.destination}`},d=await l.initiatePayment(a);if(!d.success)throw new Error(d.error);o&&C(`/booking/confirmation?ref=${d.transactionRef}&method=${he}`)}catch(n){d("Payment error",n),je(n.message||"Payment failed. Please try again.")}finally{xe(!1)}},disabled:me,children:me?a.jsxs(a.Fragment,{children:[a.jsx(re,{}),"Processing..."]}):a.jsxs(a.Fragment,{children:[a.jsx(X,{}),"Pay ",ge?be(ge.total):""]})}),a.jsxs("p",{className:q,children:["By proceeding, you agree to our"," ",a.jsx("a",{href:"/terms",children:"Terms of Service"})," and"," ",a.jsx("a",{href:"/privacy",children:"Privacy Policy"})]})]})]}):a.jsx("div",{className:c,children:a.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[a.jsx("p",{children:"Loading payment information..."}),a.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9rem",color:"#666"},children:"Redirecting to booking summary..."})]})});var ze}export{de as default};
