import{j as a,s as e}from"./index-BscrYh5_.js";const n={pill:"_pill_1yava_1",small:"_small_1yava_14",medium:"_medium_1yava_20",large:"_large_1yava_25",dot:"_dot_1yava_30",pulse:"_pulse_1yava_1",onTime:"_onTime_1yava_54",delayed:"_delayed_1yava_59",boarding:"_boarding_1yava_64",departed:"_departed_1yava_69",arriving:"_arriving_1yava_74",unknown:"_unknown_1yava_79"},t={on_time:{label:"On Time",className:"onTime"},delayed:{label:"Delayed",className:"delayed"},boarding:{label:"Boarding",className:"boarding"},departed:{label:"Departed",className:"departed"},arriving:{label:"Arriving",className:"arriving"}};function r({status:e,size:r="medium"}){const l=t[e]||{label:e||"Unknown",className:"unknown"};return a.jsxs("span",{className:`${n.pill} ${n[l.className]} ${n[r]}`,role:"status","aria-label":`Trip status: ${l.label}`,children:[a.jsx("span",{className:n.dot,"aria-hidden":"true"}),l.label]})}async function l(a){if(!a)return null;try{const{data:n,error:t}=await e.from("trip_locations").select("*").eq("trip_id",a).order("recorded_at",{ascending:!1}).limit(1).single();if(t){if("PGRST116"===t.code)return null;throw t}return n}catch(n){return null}}async function i(a,n){if(!a)throw new Error("tripId is required");if("number"!=typeof n.lat||"number"!=typeof n.lng)throw new Error("lat and lng are required numbers");const{data:t,error:r}=await e.from("trip_locations").insert({trip_id:a,lat:n.lat,lng:n.lng,heading:n.heading??null,speed:n.speed??null,status:n.status??"on_time",source:n.source??"simulation"}).select().single();if(r)throw r;return t}function s(a,n){return function(a,n){if(!a||"function"!=typeof n)return()=>{};const t=`trip-location-${a}`,r=e.channel(t).on("postgres_changes",{event:"INSERT",schema:"public",table:"trip_locations",filter:`trip_id=eq.${a}`},a=>{n(a.new)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"trip_locations",filter:`trip_id=eq.${a}`},a=>{n(a.new)}).subscribe(a=>{});return()=>{e.removeChannel(r)}}(a,n)}async function o(a,e={}){const{start:n={lat:-24.6282,lng:25.9231},end:t={lat:-24.658,lng:25.912},duration:r=3e4,interval:l=3e3,onUpdate:s}=e,o=Math.floor(r/l),d=(t.lat-n.lat)/o,c=(t.lng-n.lng)/o;let u=0,_=!1;return(async()=>{for(;u<=o&&!_;){const t=n.lat+d*u,r=n.lng+c*u,m=Math.atan2(c,d)*(180/Math.PI),p=u/o;let g;g=p<.1?"boarding":p<.2?"departed":p>.9?"arriving":"on_time";try{const e=await i(a,{lat:t,lng:r,heading:m>=0?m:m+360,speed:40+20*Math.random(),status:g,source:"simulation"});s&&s(e)}catch(e){}u++,u<=o&&!_&&await new Promise(a=>setTimeout(a,l))}})(),()=>{_=!0}}export{r as T,o as a,l as g,s};
