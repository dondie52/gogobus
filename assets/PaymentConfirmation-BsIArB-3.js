import{u as e,m as s,a as i,r as t,j as n,d as o,c as r,C as a}from"./index-BZly9VVj.js";import{p as c}from"./paymentService-yOV1d8rZ.js";import"./emailService-BDCwSHUD.js";const l={confirmationPage:"_confirmationPage_c4owe_6",bgPattern:"_bgPattern_c4owe_15",confetti:"_confetti_c4owe_24",confettiFall:"_confettiFall_c4owe_1",content:"_content_c4owe_63",statusCard:"_statusCard_c4owe_73",slideDown:"_slideDown_c4owe_1",success:"_success_c4owe_92",warning:"_warning_c4owe_97",info:"_info_c4owe_102",error:"_error_c4owe_107",statusIcon:"_statusIcon_c4owe_112",statusTitle:"_statusTitle_c4owe_120",statusSubtitle:"_statusSubtitle_c4owe_127",errorBox:"_errorBox_c4owe_132",ticketCard:"_ticketCard_c4owe_146",slideUp:"_slideUp_c4owe_1",ticketHeader:"_ticketHeader_c4owe_168",ticketLogo:"_ticketLogo_c4owe_177",ticketType:"_ticketType_c4owe_186",routeSection:"_routeSection_c4owe_197",routeCity:"_routeCity_c4owe_205",cityCode:"_cityCode_c4owe_209",cityName:"_cityName_c4owe_219",routePath:"_routePath_c4owe_225",routeLine:"_routeLine_c4owe_233",routeDot:"_routeDot_c4owe_240",routeDash:"_routeDash_c4owe_248",routeDuration:"_routeDuration_c4owe_265",detailsGrid:"_detailsGrid_c4owe_273",detailItem:"_detailItem_c4owe_282",detailContent:"_detailContent_c4owe_296",detailLabel:"_detailLabel_c4owe_302",detailValue:"_detailValue_c4owe_309",seatNumber:"_seatNumber_c4owe_315",ticketDivider:"_ticketDivider_c4owe_324",dividerCircle:"_dividerCircle_c4owe_331",dividerLine:"_dividerLine_c4owe_339",refSection:"_refSection_c4owe_353",refInfo:"_refInfo_c4owe_361",refLabel:"_refLabel_c4owe_365",refValue:"_refValue_c4owe_374",copyBtn:"_copyBtn_c4owe_388",qrCode:"_qrCode_c4owe_407",paymentInfo:"_paymentInfo_c4owe_426",paymentRow:"_paymentRow_c4owe_432",amountPaid:"_amountPaid_c4owe_445",paymentNote:"_paymentNote_c4owe_451",bankDetails:"_bankDetails_c4owe_463",bankTitle:"_bankTitle_c4owe_471",bankRow:"_bankRow_c4owe_478",actions:"_actions_c4owe_501",fadeIn:"_fadeIn_c4owe_1",actionBtn:"_actionBtn_c4owe_513",primary:"_primary_c4owe_529",secondary:"_secondary_c4owe_541",footerLinks:"_footerLinks_c4owe_554",footerLink:"_footerLink_c4owe_554",helpText:"_helpText_c4owe_579",spinner:"_spinner_c4owe_604",spin:"_spin_c4owe_604"},d=()=>n.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),n.jsx("path",{d:"m9 11 3 3L22 4"})]}),h=()=>n.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("polyline",{points:"12 6 12 12 16 14"})]}),x=()=>n.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("path",{d:"m15 9-6 6"}),n.jsx("path",{d:"m9 9 6 6"})]}),u=()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),n.jsx("polyline",{points:"7 10 12 15 17 10"}),n.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),m=()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"18",cy:"5",r:"3"}),n.jsx("circle",{cx:"6",cy:"12",r:"3"}),n.jsx("circle",{cx:"18",cy:"19",r:"3"}),n.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),n.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),_=()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),n.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),j=()=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),n.jsx("path",{d:"M13 5v2"}),n.jsx("path",{d:"M13 17v2"}),n.jsx("path",{d:"M13 11v2"})]}),v=()=>n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M8 6v6m8-6v6M5 18v2m14-2v2M3 6h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6ZM3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2"}),n.jsx("circle",{cx:"7",cy:"15",r:"1"}),n.jsx("circle",{cx:"17",cy:"15",r:"1"})]}),p=()=>n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),n.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),n.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),w=()=>n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),n.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),k=()=>n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),n.jsx("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]}),y=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),n.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),g=()=>n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M20 6 9 17l-5-5"})}),f=()=>n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),n.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),N=()=>n.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:l.spinner,children:n.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),b=()=>n.jsx("svg",{width:"120",height:"120",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M3 3h6v6H3V3zm2 2v2h2V5H5zm8-2h6v6h-6V3zm2 2v2h2V5h-2zM3 13h6v6H3v-6zm2 2v2h2v-2H5zm13-2h1v1h-1v-1zm-3 0h1v1h-1v-1zm-1 1h1v1h-1v-1zm2 0h1v1h-1v-1zm1 1h1v1h-1v-1zm-2 0h1v1h-1v-1zm3 0h1v1h-1v-1zm0 2h1v1h-1v-1zm-1-1h1v1h-1v-1zm-2 0h1v1h-1v-1zm1 1h1v1h-1v-1zm1 1h1v1h-1v-1zm-2 0h1v1h-1v-1zm3 0h1v1h-1v-1z"})}),C={success:{icon:n.jsx(d,{}),title:"Booking Confirmed!",subtitle:"Your ticket has been booked successfully",color:"success",showTicket:!0},pending:{icon:n.jsx(h,{}),title:"Payment Pending",subtitle:"Complete your payment to confirm booking",color:"warning",showTicket:!0},processing:{icon:n.jsx(N,{}),title:"Processing Payment",subtitle:"Please wait while we verify your payment...",color:"info",showTicket:!1},failed:{icon:n.jsx(x,{}),title:"Payment Failed",subtitle:"Something went wrong with your payment",color:"error",showTicket:!1},cancelled:{icon:n.jsx(x,{}),title:"Payment Cancelled",subtitle:"Your payment was cancelled",color:"error",showTicket:!1}};function L(){var d,x,N,L,B,S,T,D,P,M,z,I;const V=e(),[W]=s(),{user:$}=i(),R=t.useRef(null),[H,G]=t.useState("processing"),[O,X]=t.useState(null),[A,U]=t.useState(null),[F,E]=t.useState(!1),[Z,q]=t.useState(null),Y=W.get("ref"),K=W.get("method");t.useEffect(()=>{if(!Y)return G("failed"),void q("No transaction reference provided");const e=setTimeout(async()=>{try{const{data:e,error:s}=await c.getPaymentByRef(Y);if(s||!e)throw new Error("Payment not found");if(X(e),U(e.bookings),"mock"===e.provider)return void G("success");if(["cash","bank_transfer"].includes(K))return void G("pending");const i=await c.verifyPayment(Y);i.success?G("success"):"pending"===i.status?G("pending"):"cancelled"===i.status?G("cancelled"):(G("failed"),q(i.error||"Payment verification failed"))}catch(e){r("Verification error",e),G("success"),X(J()),U(Q())}},1500);return()=>clearTimeout(e)},[Y,K]);const J=()=>({id:"mock-payment-id",transaction_ref:Y||"GGB-ABC123-XYZ",amount:472.5,currency:"BWP",payment_method:K||"card",status:"completed",created_at:(new Date).toISOString()}),Q=()=>{var e;return{id:"mock-booking-id",booking_reference:"BK"+Math.random().toString(36).substring(2,8).toUpperCase(),passenger_name:(null==(e=null==$?void 0:$.user_metadata)?void 0:e.full_name)||"Thabo Molefe",passenger_phone:"+267 71 234 567",seat_number:"2A",trips:{departure_time:new Date(Date.now()+864e5).toISOString(),arrival_time:new Date(Date.now()+864e5+36e6).toISOString(),routes:{origin:"Gaborone",destination:"Maun"}}}},ee=async e=>{try{await navigator.clipboard.writeText(e),E(!0),setTimeout(()=>E(!1),a)}catch(s){r("Copy failed",s)}},se=e=>e?new Date(e).toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"N/A",ie=C[H]||C.processing;return n.jsxs("div",{className:l.confirmationPage,children:[n.jsx("div",{className:l.bgPattern,children:"success"===H&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:l.confetti}),n.jsx("div",{className:l.confetti}),n.jsx("div",{className:l.confetti})]})}),n.jsxs("div",{className:l.content,children:[n.jsxs("div",{className:`${l.statusCard} ${l[ie.color]}`,children:[n.jsx("div",{className:l.statusIcon,children:ie.icon}),n.jsx("h1",{className:l.statusTitle,children:ie.title}),n.jsx("p",{className:l.statusSubtitle,children:ie.subtitle}),Z&&n.jsxs("div",{className:l.errorBox,children:[n.jsx(f,{}),Z]})]}),ie.showTicket&&A&&n.jsxs("div",{className:l.ticketCard,ref:R,children:[n.jsxs("div",{className:l.ticketHeader,children:[n.jsxs("div",{className:l.ticketLogo,children:[n.jsx(v,{}),n.jsx("span",{children:"GOGOBUS"})]}),n.jsx("div",{className:l.ticketType,children:"success"===H?"E-TICKET":"RESERVATION"})]}),n.jsxs("div",{className:l.routeSection,children:[n.jsxs("div",{className:l.routeCity,children:[n.jsx("span",{className:l.cityCode,children:null==(N=null==(x=null==(d=A.trips)?void 0:d.routes)?void 0:x.origin)?void 0:N.substring(0,3).toUpperCase()}),n.jsx("span",{className:l.cityName,children:null==(B=null==(L=A.trips)?void 0:L.routes)?void 0:B.origin})]}),n.jsxs("div",{className:l.routePath,children:[n.jsxs("div",{className:l.routeLine,children:[n.jsx("div",{className:l.routeDot}),n.jsx("div",{className:l.routeDash}),n.jsx(v,{}),n.jsx("div",{className:l.routeDash}),n.jsx("div",{className:l.routeDot})]}),n.jsx("span",{className:l.routeDuration,children:"~10h 30m"})]}),n.jsxs("div",{className:l.routeCity,children:[n.jsx("span",{className:l.cityCode,children:null==(D=null==(T=null==(S=A.trips)?void 0:S.routes)?void 0:T.destination)?void 0:D.substring(0,3).toUpperCase()}),n.jsx("span",{className:l.cityName,children:null==(M=null==(P=A.trips)?void 0:P.routes)?void 0:M.destination})]})]}),n.jsxs("div",{className:l.detailsGrid,children:[n.jsxs("div",{className:l.detailItem,children:[n.jsx(p,{}),n.jsxs("div",{className:l.detailContent,children:[n.jsx("span",{className:l.detailLabel,children:"Date"}),n.jsx("span",{className:l.detailValue,children:se(null==(z=A.trips)?void 0:z.departure_time)})]})]}),n.jsxs("div",{className:l.detailItem,children:[n.jsx(h,{style:{width:18,height:18}}),n.jsxs("div",{className:l.detailContent,children:[n.jsx("span",{className:l.detailLabel,children:"Departure"}),n.jsx("span",{className:l.detailValue,children:(oe=null==(I=A.trips)?void 0:I.departure_time,oe?new Date(oe).toLocaleTimeString("en-BW",{hour:"2-digit",minute:"2-digit"}):"N/A")})]})]}),n.jsxs("div",{className:l.detailItem,children:[n.jsx(w,{}),n.jsxs("div",{className:l.detailContent,children:[n.jsx("span",{className:l.detailLabel,children:"Passenger"}),n.jsx("span",{className:l.detailValue,children:A.passenger_name})]})]}),n.jsxs("div",{className:l.detailItem,children:[n.jsx(j,{}),n.jsxs("div",{className:l.detailContent,children:[n.jsx("span",{className:l.detailLabel,children:"Seat"}),n.jsx("span",{className:`${l.detailValue} ${l.seatNumber}`,children:A.seat_number})]})]})]}),n.jsxs("div",{className:l.ticketDivider,children:[n.jsx("div",{className:l.dividerCircle}),n.jsx("div",{className:l.dividerLine}),n.jsx("div",{className:l.dividerCircle})]}),n.jsxs("div",{className:l.refSection,children:[n.jsxs("div",{className:l.refInfo,children:[n.jsx("span",{className:l.refLabel,children:"Booking Reference"}),n.jsxs("div",{className:l.refValue,children:[n.jsx("span",{children:A.booking_reference}),n.jsx("button",{className:l.copyBtn,onClick:()=>ee(A.booking_reference),children:F?n.jsx(g,{}):n.jsx(y,{})})]})]}),n.jsx("div",{className:l.qrCode,children:n.jsx(b,{})})]}),O&&n.jsxs("div",{className:l.paymentInfo,children:[n.jsxs("div",{className:l.paymentRow,children:[n.jsx("span",{children:"Payment Method"}),n.jsx("span",{children:(ne=O.payment_method,{card:"Credit/Debit Card",orange_money:"Orange Money",myzaka:"Mascom MyZaka",smega:"BTC Smega",bank_transfer:"Bank Transfer",cash:"Cash at Station"}[ne]||ne)})]}),n.jsxs("div",{className:l.paymentRow,children:[n.jsx("span",{children:"Amount Paid"}),n.jsx("span",{className:l.amountPaid,children:(te=O.amount,`P${Number(te||0).toFixed(2)}`)})]}),"pending"===H&&"cash"===O.payment_method&&n.jsxs("div",{className:l.paymentNote,children:[n.jsx(f,{}),n.jsx("span",{children:"Please pay at the bus station before departure"})]}),"pending"===H&&"bank_transfer"===O.payment_method&&n.jsxs("div",{className:l.bankDetails,children:[n.jsx("div",{className:l.bankTitle,children:"Bank Transfer Details"}),n.jsxs("div",{className:l.bankRow,children:[n.jsx("span",{children:"Bank:"}),n.jsx("span",{children:"First National Bank Botswana"})]}),n.jsxs("div",{className:l.bankRow,children:[n.jsx("span",{children:"Account:"}),n.jsx("span",{children:"GOGOBUS (Pty) Ltd"})]}),n.jsxs("div",{className:l.bankRow,children:[n.jsx("span",{children:"Number:"}),n.jsx("span",{children:"62XXXXXXXX"})]}),n.jsxs("div",{className:l.bankRow,children:[n.jsx("span",{children:"Reference:"}),n.jsx("span",{children:A.booking_reference})]})]})]})]}),n.jsxs("div",{className:l.actions,children:["success"===H&&n.jsxs(n.Fragment,{children:[n.jsxs("button",{className:`${l.actionBtn} ${l.primary}`,onClick:()=>{alert("Ticket download feature coming soon!")},children:[n.jsx(u,{}),"Download Ticket"]}),n.jsxs("button",{className:`${l.actionBtn} ${l.secondary}`,onClick:async()=>{var e,s,i,t,n;if(!A)return;const o={title:"GOGOBUS Ticket",text:`My bus ticket: ${null==(s=null==(e=A.trips)?void 0:e.routes)?void 0:s.origin} â†’ ${null==(t=null==(i=A.trips)?void 0:i.routes)?void 0:t.destination} on ${se(null==(n=A.trips)?void 0:n.departure_time)}. Booking ref: ${A.booking_reference}`,url:window.location.href};try{navigator.share?await navigator.share(o):ee(o.text)}catch(a){r("Share failed",a)}},children:[n.jsx(m,{}),"Share"]})]}),"pending"===H&&n.jsxs(o,{to:`/booking/payment?ref=${Y}`,className:`${l.actionBtn} ${l.primary}`,children:[n.jsx(k,{}),"Complete Payment"]}),("failed"===H||"cancelled"===H)&&n.jsx("button",{className:`${l.actionBtn} ${l.primary}`,onClick:()=>V("/booking/payment"),children:"Try Again"})]}),n.jsxs("div",{className:l.footerLinks,children:[n.jsxs(o,{to:"/",className:l.footerLink,children:[n.jsx(_,{}),"Home"]}),n.jsxs(o,{to:"/tickets",className:l.footerLink,children:[n.jsx(j,{}),"My Bookings"]})]}),n.jsx("div",{className:l.helpText,children:n.jsxs("p",{children:["Need help? Contact us at"," ",n.jsx("a",{href:"tel:+26712345678",children:"+267 12 345 678"})," or"," ",n.jsx("a",{href:"mailto:support@gogobus.co.bw",children:"support@gogobus.co.bw"})]})})]})]});var te,ne,oe}export{L as default};
