const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-xoP6dWRh.js","assets/index-CruQL1Ad.css"])))=>i.map(i=>d[i]);
import{u as e,a as s,r as t,N as a,j as i,c as n,_ as r}from"./index-xoP6dWRh.js";import{a as o}from"./adminService-DjH-eKhp.js";const l={adminContainer:"_adminContainer_1hdis_8",sidebar:"_sidebar_1hdis_16",sidebarHeader:"_sidebarHeader_1hdis_27",sidebarLogo:"_sidebarLogo_1hdis_32",logoIcon:"_logoIcon_1hdis_38",logoText:"_logoText_1hdis_50",logoSubtitle:"_logoSubtitle_1hdis_61",sidebarNav:"_sidebarNav_1hdis_69",navLabel:"_navLabel_1hdis_75",navItem:"_navItem_1hdis_84",active:"_active_1hdis_105",sidebarFooter:"_sidebarFooter_1hdis_121",userProfile:"_userProfile_1hdis_126",userAvatar:"_userAvatar_1hdis_135",userInfo:"_userInfo_1hdis_148",userName:"_userName_1hdis_153",userRole:"_userRole_1hdis_162",logoutBtn:"_logoutBtn_1hdis_168",mainContent:"_mainContent_1hdis_188",topBar:"_topBar_1hdis_194",mobileMenuBtn:"_mobileMenuBtn_1hdis_206",pageTitle:"_pageTitle_1hdis_216",topBarActions:"_topBarActions_1hdis_222",scannerBtn:"_scannerBtn_1hdis_228",contentArea:"_contentArea_1hdis_232",timeFilterBar:"_timeFilterBar_1hdis_238",timeFilterBtn:"_timeFilterBtn_1hdis_249",statsGridPrimary:"_statsGridPrimary_1hdis_275",statsGridSecondary:"_statsGridSecondary_1hdis_282",statsGrid:"_statsGrid_1hdis_275",statCard:"_statCard_1hdis_296",primaryStat:"_primaryStat_1hdis_306",bookings:"_bookings_1hdis_324",revenue:"_revenue_1hdis_325",trips:"_trips_1hdis_326",routes:"_routes_1hdis_327",statIcon:"_statIcon_1hdis_329",statLabel:"_statLabel_1hdis_344",statValue:"_statValue_1hdis_351",statHint:"_statHint_1hdis_361",card:"_card_1hdis_371",cardHeader:"_cardHeader_1hdis_379",cardTitle:"_cardTitle_1hdis_387",cardBody:"_cardBody_1hdis_393",tableContainer:"_tableContainer_1hdis_399",table:"_table_1hdis_399",sortableHeader:"_sortableHeader_1hdis_420",sortIcon:"_sortIcon_1hdis_431",sortIconHidden:"_sortIconHidden_1hdis_439",inactive:"_inactive_1hdis_462",fontSemibold:"_fontSemibold_1hdis_466",bookingRef:"_bookingRef_1hdis_470",seatBadge:"_seatBadge_1hdis_476",badge:"_badge_1hdis_488",scheduled:"_scheduled_1hdis_498",boarding:"_boarding_1hdis_499",departed:"_departed_1hdis_500",arrived:"_arrived_1hdis_501",cancelled:"_cancelled_1hdis_502",paid:"_paid_1hdis_505",pending:"_pending_1hdis_506",refunded:"_refunded_1hdis_507",full:"_full_1hdis_508",statusSelect:"_statusSelect_1hdis_510",btn:"_btn_1hdis_530",btnPrimary:"_btnPrimary_1hdis_545",btnAccent:"_btnAccent_1hdis_562",btnOutline:"_btnOutline_1hdis_573",btnSm:"_btnSm_1hdis_584",btnIcon:"_btnIcon_1hdis_589",danger:"_danger_1hdis_607",actionButtons:"_actionButtons_1hdis_612",filterBar:"_filterBar_1hdis_619",filterSelect:"_filterSelect_1hdis_627",searchBox:"_searchBox_1hdis_645",modalOverlay:"_modalOverlay_1hdis_677",fadeIn:"_fadeIn_1hdis_1",modal:"_modal_1hdis_677",slideUp:"_slideUp_1hdis_1",modalHeader:"_modalHeader_1hdis_699",modalTitle:"_modalTitle_1hdis_707",modalClose:"_modalClose_1hdis_713",modalBody:"_modalBody_1hdis_731",modalFooter:"_modalFooter_1hdis_735",formGroup:"_formGroup_1hdis_745",formLabel:"_formLabel_1hdis_749",formInput:"_formInput_1hdis_757",formRow:"_formRow_1hdis_774",dashboardGrid:"_dashboardGrid_1hdis_782",routesChart:"_routesChart_1hdis_789",routeItem:"_routeItem_1hdis_793",routeInfo:"_routeInfo_1hdis_804",routeName:"_routeName_1hdis_808",routeBar:"_routeBar_1hdis_815",routeBarFill:"_routeBarFill_1hdis_822",primary:"_primary_1hdis_306",accent:"_accent_1hdis_829",info:"_info_1hdis_830",success:"_success_1hdis_831",routeValue:"_routeValue_1hdis_833",checkboxWrapper:"_checkboxWrapper_1hdis_843",checkbox:"_checkbox_1hdis_843",checked:"_checked_1hdis_861",toast:"_toast_1hdis_869",error:"_error_1hdis_888",settingsSection:"_settingsSection_1hdis_894",settingsSectionTitle:"_settingsSectionTitle_1hdis_902",settingsRow:"_settingsRow_1hdis_911",settingsLabel:"_settingsLabel_1hdis_923",settingsDescription:"_settingsDescription_1hdis_930",toggle:"_toggle_1hdis_935",disabled:"_disabled_1hdis_950",emptyState:"_emptyState_1hdis_974",emptyStateIcon:"_emptyStateIcon_1hdis_979",emptyStateTitle:"_emptyStateTitle_1hdis_991",emptyStateText:"_emptyStateText_1hdis_998",emptyStateAction:"_emptyStateAction_1hdis_1004",loadingState:"_loadingState_1hdis_1010",errorState:"_errorState_1hdis_1016",skeleton:"_skeleton_1hdis_1037",shimmer:"_shimmer_1hdis_1",dashboardLoading:"_dashboardLoading_1hdis_1049",mobileOverlay:"_mobileOverlay_1hdis_1073",navBadge:"_navBadge_1hdis_1082",pulse:"_pulse_1hdis_1",supportContainer:"_supportContainer_1hdis_1105",conversationsList:"_conversationsList_1hdis_1113",conversationsHeader:"_conversationsHeader_1hdis_1124",totalUnreadBadge:"_totalUnreadBadge_1hdis_1138",conversationsFilter:"_conversationsFilter_1hdis_1152",conversationsBody:"_conversationsBody_1hdis_1167",emptyConversations:"_emptyConversations_1hdis_1172",conversationItem:"_conversationItem_1hdis_1194",selected:"_selected_1hdis_1208",closed:"_closed_1hdis_1213",conversationAvatar:"_conversationAvatar_1hdis_1217",conversationInfo:"_conversationInfo_1hdis_1231",conversationName:"_conversationName_1hdis_1236",unreadBadge:"_unreadBadge_1hdis_1245",conversationMeta:"_conversationMeta_1hdis_1259",statusDot:"_statusDot_1hdis_1268",open:"_open_1hdis_1275",conversationTime:"_conversationTime_1hdis_1287",chatArea:"_chatArea_1hdis_1294",chatHeader:"_chatHeader_1hdis_1304",chatHeaderInfo:"_chatHeaderInfo_1hdis_1313",chatHeaderAvatar:"_chatHeaderAvatar_1hdis_1319",chatHeaderActions:"_chatHeaderActions_1hdis_1344",chatMessages:"_chatMessages_1hdis_1349",noMessages:"_noMessages_1hdis_1359",chatMessage:"_chatMessage_1hdis_1349",adminMsg:"_adminMsg_1hdis_1384",userMsg:"_userMsg_1hdis_1388",messageBubble:"_messageBubble_1hdis_1392",messageTime:"_messageTime_1hdis_1418",chatInput:"_chatInput_1hdis_1430",noConversationSelected:"_noConversationSelected_1hdis_1472"},d={Dashboard:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),i.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),i.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"}),i.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"})]}),Bus:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M8 6v6m8-6v6M5 18v2m14-2v2M3 6h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6ZM3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2"}),i.jsx("circle",{cx:"7",cy:"15",r:"1"}),i.jsx("circle",{cx:"17",cy:"15",r:"1"})]}),Route:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("circle",{cx:"6",cy:"19",r:"3"}),i.jsx("path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15"}),i.jsx("circle",{cx:"18",cy:"5",r:"3"})]}),Booking:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),i.jsx("circle",{cx:"9",cy:"7",r:"4"}),i.jsx("path",{d:"m22 21-3-3m1.5-3.5a4 4 0 1 0-5.5 5.5"})]}),Settings:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),i.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),Scan:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),i.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),i.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),i.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),i.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),Plus:()=>i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:i.jsx("path",{d:"M12 5v14M5 12h14"})}),Edit:()=>i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),i.jsx("path",{d:"m15 5 4 4"})]}),Trash:()=>i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:i.jsx("path",{d:"M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})}),Search:()=>i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("circle",{cx:"11",cy:"11",r:"8"}),i.jsx("path",{d:"m21 21-4.3-4.3"})]}),Download:()=>i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:i.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"})}),Check:()=>i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:i.jsx("path",{d:"M20 6 9 17l-5-5"})}),X:()=>i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:i.jsx("path",{d:"M18 6 6 18M6 6l12 12"})}),TrendUp:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17"}),i.jsx("polyline",{points:"16 7 22 7 22 13"})]}),Logout:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),i.jsx("polyline",{points:"16 17 21 12 16 7"}),i.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),Menu:()=>i.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("line",{x1:"4",y1:"6",x2:"20",y2:"6"}),i.jsx("line",{x1:"4",y1:"12",x2:"20",y2:"12"}),i.jsx("line",{x1:"4",y1:"18",x2:"20",y2:"18"})]}),Refresh:()=>i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),i.jsx("path",{d:"M21 3v5h-5"}),i.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),i.jsx("path",{d:"M8 16H3v5"})]}),AlertCircle:()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),i.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),Chat:()=>i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:i.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),Send:()=>i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:i.jsx("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"})})},c=["Gaborone","Francistown","Maun","Kasane","Serowe","Mahalapye","Palapye","Nata","Lobatse","Selebi-Phikwe","Molepolole","Kanye"],h=e=>`P${Number(e||0).toLocaleString("en-BW",{minimumFractionDigits:2})}`,u=e=>e?new Date(e).toLocaleString("en-BW",{dateStyle:"medium",timeStyle:"short"}):"N/A",m=e=>{if(!e)return"N/A";return`${Math.floor(e/60)}h ${e%60}m`},_=({isOpen:e,onClose:s,title:t,children:a,footer:n})=>e?i.jsx("div",{className:l.modalOverlay,onClick:s,children:i.jsxs("div",{className:l.modal,onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:l.modalHeader,children:[i.jsx("h3",{className:l.modalTitle,children:t}),i.jsx("button",{className:l.modalClose,onClick:s,children:i.jsx(d.X,{})})]}),i.jsx("div",{className:l.modalBody,children:a}),n&&i.jsx("div",{className:l.modalFooter,children:n})]})}):null,x=({message:e,type:s,onClose:a})=>(t.useEffect(()=>{const e=setTimeout(a,3e3);return()=>clearTimeout(e)},[a]),i.jsx("div",{className:`${l.toast} ${l[s]}`,children:e})),p=({width:e="100%",height:s="20px"})=>i.jsx("div",{className:l.skeleton,style:{width:e,height:s}}),j=({icon:e,title:s,description:t,actionButton:a})=>i.jsxs("div",{className:l.emptyState,children:[i.jsx("div",{className:l.emptyStateIcon,children:i.jsx(e,{})}),i.jsx("div",{className:l.emptyStateTitle,children:s}),i.jsx("div",{className:l.emptyStateText,children:t}),a&&i.jsx("div",{className:l.emptyStateAction,children:a})]}),v=({showToast:e,onNavigateToTrips:s})=>{const[a,r]=t.useState(null),[c,m]=t.useState([]),[_,x]=t.useState([]),[v,g]=t.useState([]),[b,N]=t.useState(!0),[f,k]=t.useState(null),[y,S]=t.useState("week"),C=t.useCallback(async()=>{N(!0),k(null);try{const[e,s,t,a]=await Promise.all([o.getAdminStats(),o.getPopularRoutes(4),o.getTrips({upcoming:!0}),o.getBookings({})]);if(e.error)throw new Error(`Failed to load stats: ${e.error.message||e.error}`);s.error,t.error,a.error,r(e.data),m(s.data||[]),x((t.data||[]).slice(0,5)),g((a.data||[]).slice(0,5))}catch(s){n("Dashboard fetch error",s);const t=s.message||"Failed to load dashboard data";k(t),e(t,"error")}finally{N(!1)}},[e]);t.useEffect(()=>{C();const e=o.subscribeToBookings(()=>{C()});return()=>{null==e||e.unsubscribe()}},[C]);const w=()=>({week:"This Week",month:"This Month",days30:"Last 30 Days"}[y]||"This Week"),B=[{label:`Bookings ${w()}`,value:(null==a?void 0:a.bookings_this_week)||0,type:"bookings",icon:i.jsx(d.Booking,{})},{label:`${w()} Revenue`,value:h(null==a?void 0:a.revenue_this_week),type:"revenue",icon:i.jsx(d.TrendUp,{})}],$=[{label:"Active Trips",value:(null==a?void 0:a.active_trips)||0,type:"trips",icon:i.jsx(d.Bus,{})},{label:"Total Routes",value:(null==a?void 0:a.total_routes)||0,type:"routes",icon:i.jsx(d.Route,{})}],T=Math.max(...c.map(e=>e.bookings),1);return b?i.jsxs("div",{className:l.dashboardLoading,children:[i.jsx("div",{className:l.statsGridPrimary,children:[1,2].map(e=>i.jsxs("div",{className:l.statCard,children:[i.jsx(p,{width:"48px",height:"48px"}),i.jsx(p,{width:"60%",height:"14px"}),i.jsx(p,{width:"40%",height:"32px"})]},e))}),i.jsx("div",{className:l.statsGridSecondary,children:[3,4].map(e=>i.jsxs("div",{className:l.statCard,children:[i.jsx(p,{width:"48px",height:"48px"}),i.jsx(p,{width:"60%",height:"14px"}),i.jsx(p,{width:"40%",height:"32px"})]},e))})]}):f?i.jsxs("div",{className:l.errorState,children:[i.jsx(d.AlertCircle,{}),i.jsx("p",{children:f}),i.jsxs("button",{className:l.btnPrimary,onClick:C,children:[i.jsx(d.Refresh,{})," Retry"]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:l.timeFilterBar,children:[i.jsx("button",{className:`${l.timeFilterBtn} ${"week"===y?l.active:""}`,onClick:()=>S("week"),children:"This Week"}),i.jsx("button",{className:`${l.timeFilterBtn} ${"month"===y?l.active:""}`,onClick:()=>S("month"),children:"This Month"}),i.jsx("button",{className:`${l.timeFilterBtn} ${"days30"===y?l.active:""}`,onClick:()=>S("days30"),children:"Last 30 Days"})]}),i.jsx("div",{className:l.statsGridPrimary,children:B.map((e,s)=>i.jsxs("div",{className:`${l.statCard} ${l[e.type]} ${l.primaryStat}`,children:[i.jsx("div",{className:l.statIcon,children:e.icon}),i.jsx("div",{className:l.statLabel,children:e.label}),i.jsx("div",{className:l.statValue,children:e.value}),e.hint&&i.jsx("div",{className:l.statHint,children:e.hint})]},s))}),i.jsx("div",{className:l.statsGridSecondary,children:$.map((e,s)=>i.jsxs("div",{className:`${l.statCard} ${l[e.type]}`,children:[i.jsx("div",{className:l.statIcon,children:e.icon}),i.jsx("div",{className:l.statLabel,children:e.label}),i.jsx("div",{className:l.statValue,children:e.value})]},s))}),i.jsxs("div",{className:l.dashboardGrid,children:[i.jsxs("div",{className:l.card,children:[i.jsxs("div",{className:l.cardHeader,children:[i.jsx("h3",{className:l.cardTitle,children:"Upcoming Trips"}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsxs("button",{className:`${l.btn} ${l.btnOutline} ${l.btnSm}`,onClick:C,children:[i.jsx(d.Refresh,{})," Refresh"]}),i.jsxs("button",{className:`${l.btn} ${l.btnPrimary} ${l.btnSm}`,onClick:()=>s&&s(),children:[i.jsx(d.Plus,{})," Create Trip"]})]})]}),i.jsx("div",{className:l.cardBody,children:0===_.length?i.jsx(j,{icon:d.Bus,title:"No upcoming trips",description:"Create a trip to get started"}):i.jsx("div",{className:l.tableContainer,children:i.jsxs("table",{className:l.table,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Route"}),i.jsx("th",{children:"Departure"}),i.jsx("th",{children:"Status"})]})}),i.jsx("tbody",{children:_.map(e=>{var s,t;return i.jsxs("tr",{children:[i.jsxs("td",{className:l.fontSemibold,children:[null==(s=e.routes)?void 0:s.origin," â†’ ",null==(t=e.routes)?void 0:t.destination]}),i.jsx("td",{children:u(e.departure_time)}),i.jsx("td",{children:i.jsx("span",{className:`${l.badge} ${l[e.status]}`,children:"scheduled"===e.status?"On time":"boarding"===e.status?"Boarding":"departed"===e.status?"Delayed":e.status})})]},e.id)})})]})})})]}),i.jsxs("div",{className:l.card,children:[i.jsx("div",{className:l.cardHeader,children:i.jsx("h3",{className:l.cardTitle,children:"Popular Routes"})}),i.jsx("div",{className:l.routesChart,children:0===c.length?i.jsx(j,{icon:d.Route,title:"No data yet",description:"Bookings will appear here"}):c.map((e,s)=>i.jsxs("div",{className:l.routeItem,children:[i.jsxs("div",{className:l.routeInfo,children:[i.jsx("div",{className:l.routeName,children:e.name}),i.jsx("div",{className:l.routeBar,children:i.jsx("div",{className:`${l.routeBarFill} ${l[["primary","accent","info","success"][s%4]]}`,style:{width:e.bookings/T*100+"%"}})})]}),i.jsx("div",{className:l.routeValue,children:e.bookings})]},s))})]})]}),i.jsxs("div",{className:l.card,children:[i.jsx("div",{className:l.cardHeader,children:i.jsx("h3",{className:l.cardTitle,children:"Recent Bookings"})}),i.jsx("div",{className:l.cardBody,children:0===v.length?i.jsx(j,{icon:d.Booking,title:"No bookings yet",description:"No bookings yet. Once customers book from the app, you'll see them here."}):i.jsx("div",{className:l.tableContainer,children:i.jsxs("table",{className:l.table,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Reference"}),i.jsx("th",{children:"Passenger"}),i.jsx("th",{children:"Route"}),i.jsx("th",{children:"Status"})]})}),i.jsx("tbody",{children:v.map(e=>{var s,t,a,n;return i.jsxs("tr",{children:[i.jsx("td",{className:l.bookingRef,children:e.booking_reference}),i.jsx("td",{children:e.passenger_name}),i.jsxs("td",{children:[null==(t=null==(s=e.trips)?void 0:s.routes)?void 0:t.origin," â†’ ",null==(n=null==(a=e.trips)?void 0:a.routes)?void 0:n.destination]}),i.jsx("td",{children:i.jsx("span",{className:`${l.badge} ${l[e.payment_status]}`,children:e.payment_status})})]},e.id)})})]})})})]})]})},g=({showToast:e})=>{const[s,a]=t.useState([]),[c,m]=t.useState([]),[x,p]=t.useState([]),[v,g]=t.useState(!0),[b,N]=t.useState(null),[f,k]=t.useState(!1),[y,S]=t.useState(null),[C,w]=t.useState("all"),[B,$]=t.useState(!1),[T,L]=t.useState({route_id:"",bus_id:"",departure_time:"",price:"",total_seats:"45"}),R=t.useCallback(async()=>{g(!0),N(null);try{const[e,s,t]=await Promise.all([o.getTrips("all"!==C?{status:C}:{}),o.getRoutes(),o.getBuses()]);a(e.data||[]),m(s.data||[]),p(t.data||[])}catch(s){const t=s.message||"Failed to load trips";N(t),e(t,"error")}finally{g(!1)}},[C,e]);t.useEffect(()=>{R()},[R]);const I=(e=null)=>{var s,t,a;e?(S(e),L({route_id:e.route_id,bus_id:e.bus_id||"",departure_time:(null==(s=e.departure_time)?void 0:s.slice(0,16))||"",price:(null==(t=e.price)?void 0:t.toString())||"",total_seats:(null==(a=e.total_seats)?void 0:a.toString())||"45"})):(S(null),L({route_id:"",bus_id:"",departure_time:"",price:"",total_seats:"45"})),k(!0)};return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:l.filterBar,children:[i.jsxs("select",{className:l.filterSelect,value:C,onChange:e=>w(e.target.value),children:[i.jsx("option",{value:"all",children:"All Status"}),i.jsx("option",{value:"scheduled",children:"Scheduled"}),i.jsx("option",{value:"boarding",children:"Boarding"}),i.jsx("option",{value:"departed",children:"Departed"}),i.jsx("option",{value:"cancelled",children:"Cancelled"})]}),i.jsx("div",{style:{flex:1}}),i.jsx("button",{className:`${l.btn} ${l.btnOutline}`,onClick:R,children:i.jsx(d.Refresh,{})}),i.jsxs("button",{className:`${l.btn} ${l.btnAccent}`,onClick:()=>I(),children:[i.jsx(d.Plus,{})," Create Trip"]})]}),i.jsx("div",{className:l.card,children:i.jsx("div",{className:l.cardBody,children:v?i.jsx("div",{className:l.loadingState,children:"Loading trips..."}):b?i.jsxs("div",{className:l.errorState,children:[i.jsx(d.AlertCircle,{}),i.jsxs("p",{children:["Could not load trips. ",b]}),i.jsxs("button",{className:`${l.btn} ${l.btnPrimary}`,onClick:R,children:[i.jsx(d.Refresh,{})," Retry"]})]}):0===s.length?i.jsx(j,{icon:d.Bus,title:"No trips found",description:"Create your first trip to start selling tickets on this route.",actionButton:i.jsxs("button",{className:`${l.btn} ${l.btnAccent} ${l.btnSm}`,onClick:()=>I(),children:[i.jsx(d.Plus,{})," Create Trip"]})}):i.jsx("div",{className:l.tableContainer,children:i.jsxs("table",{className:l.table,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Route"}),i.jsx("th",{children:"Departure"}),i.jsx("th",{children:"Price"}),i.jsx("th",{children:"Seats"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:s.map(s=>{var t,a;return i.jsxs("tr",{children:[i.jsxs("td",{className:l.fontSemibold,children:[null==(t=s.routes)?void 0:t.origin," â†’ ",null==(a=s.routes)?void 0:a.destination]}),i.jsx("td",{children:u(s.departure_time)}),i.jsx("td",{children:h(s.price)}),i.jsxs("td",{children:[s.available_seats,"/",s.total_seats]}),i.jsx("td",{children:i.jsxs("select",{className:`${l.statusSelect} ${l[s.status]}`,value:s.status,onChange:t=>(async(s,t)=>{try{const{error:a}=await o.updateTripStatus(s,t);if(a)throw a;e("Trip status updated","success"),R()}catch(a){e("Failed to update status","error")}})(s.id,t.target.value),children:[i.jsx("option",{value:"scheduled",children:"Scheduled"}),i.jsx("option",{value:"boarding",children:"Boarding"}),i.jsx("option",{value:"departed",children:"Departed"}),i.jsx("option",{value:"arrived",children:"Arrived"}),i.jsx("option",{value:"cancelled",children:"Cancelled"})]})}),i.jsx("td",{children:i.jsxs("div",{className:l.actionButtons,children:[i.jsx("button",{className:l.btnIcon,onClick:()=>I(s),children:i.jsx(d.Edit,{})}),i.jsx("button",{className:`${l.btnIcon} ${l.danger}`,onClick:()=>(async s=>{if(window.confirm("Are you sure you want to delete this trip?"))try{const{error:t,cancelled:a}=await o.deleteTrip(s);if(t)throw t;e(a?"Trip cancelled (has bookings)":"Trip deleted","success"),R()}catch(t){e("Failed to delete trip","error")}})(s.id),children:i.jsx(d.Trash,{})})]})})]},s.id)})})]})})})}),i.jsxs(_,{isOpen:f,onClose:()=>k(!1),title:y?"Edit Trip":"Create New Trip",footer:i.jsxs(i.Fragment,{children:[i.jsx("button",{className:`${l.btn} ${l.btnOutline}`,onClick:()=>k(!1),children:"Cancel"}),i.jsx("button",{className:`${l.btn} ${l.btnPrimary}`,onClick:async()=>{if(T.route_id&&T.departure_time&&T.price){$(!0);try{const{validateUUID:s}=await r(async()=>{const{validateUUID:e}=await import("./index-xoP6dWRh.js").then(e=>e.Q);return{validateUUID:e}},__vite__mapDeps([0,1])),t=T.bus_id&&s(T.bus_id)?T.bus_id:null,a=c.find(e=>e.id===T.route_id),i=new Date(T.departure_time),n=(null==a?void 0:a.duration_minutes)||300,l=new Date(i.getTime()+6e4*n),d={route_id:T.route_id,bus_id:t,departure_time:i.toISOString(),arrival_time:l.toISOString(),price:parseFloat(T.price),total_seats:parseInt(T.total_seats)};if(y){const{error:s}=await o.updateTrip(y.id,d);if(s)throw s;e("Trip updated successfully","success")}else{const{error:s}=await o.createTrip(d);if(s)throw s;e("Trip created successfully","success")}k(!1),R()}catch(s){n("Failed to save trip",s),e(s.message||"Failed to save trip","error")}finally{$(!1)}}else e("Please fill in all required fields","error")},disabled:B,children:B?"Saving...":y?"Update Trip":"Create Trip"})]}),children:[i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Route *"}),i.jsxs("select",{className:l.formInput,value:T.route_id,onChange:e=>L({...T,route_id:e.target.value}),children:[i.jsx("option",{value:"",children:"Select Route"}),c.map(e=>i.jsxs("option",{value:e.id,children:[e.origin," â†’ ",e.destination," (",h(e.base_price),")"]},e.id))]})]}),i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Bus (Optional)"}),i.jsxs("select",{className:l.formInput,value:T.bus_id,onChange:e=>L({...T,bus_id:e.target.value}),children:[i.jsx("option",{value:"",children:"Select Bus"}),i.jsxs("optgroup",{label:"ðŸš Major Botswana Bus & Coach Operators",children:[i.jsx("option",{value:"nkk_express",children:"NKK Express"}),i.jsx("option",{value:"att_monnakgotla",children:"AT & T Monnakgotla Transport"}),i.jsx("option",{value:"seabelo_express",children:"Seabelo Express"}),i.jsx("option",{value:"mahube_express",children:"Mahube & Sons Express / Mahube Express"}),i.jsx("option",{value:"w_khanda",children:"W Khanda Bus Services"}),i.jsx("option",{value:"golden_bridge",children:"Golden Bridge Express"}),i.jsx("option",{value:"mokoka_express",children:"Mokoka Express"}),i.jsx("option",{value:"bamangwato",children:"Bamangwato Coach Tours"}),i.jsx("option",{value:"city_bus",children:"City Bus Coaches"}),i.jsx("option",{value:"flight_connect",children:"Flight Connect (Bus Service)"})]}),i.jsxs("optgroup",{label:"ðŸšŒ Regional / Cross-Border Operators",children:[i.jsx("option",{value:"intercape",children:"Intercape"}),i.jsx("option",{value:"hope_diamond",children:"Hope Diamond Transport"})]}),x.length>0&&i.jsx("optgroup",{label:"Registered Buses",children:x.map(e=>i.jsxs("option",{value:e.id,children:[e.bus_name," (",e.registration_number,") - ",e.total_seats," seats"]},e.id))})]})]}),i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Departure Date & Time *"}),i.jsx("input",{type:"datetime-local",className:l.formInput,value:T.departure_time,onChange:e=>L({...T,departure_time:e.target.value})})]}),i.jsxs("div",{className:l.formRow,children:[i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Price (BWP) *"}),i.jsx("input",{type:"number",className:l.formInput,placeholder:"450",value:T.price,onChange:e=>L({...T,price:e.target.value})})]}),i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Total Seats"}),i.jsx("input",{type:"number",className:l.formInput,placeholder:"45",value:T.total_seats,onChange:e=>L({...T,total_seats:e.target.value})})]})]})]})]})},b=({showToast:e})=>{const[s,a]=t.useState([]),[n,r]=t.useState(!0),[c,m]=t.useState(null),[_,x]=t.useState("all"),[p,v]=t.useState(""),g=t.useCallback(async()=>{r(!0),m(null);try{const e={};"all"!==_&&(e.paymentStatus=_),p&&(e.search=p);const{data:s,error:t}=await o.getBookings(e);if(t)throw t;a(s||[])}catch(s){const t=s.message||"Failed to load bookings";m(t),e(t,"error")}finally{r(!1)}},[_,p,e]);t.useEffect(()=>{g();const e=o.subscribeToBookings(()=>{g()});return()=>{null==e||e.unsubscribe()}},[g]);return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:l.filterBar,children:[i.jsxs("div",{className:l.searchBox,children:[i.jsx(d.Search,{}),i.jsx("input",{type:"text",placeholder:"Search by name, phone, or reference...",value:p,onChange:e=>v(e.target.value),onKeyDown:e=>"Enter"===e.key&&g()})]}),i.jsxs("select",{className:l.filterSelect,value:_,onChange:e=>x(e.target.value),children:[i.jsx("option",{value:"all",children:"All Status"}),i.jsx("option",{value:"paid",children:"Paid"}),i.jsx("option",{value:"pending",children:"Pending"}),i.jsx("option",{value:"refunded",children:"Refunded"})]}),i.jsxs("button",{className:`${l.btn} ${l.btnOutline}`,onClick:async()=>{try{const s=await o.exportBookingsToCSV({paymentStatus:"all"!==_?_:void 0});if(!s)return void e("No bookings to export","error");const t=new Blob([s],{type:"text/csv"}),a=URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`bookings-${(new Date).toISOString().split("T")[0]}.csv`,i.click(),URL.revokeObjectURL(a),e("Bookings exported successfully","success")}catch(s){e("Failed to export bookings","error")}},children:[i.jsx(d.Download,{})," Export CSV"]})]}),i.jsx("div",{className:l.card,children:i.jsx("div",{className:l.cardBody,children:n?i.jsx("div",{className:l.loadingState,children:"Loading bookings..."}):c?i.jsxs("div",{className:l.errorState,children:[i.jsx(d.AlertCircle,{}),i.jsxs("p",{children:["Could not load bookings. ",c]}),i.jsxs("button",{className:`${l.btn} ${l.btnPrimary}`,onClick:g,children:[i.jsx(d.Refresh,{})," Retry"]})]}):0===s.length?i.jsx(j,{icon:d.Booking,title:"No bookings found",description:"When customers book, their tickets will appear here. You can filter by trip, status, or phone number."}):i.jsx("div",{className:l.tableContainer,children:i.jsxs("table",{className:l.table,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Reference"}),i.jsx("th",{children:"Passenger"}),i.jsx("th",{children:"Phone"}),i.jsx("th",{children:"Route"}),i.jsx("th",{children:"Departure"}),i.jsx("th",{children:"Seat"}),i.jsx("th",{children:"Amount"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Boarded"})]})}),i.jsx("tbody",{children:s.map(s=>{var t,a,n,r,c;return i.jsxs("tr",{children:[i.jsx("td",{className:l.bookingRef,children:s.booking_reference}),i.jsx("td",{className:l.fontSemibold,children:s.passenger_name}),i.jsx("td",{children:s.passenger_phone}),i.jsxs("td",{children:[null==(a=null==(t=s.trips)?void 0:t.routes)?void 0:a.origin," â†’ ",null==(r=null==(n=s.trips)?void 0:n.routes)?void 0:r.destination]}),i.jsx("td",{children:u(null==(c=s.trips)?void 0:c.departure_time)}),i.jsx("td",{children:i.jsx("span",{className:l.seatBadge,children:s.seat_number})}),i.jsx("td",{children:h(s.total_amount)}),i.jsx("td",{children:i.jsx("span",{className:`${l.badge} ${l[s.payment_status]}`,children:s.payment_status})}),i.jsx("td",{children:i.jsx("div",{className:l.checkboxWrapper,onClick:()=>(async s=>{try{s.is_boarded?await o.unmarkAsBoarded(s.id):await o.markAsBoarded(s.id),e("Boarding status updated","success"),g()}catch(t){e("Failed to update boarding status","error")}})(s),children:i.jsx("div",{className:`${l.checkbox} ${s.is_boarded?l.checked:""}`,children:s.is_boarded&&i.jsx(d.Check,{})})})})]},s.id)})})]})})})})]})},N=({showToast:e})=>{const[s,a]=t.useState([]),[n,r]=t.useState(!0),[u,x]=t.useState(null),[p,v]=t.useState(!1),[g,b]=t.useState(null),[N,f]=t.useState(!1),[k,y]=t.useState(null),[S,C]=t.useState("asc"),[w,B]=t.useState({origin:"",destination:"",distance_km:"",duration_minutes:"",base_price:""}),$=t.useCallback(async()=>{r(!0),x(null);try{const{data:e,error:s}=await o.getRoutes(!0);if(s)throw s;a(e||[])}catch(s){const t=s.message||"Failed to load routes";x(t),e(t,"error")}finally{r(!1)}},[e]);t.useEffect(()=>{$()},[$]);const T=(e=null)=>{var s,t,a;e?(b(e),B({origin:e.origin,destination:e.destination,distance_km:(null==(s=e.distance_km)?void 0:s.toString())||"",duration_minutes:(null==(t=e.duration_minutes)?void 0:t.toString())||"",base_price:(null==(a=e.base_price)?void 0:a.toString())||""})):(b(null),B({origin:"",destination:"",distance_km:"",duration_minutes:"",base_price:""})),v(!0)},L=e=>{k===e?C("asc"===S?"desc":"asc"):(y(e),C("asc"))},R=[...s].sort((e,s)=>{if(!k)return 0;let t,a;if("distance"===k)t=e.distance_km||0,a=s.distance_km||0;else{if("duration"!==k)return 0;t=e.duration_minutes||0,a=s.duration_minutes||0}return"asc"===S?t-a:a-t});return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:l.filterBar,children:[i.jsx("div",{style:{flex:1}}),i.jsx("button",{className:`${l.btn} ${l.btnOutline}`,onClick:$,children:i.jsx(d.Refresh,{})}),i.jsxs("button",{className:`${l.btn} ${l.btnAccent}`,onClick:()=>T(),children:[i.jsx(d.Plus,{})," Add Route"]})]}),i.jsx("div",{className:l.card,children:i.jsx("div",{className:l.cardBody,children:n?i.jsx("div",{className:l.loadingState,children:"Loading routes..."}):u?i.jsxs("div",{className:l.errorState,children:[i.jsx(d.AlertCircle,{}),i.jsxs("p",{children:["Could not load routes. ",u]}),i.jsxs("button",{className:`${l.btn} ${l.btnPrimary}`,onClick:$,children:[i.jsx(d.Refresh,{})," Retry"]})]}):0===s.length?i.jsx(j,{icon:d.Route,title:"No routes found",description:"Add your first route to get started"}):i.jsx("div",{className:l.tableContainer,children:i.jsxs("table",{className:l.table,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Origin"}),i.jsx("th",{children:"Destination"}),i.jsxs("th",{className:l.sortableHeader,onClick:()=>L("distance"),title:"Click to sort",children:["Distance","distance"===k&&i.jsx("span",{className:l.sortIcon,children:"asc"===S?"â†‘":"â†“"}),"distance"!==k&&i.jsx("span",{className:`${l.sortIcon} ${l.sortIconHidden}`,children:"â†‘â†“"})]}),i.jsxs("th",{className:l.sortableHeader,onClick:()=>L("duration"),title:"Click to sort",children:["Duration","duration"===k&&i.jsx("span",{className:l.sortIcon,children:"asc"===S?"â†‘":"â†“"}),"duration"!==k&&i.jsx("span",{className:`${l.sortIcon} ${l.sortIconHidden}`,children:"â†‘â†“"})]}),i.jsx("th",{children:"Base Fare"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:R.map(s=>i.jsxs("tr",{className:s.is_active?"":l.inactive,children:[i.jsx("td",{className:l.fontSemibold,children:s.origin}),i.jsx("td",{className:l.fontSemibold,children:s.destination}),i.jsx("td",{children:s.distance_km?`${s.distance_km} km`:"N/A"}),i.jsx("td",{children:m(s.duration_minutes)}),i.jsx("td",{children:s.base_price?h(s.base_price):"N/A"}),i.jsx("td",{children:i.jsx("span",{className:`${l.badge} ${s.is_active?l.active:l.inactive}`,children:s.is_active?"Active":"Inactive"})}),i.jsx("td",{children:i.jsxs("div",{className:l.actionButtons,children:[i.jsx("button",{className:l.btnIcon,onClick:()=>T(s),children:i.jsx(d.Edit,{})}),i.jsx("button",{className:`${l.btnIcon} ${l.danger}`,onClick:()=>(async s=>{if(window.confirm("Are you sure you want to delete this route?"))try{const{error:t}=await o.deleteRoute(s);if(t)throw t;e("Route deleted","success"),$()}catch(t){e("Failed to delete route","error")}})(s.id),children:i.jsx(d.Trash,{})})]})})]},s.id))})]})})})}),i.jsxs(_,{isOpen:p,onClose:()=>v(!1),title:g?"Edit Route":"Add New Route",footer:i.jsxs(i.Fragment,{children:[i.jsx("button",{className:`${l.btn} ${l.btnOutline}`,onClick:()=>v(!1),children:"Cancel"}),i.jsx("button",{className:`${l.btn} ${l.btnPrimary}`,onClick:async()=>{if(w.origin&&w.destination&&w.base_price)if(w.origin!==w.destination){f(!0);try{const s={origin:w.origin,destination:w.destination,distance_km:w.distance_km?parseFloat(w.distance_km):null,duration_minutes:w.duration_minutes?parseInt(w.duration_minutes):null,base_price:parseFloat(w.base_price)};if(g){const{error:t}=await o.updateRoute(g.id,s);if(t)throw t;e("Route updated successfully","success")}else{const{error:t}=await o.createRoute(s);if(t)throw t;e("Route created successfully","success")}v(!1),$()}catch(s){e(s.message||"Failed to save route","error")}finally{f(!1)}}else e("Origin and destination must be different","error");else e("Please fill in all required fields","error")},disabled:N,children:N?"Saving...":g?"Update Route":"Add Route"})]}),children:[i.jsxs("div",{className:l.formRow,children:[i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Origin *"}),i.jsxs("select",{className:l.formInput,value:w.origin,onChange:e=>B({...w,origin:e.target.value}),children:[i.jsx("option",{value:"",children:"Select City"}),c.map(e=>i.jsx("option",{value:e,children:e},e))]})]}),i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Destination *"}),i.jsxs("select",{className:l.formInput,value:w.destination,onChange:e=>B({...w,destination:e.target.value}),children:[i.jsx("option",{value:"",children:"Select City"}),c.map(e=>i.jsx("option",{value:e,children:e},e))]})]})]}),i.jsxs("div",{className:l.formRow,children:[i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Distance (km)"}),i.jsx("input",{type:"number",className:l.formInput,placeholder:"e.g., 430",value:w.distance_km,onChange:e=>B({...w,distance_km:e.target.value})})]}),i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Duration (minutes)"}),i.jsx("input",{type:"number",className:l.formInput,placeholder:"e.g., 300",value:w.duration_minutes,onChange:e=>B({...w,duration_minutes:e.target.value})})]})]}),i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Base Price (BWP) *"}),i.jsx("input",{type:"number",className:l.formInput,placeholder:"320",value:w.base_price,onChange:e=>B({...w,base_price:e.target.value})})]})]})]})},f=({showToast:e})=>{const[s,a]=t.useState({company_name:"",support_phone:"",support_email:"",booking_enabled:!0,auto_confirm_bookings:!1,require_payment_upfront:!0}),[n,r]=t.useState(!0),[d,c]=t.useState(!1);t.useEffect(()=>{(async()=>{r(!0);try{const{data:e,error:s}=await o.getSettings();if(s)throw s;a({company_name:e.company_name||"GOGOBUS Botswana",support_phone:e.support_phone||"+267 12 345 678",support_email:e.support_email||"support@gogobus.co.bw",booking_enabled:!1!==e.booking_enabled,auto_confirm_bookings:!0===e.auto_confirm_bookings,require_payment_upfront:!1!==e.require_payment_upfront})}catch(s){e("Failed to load settings","error")}finally{r(!1)}})()},[e]);const h=({active:e,onClick:s,disabled:t})=>i.jsx("div",{className:`${l.toggle} ${e?l.active:""} ${t?l.disabled:""}`,onClick:t?void 0:s});return n?i.jsx("div",{className:l.loadingState,children:"Loading settings..."}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:l.settingsSection,children:[i.jsx("h3",{className:l.settingsSectionTitle,children:"Company Information"}),i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Company Name"}),i.jsx("input",{type:"text",className:l.formInput,value:s.company_name,onChange:e=>a({...s,company_name:e.target.value})})]}),i.jsxs("div",{className:l.formRow,children:[i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Support Phone"}),i.jsx("input",{type:"text",className:l.formInput,value:s.support_phone,onChange:e=>a({...s,support_phone:e.target.value})})]}),i.jsxs("div",{className:l.formGroup,children:[i.jsx("label",{className:l.formLabel,children:"Support Email"}),i.jsx("input",{type:"email",className:l.formInput,value:s.support_email,onChange:e=>a({...s,support_email:e.target.value})})]})]})]}),i.jsxs("div",{className:l.settingsSection,children:[i.jsx("h3",{className:l.settingsSectionTitle,children:"Booking Settings"}),i.jsxs("div",{className:l.settingsRow,children:[i.jsxs("div",{children:[i.jsx("div",{className:l.settingsLabel,children:"Enable Bookings"}),i.jsx("div",{className:l.settingsDescription,children:"Allow customers to make new bookings"})]}),i.jsx(h,{active:s.booking_enabled,onClick:()=>a({...s,booking_enabled:!s.booking_enabled})})]}),i.jsxs("div",{className:l.settingsRow,children:[i.jsxs("div",{children:[i.jsx("div",{className:l.settingsLabel,children:"Auto-confirm Bookings"}),i.jsx("div",{className:l.settingsDescription,children:"Automatically confirm bookings without manual review"})]}),i.jsx(h,{active:s.auto_confirm_bookings,onClick:()=>a({...s,auto_confirm_bookings:!s.auto_confirm_bookings})})]}),i.jsxs("div",{className:l.settingsRow,children:[i.jsxs("div",{children:[i.jsx("div",{className:l.settingsLabel,children:"Require Payment Upfront"}),i.jsx("div",{className:l.settingsDescription,children:"Customers must pay before booking is confirmed"})]}),i.jsx(h,{active:s.require_payment_upfront,onClick:()=>a({...s,require_payment_upfront:!s.require_payment_upfront})})]})]}),i.jsx("button",{className:`${l.btn} ${l.btnPrimary}`,onClick:async()=>{c(!0);try{const{error:t}=await o.updateSettings(s);if(t)throw t;e("Settings saved successfully","success")}catch(t){e("Failed to save settings","error")}finally{c(!1)}},disabled:d,children:d?"Saving...":"Save Changes"})]})},k=({showToast:e})=>{var r,o,c,h,u;const{user:m}=s(),[_,x]=t.useState([]),[p,j]=t.useState(null),[v,g]=t.useState([]),[b,N]=t.useState(""),[f,k]=t.useState(!0),[y,S]=t.useState(!1),[C,w]=t.useState("all"),B=t.useRef(null),$=t.useRef(null),T=t.useRef(null),L=t.useRef(null),R=t.useCallback(()=>{var e;null==(e=B.current)||e.scrollIntoView({behavior:"smooth"})},[]),I=t.useCallback(async()=>{k(!0);try{const{data:e,error:s}=await a.getAllConversations({status:C});if(s)throw s;x(e||[])}catch(s){n("Error fetching conversations",s),e("Failed to load conversations","error")}finally{k(!1)}},[C,e,null==m?void 0:m.id]),M=t.useCallback(async e=>{try{const{data:s,error:t}=await a.getMessages(e);if(t)throw t;g(s||[]),await a.markMessagesAsRead(e,"admin"),I()}catch(s){n("Error fetching messages",s)}},[I]);t.useEffect(()=>{I()},[I]),t.useEffect(()=>(T.current=a.subscribeToConversations(()=>{I()}),()=>{T.current&&a.unsubscribe(T.current)}),[I]),t.useEffect(()=>{if(null==p?void 0:p.id)return M(p.id),L.current=a.subscribeToMessages(p.id,e=>{g(s=>s.some(s=>s.id===e.id)?s:[...s,e]),"user"===e.sender_type&&(a.markMessagesAsRead(p.id,"admin"),I()),R()}),()=>{L.current&&a.unsubscribe(L.current)}},[null==p?void 0:p.id,M,I,R]),t.useEffect(()=>{R()},[v,R]),t.useEffect(()=>{p&&setTimeout(()=>{var e;return null==(e=$.current)?void 0:e.focus()},100)},[p]);const A=e=>{const s=new Date(e),t=new Date-s,a=Math.floor(t/6e4),i=Math.floor(t/36e5),n=Math.floor(t/864e5);return a<1?"Just now":a<60?`${a}m ago`:i<24?`${i}h ago`:n<7?`${n}d ago`:s.toLocaleDateString("en-US",{month:"short",day:"numeric"})},F=_.reduce((e,s)=>e+(s.unread_count||0),0);return i.jsxs("div",{className:l.supportContainer,children:[i.jsxs("div",{className:l.conversationsList,children:[i.jsxs("div",{className:l.conversationsHeader,children:[i.jsx("h3",{children:"Conversations"}),F>0&&i.jsx("span",{className:l.totalUnreadBadge,children:F})]}),i.jsxs("div",{className:l.conversationsFilter,children:[i.jsxs("select",{className:l.filterSelect,value:C,onChange:e=>w(e.target.value),children:[i.jsx("option",{value:"all",children:"All"}),i.jsx("option",{value:"open",children:"Open"}),i.jsx("option",{value:"closed",children:"Closed"})]}),i.jsx("button",{className:`${l.btn} ${l.btnOutline} ${l.btnSm}`,onClick:I,children:i.jsx(d.Refresh,{})})]}),i.jsx("div",{className:l.conversationsBody,children:f?i.jsx("div",{className:l.loadingState,children:"Loading..."}):0===_.length?i.jsxs("div",{className:l.emptyConversations,children:[i.jsx(d.Chat,{}),i.jsx("p",{children:"No conversations yet"})]}):_.map(e=>{var s,t,a,n,r;return i.jsxs("div",{className:`${l.conversationItem} ${(null==p?void 0:p.id)===e.id?l.selected:""} ${"closed"===e.status?l.closed:""}`,onClick:()=>j(e),children:[i.jsx("div",{className:l.conversationAvatar,children:(null==(a=null==(t=null==(s=e.user)?void 0:s.full_name)?void 0:t.charAt(0))?void 0:a.toUpperCase())||"?"}),i.jsxs("div",{className:l.conversationInfo,children:[i.jsxs("div",{className:l.conversationName,children:[(null==(n=e.user)?void 0:n.full_name)||"Unknown User",e.unread_count>0&&i.jsx("span",{className:l.unreadBadge,children:e.unread_count})]}),i.jsxs("div",{className:l.conversationMeta,children:[i.jsx("span",{className:`${l.statusDot} ${l[e.status]}`}),(null==(r=e.user)?void 0:r.phone_number)||"No phone"]})]}),i.jsx("div",{className:l.conversationTime,children:A(e.updated_at)})]},e.id)})})]}),i.jsx("div",{className:l.chatArea,children:p?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:l.chatHeader,children:[i.jsxs("div",{className:l.chatHeaderInfo,children:[i.jsx("div",{className:l.chatHeaderAvatar,children:(null==(c=null==(o=null==(r=p.user)?void 0:r.full_name)?void 0:o.charAt(0))?void 0:c.toUpperCase())||"?"}),i.jsxs("div",{children:[i.jsx("h4",{children:(null==(h=p.user)?void 0:h.full_name)||"Unknown User"}),i.jsx("span",{children:(null==(u=p.user)?void 0:u.phone_number)||"No phone"})]})]}),i.jsx("div",{className:l.chatHeaderActions,children:"open"===p.status?i.jsxs("button",{className:`${l.btn} ${l.btnOutline} ${l.btnSm}`,onClick:()=>(async s=>{try{const{error:t}=await a.closeConversation(s,m.id);if(t)throw t;e("Conversation closed","success"),(null==p?void 0:p.id)===s&&(j(null),g([])),I()}catch(t){e("Failed to close conversation","error")}})(p.id),children:[i.jsx(d.Check,{})," Close"]}):i.jsxs("button",{className:`${l.btn} ${l.btnAccent} ${l.btnSm}`,onClick:()=>(async s=>{try{const{error:t}=await a.reopenConversation(s);if(t)throw t;e("Conversation reopened","success"),I()}catch(t){e("Failed to reopen conversation","error")}})(p.id),children:[i.jsx(d.Refresh,{})," Reopen"]})})]}),i.jsxs("div",{className:l.chatMessages,children:[0===v.length?i.jsxs("div",{className:l.noMessages,children:[i.jsx(d.Chat,{}),i.jsx("p",{children:"No messages in this conversation yet"})]}):v.map(e=>{return i.jsx("div",{className:`${l.chatMessage} ${"admin"===e.sender_type?l.adminMsg:l.userMsg}`,children:i.jsxs("div",{className:l.messageBubble,children:[i.jsx("p",{children:e.content}),i.jsx("span",{className:l.messageTime,children:(s=e.created_at,new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}))})]})},e.id);var s}),i.jsx("div",{ref:B})]}),i.jsxs("form",{className:l.chatInput,onSubmit:async s=>{if(s.preventDefault(),!b.trim()||!(null==p?void 0:p.id)||y)return;const t=b.trim();N(""),S(!0);try{const{error:s}=await a.sendMessage(p.id,m.id,t,"admin");s&&(N(t),e("Failed to send message","error"))}catch(i){N(t),e("Failed to send message","error")}finally{S(!1)}},children:[i.jsx("input",{ref:$,type:"text",placeholder:"closed"===p.status?"Reopen to reply...":"Type your reply...",value:b,onChange:e=>N(e.target.value),disabled:y||"closed"===p.status}),i.jsx("button",{type:"submit",className:`${l.btn} ${l.btnPrimary}`,disabled:!b.trim()||y||"closed"===p.status,children:y?i.jsx(d.Refresh,{}):i.jsx(d.Send,{})})]})]}):i.jsxs("div",{className:l.noConversationSelected,children:[i.jsx(d.Chat,{}),i.jsx("h3",{children:"Select a conversation"}),i.jsx("p",{children:"Choose a conversation from the list to start responding"})]})})]})};function y(){var n,r;const o=e(),{user:c,userProfile:h,logout:u}=s(),[m,_]=t.useState("dashboard"),[p,j]=t.useState(!1),[y,S]=t.useState(null),C=t.useCallback((e,s="success")=>{S({message:e,type:s})},[]),[w,B]=t.useState(0);t.useEffect(()=>{const e=async()=>{const{count:e}=await a.getAdminUnreadCount();B(e)};e();const s=a.subscribeToAllMessages(()=>{e()});return()=>{s&&a.unsubscribe(s)}},[]);const $=[{id:"dashboard",label:"Dashboard",icon:i.jsx(d.Dashboard,{})},{id:"trips",label:"Trips",icon:i.jsx(d.Bus,{})},{id:"routes",label:"Routes",icon:i.jsx(d.Route,{})},{id:"bookings",label:"Bookings",icon:i.jsx(d.Booking,{})},{id:"support",label:"Support",icon:i.jsx(d.Chat,{}),badge:w},{id:"scanner",label:"Scanner",icon:i.jsx(d.Scan,{}),action:()=>o("/admin/scanner")},{id:"settings",label:"Settings",icon:i.jsx(d.Settings,{})}],T=()=>{_("trips")},L=(null==h?void 0:h.full_name)?h.full_name.split(" ").map(e=>e[0]).join("").toUpperCase():(null==(r=null==(n=null==c?void 0:c.email)?void 0:n[0])?void 0:r.toUpperCase())||"A";return i.jsxs("div",{className:l.adminContainer,children:[i.jsxs("aside",{className:`${l.sidebar} ${p?l.open:""}`,children:[i.jsx("div",{className:l.sidebarHeader,children:i.jsxs("div",{className:l.sidebarLogo,children:[i.jsx("div",{className:l.logoIcon,children:"ðŸšŒ"}),i.jsxs("div",{children:[i.jsxs("div",{className:l.logoText,children:["GOGO",i.jsx("span",{children:"BUS"})]}),i.jsx("div",{className:l.logoSubtitle,children:"Admin Portal"})]})]})}),i.jsxs("nav",{className:l.sidebarNav,children:[i.jsx("div",{className:l.navLabel,children:"Main Menu"}),$.map(e=>i.jsxs("div",{className:`${l.navItem} ${m===e.id?l.active:""}`,onClick:()=>{e.action?e.action():_(e.id),j(!1)},children:[e.icon,e.label,e.badge>0&&i.jsx("span",{className:l.navBadge,children:e.badge>9?"9+":e.badge})]},e.id))]}),i.jsx("div",{className:l.sidebarFooter,children:i.jsxs("div",{className:l.userProfile,children:[i.jsx("div",{className:l.userAvatar,children:L}),i.jsxs("div",{className:l.userInfo,children:[i.jsx("div",{className:l.userName,children:(null==h?void 0:h.full_name)||"Admin"}),i.jsx("div",{className:l.userRole,children:(null==h?void 0:h.role)||"admin"})]}),i.jsx("button",{className:l.logoutBtn,onClick:async()=>{try{await u(),o("/login")}catch(e){C("Failed to logout","error")}},children:i.jsx(d.Logout,{})})]})})]}),i.jsxs("main",{className:l.mainContent,children:[i.jsxs("header",{className:l.topBar,children:[i.jsx("button",{className:l.mobileMenuBtn,onClick:()=>j(!p),children:i.jsx(d.Menu,{})}),i.jsx("h1",{className:l.pageTitle,children:{dashboard:"Dashboard",trips:"Trip Management",routes:"Routes Management",bookings:"Bookings Overview",support:"Customer Support",settings:"Settings"}[m]}),i.jsx("div",{className:l.topBarActions,children:i.jsxs("button",{className:`${l.btn} ${l.btnPrimary} ${l.scannerBtn}`,onClick:()=>o("/admin/scanner"),children:[i.jsx(d.Scan,{})," Scanner"]})})]}),i.jsx("div",{className:l.contentArea,children:(()=>{switch(m){case"dashboard":default:return i.jsx(v,{showToast:C,onNavigateToTrips:T});case"trips":return i.jsx(g,{showToast:C});case"routes":return i.jsx(N,{showToast:C});case"bookings":return i.jsx(b,{showToast:C});case"support":return i.jsx(k,{showToast:C});case"settings":return i.jsx(f,{showToast:C})}})()})]}),y&&i.jsx(x,{message:y.message,type:y.type,onClose:()=>S(null)}),p&&i.jsx("div",{className:l.mobileOverlay,onClick:()=>j(!1)})]})}export{y as default};
