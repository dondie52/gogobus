import{u as a,r as e,j as n}from"./index-S2ZdPJqa.js";import{s,T as l,a as i,g as t}from"./trackingService-ClyeaWrg.js";const r="_card_zylro_1",o="_header_zylro_14",c="_headerIcon_zylro_23",d="_headerTitle_zylro_28",_="_loadingState_zylro_37",m="_errorState_zylro_38",u="_emptyState_zylro_39",h="_mapPreview_zylro_49",p="_previewMap_zylro_58",x="_mapContainer_zylro_63",j="_trackingMap_zylro_71",v="_emptyContent_zylro_76",N="_loadingSpinner_zylro_84",g="_errorIcon_zylro_98",y="_emptyIcon_zylro_99",z="_retryButton_zylro_108",f="_emptyText_zylro_124",k="_emptySubtext_zylro_132",b="_content_zylro_139",w="_infoRow_zylro_145",L="_infoLabel_zylro_157",S="_infoValue_zylro_164",I="_lastUpdated_zylro_172",C="_updateDot_zylro_184",M="_mapButton_zylro_197",T="_mapButtonIcon_zylro_221",$="_mapButtonArrow_zylro_225";function D(a){if(!a)return"Unknown";const e=new Date(a),n=new Date-e,s=Math.floor(n/1e3),l=Math.floor(s/60),i=Math.floor(l/60);return s<10?"Just now":s<60?`${s} sec ago`:l<60?`${l} min ago`:i<24?`${i} hr ago`:e.toLocaleDateString()}function E(a){return a?a.locationName?a.locationName:a.lat&&a.lng?`${a.lat.toFixed(4)}¬∞, ${a.lng.toFixed(4)}¬∞`:"Location unavailable":"Location unavailable"}function B({routeId:B,tripId:O,trip:F,bookingId:R,route:A}){const U=a(),[V,J]=e.useState(null),[P,q]=e.useState(!0),[G,H]=e.useState(null),[K,Q]=e.useState(null),W=O||B;e.useEffect(()=>{if(!W)return void q(!1);let a=!0;return async function(){try{q(!0),H(null);const e=await t(W);a&&(J(e),Q((null==e?void 0:e.recorded_at)||null))}catch(e){a&&H("Failed to load tracking data")}finally{a&&q(!1)}}(),()=>{a=!1}},[W]),e.useEffect(()=>{if(!W)return;const a=s(W,a=>{J(a),Q((null==a?void 0:a.recorded_at)||(new Date).toISOString())});return()=>{a()}},[W]),e.useEffect(()=>{if(!K)return;const a=setInterval(()=>{Q(a=>a)},1e4);return()=>clearInterval(a)},[K]);const X=e.useCallback(()=>{const a=B||O;a&&U(`/tracking/${a}`)},[U,B,O]);if(P)return n.jsxs("div",{className:r,children:[n.jsxs("div",{className:o,children:[n.jsx("span",{className:c,children:"üìç"}),n.jsx("h3",{className:d,children:"Live Tracking"})]}),n.jsxs("div",{className:_,children:[n.jsx("div",{className:N}),n.jsx("span",{children:"Loading tracking data..."})]})]});if(G)return n.jsxs("div",{className:r,children:[n.jsxs("div",{className:o,children:[n.jsx("span",{className:c,children:"üìç"}),n.jsx("h3",{className:d,children:"Live Tracking"})]}),n.jsxs("div",{className:m,children:[n.jsx("span",{className:g,children:"‚ö†Ô∏è"}),n.jsx("p",{children:G}),n.jsx("button",{className:z,onClick:()=>window.location.reload(),type:"button",children:"Retry"})]})]});if(!V){const a=(null==A?void 0:A.origin_lat)&&(null==A?void 0:A.origin_lng)?{lat:A.origin_lat,lng:A.origin_lng,name:A.origin}:null,e=(null==A?void 0:A.destination_lat)&&(null==A?void 0:A.destination_lng)?{lat:A.destination_lat,lng:A.destination_lng,name:A.destination}:null;return n.jsxs("div",{className:r,children:[n.jsxs("div",{className:o,children:[n.jsx("span",{className:c,children:"üìç"}),n.jsx("h3",{className:d,children:"Live Tracking"})]}),n.jsxs("div",{className:u,children:[(a||e)&&n.jsx("div",{className:h,children:n.jsx(l,{location:null,origin:a,destination:e,className:p})}),n.jsxs("div",{className:v,children:[n.jsx("span",{className:y,children:"üöå"}),n.jsx("p",{className:f,children:"Live tracking will be available once the bus departs."}),n.jsx("p",{className:k,children:"Check back closer to departure time."})]}),W&&n.jsxs("button",{type:"button",className:M,onClick:X,"aria-label":"Open live map view",children:[n.jsx("span",{className:T,children:"üó∫Ô∏è"}),"View Route Map",n.jsx("span",{className:$,children:"‚Üí"})]})]})]})}return n.jsxs("div",{className:r,children:[n.jsxs("div",{className:o,children:[n.jsx("span",{className:c,children:"üìç"}),n.jsx("h3",{className:d,children:"Live Tracking"}),V.status&&n.jsx(i,{status:V.status,size:"small"})]}),n.jsx("div",{className:x,children:n.jsx(l,{location:V,origin:(null==A?void 0:A.origin_lat)&&(null==A?void 0:A.origin_lng)?{lat:A.origin_lat,lng:A.origin_lng,name:A.origin}:null,destination:(null==A?void 0:A.destination_lat)&&(null==A?void 0:A.destination_lng)?{lat:A.destination_lat,lng:A.destination_lng,name:A.destination}:null,className:j})}),n.jsxs("div",{className:b,children:[n.jsxs("div",{className:w,children:[n.jsx("span",{className:L,children:"Current Location"}),n.jsx("span",{className:S,children:E(V)})]}),null!=V.speed&&n.jsxs("div",{className:w,children:[n.jsx("span",{className:L,children:"Speed"}),n.jsxs("span",{className:S,children:[Math.round(V.speed)," km/h"]})]}),n.jsxs("div",{className:w,children:[n.jsx("span",{className:L,children:"ETA"}),n.jsx("span",{className:S,children:(null==F?void 0:F.eta)||"Estimating..."})]}),n.jsxs("div",{className:I,children:[n.jsx("span",{className:C}),"Last updated: ",D(K)]})]}),n.jsxs("button",{type:"button",className:M,onClick:X,"aria-label":"Open live map view",children:[n.jsx("span",{className:T,children:"üó∫Ô∏è"}),"Open Live Map",n.jsx("span",{className:$,children:"‚Üí"})]})]})}export{B as L};
