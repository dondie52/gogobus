import{u as e,m as i,o as s,r as o,x as n,j as t}from"./index-xoP6dWRh.js";import{B as a}from"./Button-BJdHWzd-.js";import{Q as r}from"./QRCodeDisplay-BhwjLNFH.js";import{p as d,e as c}from"./paymentService-BNe-zQwM.js";import{s as l}from"./Booking.module-aEmucKHr.js";const h=()=>{const h=e(),[m]=i(),{booking:u,selectedRoute:g,selectedSeats:x,passengerDetails:j,clearBooking:p,setBooking:C}=s(),[k,v]=o.useState(!1),[f,y]=o.useState(!0),[b,N]=o.useState(!1),[w,B]=o.useState("details"),[T,M]=o.useState(!1);o.useEffect(()=>{const e=m.get("ref"),i="undefined"!=typeof window?window.location.hash||window.location.pathname:"unknown";fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"BookingConfirmation.jsx:18",message:"BookingConfirmation mounted",data:{hasBooking:!!u,bookingId:null==u?void 0:u.id,transactionRef:e,hasSelectedRoute:!!g,selectedSeatsCount:null==x?void 0:x.length,currentPath:i},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{})},[]),o.useEffect(()=>{var e,i,s;const o=m.get("ref");if(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"BookingConfirmation.jsx:24",message:"BookingConfirmation useEffect - checking booking",data:{hasBooking:!!u,bookingId:null==u?void 0:u.id,transactionRef:o,willRedirect:!u,willLoadFromRef:!u&&!!o},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),!u){const e=m.get("ref");return e?(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"BookingConfirmation.jsx:29",message:"Loading booking from transaction ref",data:{transactionRef:e},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),M(!0),void d.getPaymentByRef(e).then(({data:e,error:i})=>{const s=Array.isArray(null==e?void 0:e.bookings)?e.bookings[0]:null==e?void 0:e.bookings;if(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"BookingConfirmation.jsx:33",message:"Payment data fetched",data:{hasPaymentData:!!e,hasBooking:!!s,bookingId:null==s?void 0:s.id,isArray:Array.isArray(null==e?void 0:e.bookings),error:null==i?void 0:i.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),i||!e||!s)return fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"BookingConfirmation.jsx:36",message:"Failed to load booking - redirecting to home",data:{error:null==i?void 0:i.message,hasPaymentData:!!e,hasBooking:!!s,bookingsType:typeof(null==e?void 0:e.bookings)},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),M(!1),void h("/home");fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"BookingConfirmation.jsx:41",message:"Setting booking from payment data",data:{bookingId:s.id},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),C(s),M(!1)}).catch(e=>{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"BookingConfirmation.jsx:46",message:"Error loading booking - redirecting to home",data:{errorMessage:null==e?void 0:e.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),h("/home")})):(fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"BookingConfirmation.jsx:53",message:"No booking and no transaction ref - redirecting to home",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),void h("/home"))}const t=((null==g?void 0:g.price)||150)*((null==x?void 0:x.length)||(null==j?void 0:j.length)||0)+5;n({bookingId:u.id,transactionId:u.id,items:(null==x?void 0:x.map((e,i)=>({item_id:e,item_name:`Seat ${e}`,price:(null==g?void 0:g.price)||150,quantity:1})))||[],origin:null==g?void 0:g.origin,destination:null==g?void 0:g.destination,date:null==g?void 0:g.date});const a=(null==(e=null==j?void 0:j[0])?void 0:e.email)||u.passenger_email;a&&u.id&&c.sendBookingConfirmation({bookingId:u.id,customerEmail:a,customerName:(null==(i=null==j?void 0:j[0])?void 0:i.fullName)||(null==(s=null==j?void 0:j[0])?void 0:s.name)||u.passenger_name||"Customer",origin:(null==g?void 0:g.origin)||u.origin||"Unknown",destination:(null==g?void 0:g.destination)||u.destination||"Unknown",departureTime:(null==g?void 0:g.departure_time)||u.departure_time||"",seats:x||u.seats||[],totalAmount:u.total_amount||u.total_price||t,bookingRef:u.booking_ref||u.id}).catch(e=>{});const r=setTimeout(()=>v(!0),100),l=setTimeout(()=>y(!1),4e3);return()=>{clearTimeout(r),clearTimeout(l)}},[u,h,g,x,j,m,C]);const I=()=>{navigator.clipboard.writeText(u.id),N(!0),setTimeout(()=>N(!1),2e3)};if(T)return t.jsx("div",{className:l.bookingScreen,children:t.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:t.jsx("p",{children:"Loading booking confirmation..."})})});if(!u)return null;const S=(null==j?void 0:j.length)||(null==x?void 0:x.length)||0;return t.jsxs("div",{className:l.bookingScreen,children:[f&&t.jsx("div",{className:l.confettiContainer,children:[...Array(50)].map((e,i)=>t.jsx("div",{className:l.confetti,style:{left:100*Math.random()+"%",animationDelay:3*Math.random()+"s",backgroundColor:["#F5A623","#1B4D4A","#22C55E","#3B82F6","#EC4899"][Math.floor(5*Math.random())]}},i))}),t.jsxs("div",{className:`${l.confirmationContent} ${k?l.loaded:""}`,children:[t.jsxs("div",{className:l.successAnimation,children:[t.jsx("div",{className:l.successCircle,children:t.jsx("div",{className:l.successIconWrapper,children:t.jsx("svg",{viewBox:"0 0 24 24",fill:"none",className:l.checkIcon,children:t.jsx("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:l.checkPath})})})}),t.jsx("div",{className:l.successRipple}),t.jsx("div",{className:l.successRipple,style:{animationDelay:"0.2s"}})]}),t.jsx("h1",{className:l.confirmationTitle,children:"Booking Confirmed!"}),t.jsx("p",{className:l.confirmationMessage,children:"Your journey is all set. A confirmation has been sent to your email."}),t.jsxs("div",{className:l.bookingRefCard,children:[t.jsxs("div",{className:l.bookingRefHeader,children:[t.jsx("span",{className:l.bookingRefLabel,children:"Booking Reference"}),t.jsx("button",{className:`${l.copyBtn} ${b?l.copied:""}`,onClick:I,children:b?t.jsxs(t.Fragment,{children:[t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:t.jsx("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Copied!"]}):t.jsxs(t.Fragment,{children:[t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5",stroke:"currentColor",strokeWidth:"2"})]}),"Copy"]})})]}),t.jsxs("div",{className:l.bookingRefNumber,children:["#",u.id]})]}),t.jsxs("div",{className:l.quickActions,children:[t.jsxs("button",{className:l.quickActionBtn,onClick:async()=>{const e={title:"GOGOBUS Booking Confirmation",text:`My trip from ${null==g?void 0:g.origin} to ${null==g?void 0:g.destination} on ${null==g?void 0:g.date}. Booking Ref: #${u.id}`,url:window.location.href};try{navigator.share?await navigator.share(e):I()}catch(i){}},children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("circle",{cx:"18",cy:"5",r:"3",stroke:"currentColor",strokeWidth:"2"}),t.jsx("circle",{cx:"6",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"}),t.jsx("circle",{cx:"18",cy:"19",r:"3",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M8.59 13.51L15.42 17.49M15.41 6.51L8.59 10.49",stroke:"currentColor",strokeWidth:"2"})]}),"Share"]}),t.jsxs("button",{className:l.quickActionBtn,onClick:()=>{var e,i;const s={title:`GOGOBUS: ${null==g?void 0:g.origin} → ${null==g?void 0:g.destination}`,start:null==g?void 0:g.date,details:`Booking Reference: ${u.id}\nSeats: ${null==x?void 0:x.join(", ")}`},o=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(s.title)}&dates=${null==(e=s.start)?void 0:e.replace(/-/g,"")}/${null==(i=s.start)?void 0:i.replace(/-/g,"")}&details=${encodeURIComponent(s.details)}`;window.open(o,"_blank")},children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M16 2V6M8 2V6M3 10H21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Calendar"]}),t.jsxs("button",{className:l.quickActionBtn,onClick:()=>window.print(),children:[t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("path",{d:"M6 9V2H18V9M6 18H4C2.89543 18 2 17.1046 2 16V11C2 9.89543 2.89543 9 4 9H20C21.1046 9 22 9.89543 22 11V16C22 17.1046 21.1046 18 20 18H18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("rect",{x:"6",y:"14",width:"12",height:"8",stroke:"currentColor",strokeWidth:"2"})]}),"Print"]})]}),t.jsx("div",{className:l.tabsContainer,children:t.jsxs("div",{className:l.tabs,children:[t.jsx("button",{className:`${l.tab} ${"details"===w?l.activeTab:""}`,onClick:()=>B("details"),children:"Trip Details"}),t.jsx("button",{className:`${l.tab} ${"qr"===w?l.activeTab:""}`,onClick:()=>B("qr"),children:"QR Ticket"})]})}),t.jsxs("div",{className:l.tabContent,children:["details"===w&&t.jsxs("div",{className:l.detailsTab,children:[t.jsxs("div",{className:l.journeyCard,children:[t.jsxs("div",{className:l.journeyHeader,children:[t.jsxs("div",{className:l.journeyBadge,children:[t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("rect",{x:"3",y:"6",width:"18",height:"12",rx:"2",fill:"currentColor"}),t.jsx("circle",{cx:"7",cy:"18",r:"2",fill:"currentColor"}),t.jsx("circle",{cx:"17",cy:"18",r:"2",fill:"currentColor"})]}),"Bus Journey"]}),t.jsx("span",{className:l.journeyDate,children:null==g?void 0:g.date})]}),t.jsxs("div",{className:l.journeyRoute,children:[t.jsxs("div",{className:l.journeyPoint,children:[t.jsx("div",{className:l.journeyDot,children:t.jsx("div",{className:l.dotInner})}),t.jsxs("div",{className:l.journeyLocation,children:[t.jsx("span",{className:l.locationName,children:null==g?void 0:g.origin}),t.jsx("span",{className:l.locationTime,children:(null==g?void 0:g.departureTime)||"06:00 AM"})]})]}),t.jsx("div",{className:l.journeyLine,children:t.jsxs("div",{className:l.journeyDuration,children:[t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M12 6V12L16 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(null==g?void 0:g.duration)||"4h 30m"]})}),t.jsxs("div",{className:l.journeyPoint,children:[t.jsx("div",{className:`${l.journeyDot} ${l.destination}`,children:t.jsx("div",{className:l.dotInner})}),t.jsxs("div",{className:l.journeyLocation,children:[t.jsx("span",{className:l.locationName,children:null==g?void 0:g.destination}),t.jsx("span",{className:l.locationTime,children:(null==g?void 0:g.arrivalTime)||"10:30 AM"})]})]})]})]}),t.jsxs("div",{className:l.infoCard,children:[t.jsxs("h3",{className:l.infoCardTitle,children:[t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("path",{d:"M4 18V14C4 13.4477 4.44772 13 5 13H7C7.55228 13 8 13.4477 8 14V18C8 18.5523 7.55228 19 7 19H5C4.44772 19 4 18.5523 4 18Z",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M4 9V6C4 5.44772 4.44772 5 5 5H7C7.55228 5 8 5.44772 8 6V9C8 9.55228 7.55228 10 7 10H5C4.44772 10 4 9.55228 4 9Z",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M16 18V14C16 13.4477 16.4477 13 17 13H19C19.5523 13 20 13.4477 20 14V18C20 18.5523 19.5523 19 19 19H17C16.4477 19 16 18.5523 16 18Z",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M16 9V6C16 5.44772 16.4477 5 17 5H19C19.5523 5 20 5.44772 20 6V9C20 9.55228 19.5523 10 19 10H17C16.4477 10 16 9.55228 16 9Z",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M10 18V14C10 13.4477 10.4477 13 11 13H13C13.5523 13 14 13.4477 14 14V18C14 18.5523 13.5523 19 13 19H11C10.4477 19 10 18.5523 10 18Z",stroke:"currentColor",strokeWidth:"2"})]}),"Seat Information"]}),t.jsx("div",{className:l.seatsDisplay,children:null==x?void 0:x.map((e,i)=>t.jsxs("div",{className:l.seatChip,children:[t.jsx("span",{className:l.seatNumber,children:e}),(null==j?void 0:j[i])&&t.jsx("span",{className:l.passengerName,children:j[i].name})]},e))})]}),t.jsxs("div",{className:l.infoCard,children:[t.jsxs("h3",{className:l.infoCardTitle,children:[t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M12 6V18M15 9.5C15 8.11929 13.6569 7 12 7C10.3431 7 9 8.11929 9 9.5C9 10.8807 10.3431 12 12 12C13.6569 12 15 13.1193 15 14.5C15 15.8807 13.6569 17 12 17C10.3431 17 9 15.8807 9 14.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Payment Summary"]}),t.jsxs("div",{className:l.priceSummaryList,children:[t.jsxs("div",{className:l.priceRow,children:[t.jsxs("span",{children:["Ticket Price × ",S]}),t.jsxs("span",{children:["P",((null==g?void 0:g.price)||150)*S]})]}),t.jsxs("div",{className:l.priceRow,children:[t.jsx("span",{children:"Booking Fee"}),t.jsx("span",{children:"P5"})]}),t.jsxs("div",{className:`${l.priceRow} ${l.totalRow}`,children:[t.jsx("span",{children:"Total Paid"}),t.jsxs("span",{className:l.totalPrice,children:["P",((null==g?void 0:g.price)||150)*S+5]})]})]})]})]}),"qr"===w&&t.jsx("div",{className:l.qrTab,children:t.jsxs("div",{className:l.qrCard,children:[t.jsx(r,{bookingId:u.id,route:g,seats:x}),t.jsx("p",{className:l.qrHint,children:"Show this QR code to the bus conductor when boarding"})]})})]}),t.jsxs("div",{className:l.confirmationActions,children:[t.jsxs(a,{onClick:()=>{h(`/tickets/${u.id}`)},variant:"outline",className:l.actionBtn,children:[t.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:t.jsx("path",{d:"M15 5V7M15 11V13M15 17V19M5 5C3.89543 5 3 5.89543 3 7V10C4.10457 10 5 10.8954 5 12C5 13.1046 4.10457 14 3 14V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V14C19.8954 14 19 13.1046 19 12C19 10.8954 19.8954 10 21 10V7C21 5.89543 20.1046 5 19 5H5Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"View Ticket"]}),t.jsxs(a,{onClick:()=>{p(),h("/home")},className:l.actionBtn,children:[t.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:t.jsx("path",{d:"M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Go Home"]})]}),t.jsxs("div",{className:l.helpSection,children:[t.jsx("p",{children:"Need help with your booking?"}),t.jsxs("a",{href:"tel:+26712345678",className:l.helpLink,children:[t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:t.jsx("path",{d:"M22 16.92V19.92C22 20.48 21.56 20.93 21 20.98C20.61 21.01 20.21 21.03 19.81 21.03C10.84 21.03 3.47 13.66 3.47 4.69C3.47 4.29 3.49 3.89 3.52 3.5C3.57 2.94 4.02 2.5 4.58 2.5H7.58C8.06 2.5 8.48 2.85 8.56 3.32C8.67 4.01 8.86 4.68 9.13 5.31C9.27 5.63 9.19 6 8.93 6.26L7.66 7.53C9.06 10.08 11.14 12.16 13.69 13.56L14.96 12.29C15.22 12.03 15.59 11.95 15.91 12.09C16.54 12.36 17.21 12.55 17.9 12.66C18.37 12.74 18.72 13.16 18.72 13.64V16.64C18.72 17.2 18.28 17.65 17.72 17.7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Contact Support"]})]})]})]})};export{h as default};
