import{u as e,i as s,c as n,m as i,r as t,j as a,b as o}from"./index-CHY3DGCF.js";import{p as r}from"./paymentService-BAxEcj2-.js";import{b as d}from"./bookingService-KwW7s8KF.js";import"./validation-DjNTQiWP.js";const l="_paymentPage_1g60n_6",c="_header_1g60n_13",h="_backBtn_1g60n_25",m="_headerTitle_1g60n_42",u="_secureIcon_1g60n_49",g="_content_1g60n_60",x="_tripSummary_1g60n_68",p="_tripHeader_1g60n_76",j="_tripRoute_1g60n_86",_="_routePoint_1g60n_92",v="_routeDot_1g60n_100",y="_destination_1g60n_108",k="_routeLine_1g60n_113",f="_tripDetails_1g60n_121",w="_tripDetail_1g60n_121",N="_section_1g60n_144",b="_sectionTitle_1g60n_148",M="_methodsList_1g60n_157",P="_methodCard_1g60n_163",S="_selected_1g60n_180",L="_methodRadio_1g60n_185",I="_methodIcon_1g60n_203",C="_brandLogos_1g60n_213",T="_providerLogo_1g60n_225",B="_methodInfo_1g60n_233",D="_methodName_1g60n_238",W="_methodDesc_1g60n_245",F="_methodFee_1g60n_250",$="_priceCard_1g60n_261",O="_priceRow_1g60n_268",A="_total_1g60n_277",R="_priceDivider_1g60n_283",E="_securityBadge_1g60n_291",V="_securityText_1g60n_307",G="_errorMessage_1g60n_325",H="_payButton_1g60n_338",U="_spinner_1g60n_371",J="_terms_1g60n_382",z=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),a.jsx("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]}),Z=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",ry:"2"}),a.jsx("path",{d:"M9 22v-4h6v4"}),a.jsx("path",{d:"M8 6h.01M16 6h.01M12 6h.01M12 10h.01M12 14h.01M16 10h.01M16 14h.01M8 10h.01M8 14h.01"})]}),Y=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2"}),a.jsx("circle",{cx:"12",cy:"12",r:"2"}),a.jsx("path",{d:"M6 12h.01M18 12h.01"})]}),q=()=>a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M20 6 9 17l-5-5"})}),K=()=>a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),a.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),Q=()=>a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"m12 19-7-7 7-7"}),a.jsx("path",{d:"M19 12H5"})]}),X=()=>a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M8 6v6m8-6v6M5 18v2m14-2v2M3 6h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6ZM3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2"}),a.jsx("circle",{cx:"7",cy:"15",r:"1"}),a.jsx("circle",{cx:"17",cy:"15",r:"1"})]}),ee=()=>a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),a.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),a.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),se=()=>a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),a.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),ne=()=>a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),a.jsx("path",{d:"M13 5v2"}),a.jsx("path",{d:"M13 17v2"}),a.jsx("path",{d:"M13 11v2"})]}),ie=()=>a.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),a.jsx("path",{d:"m9 12 2 2 4-4"})]}),te=()=>a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:U,children:a.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),ae={card:()=>a.jsxs("div",{className:C,children:[a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/120px-Visa_Inc._logo.svg.png",alt:"Visa"}),a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/120px-Mastercard-logo.svg.png",alt:"Mastercard"})]}),orange:()=>a.jsx("div",{className:T,style:{background:"#FF6600"},children:a.jsx("span",{style:{color:"white",fontWeight:700},children:"Orange"})}),myzaka:()=>a.jsx("div",{className:T,style:{background:"#00A651"},children:a.jsx("span",{style:{color:"white",fontWeight:700},children:"MyZaka"})}),smega:()=>a.jsx("div",{className:T,style:{background:"#003366"},children:a.jsx("span",{style:{color:"white",fontWeight:700},children:"Smega"})}),bank:()=>a.jsx(Z,{}),cash:()=>a.jsx(Y,{})};function oe(){var C;const T=e();s();const{user:U}=n(),{booking:Z,selectedRoute:Y,selectedSeats:oe,passengerDetails:re}=i(),[de,le]=t.useState("card"),[ce,he]=t.useState(!1),[me,ue]=t.useState(null),[ge,xe]=t.useState([]),[pe,je]=t.useState(null),_e=((null==Y?void 0:Y.price)||150)*((null==oe?void 0:oe.length)||1),ve=Math.round(.05*_e*100)/100,ye=Z||{tripId:(null==Y?void 0:Y.id)||"mock-trip-id",route:Y||{origin:"Gaborone",destination:"Maun",departureTime:new Date(Date.now()+864e5).toISOString()},seats:oe||["2A"],passenger:re&&re[0]||{name:(null==(C=null==U?void 0:U.user_metadata)?void 0:C.full_name)||"Guest",phone:"+267 71 234 567",email:(null==U?void 0:U.email)||"guest@example.com"},basePrice:_e,serviceFee:ve},ke=e=>{const s=r.calculateTotal(ye.basePrice,ye.serviceFee,e);je(s)};t.useEffect(()=>{const e=r.getEnabledPaymentMethods();xe(e),ye.basePrice&&ye.serviceFee&&ke("card")},[ye.basePrice,ye.serviceFee]);const fe=e=>`P${e.toFixed(2)}`;return t.useEffect(()=>{if(!Y||!oe||0===oe.length){const e=setTimeout(()=>{T("/booking/summary")},500);return()=>clearTimeout(e)}},[Y,oe,T]),Y&&oe&&0!==oe.length?a.jsxs("div",{className:l,children:[a.jsxs("header",{className:c,children:[a.jsx("button",{className:h,onClick:()=>T(-1),children:a.jsx(Q,{})}),a.jsx("h1",{className:m,children:"Payment"}),a.jsxs("div",{className:u,children:[a.jsx(K,{}),a.jsx("span",{children:"Secure"})]})]}),a.jsxs("div",{className:g,children:[a.jsxs("div",{className:x,children:[a.jsxs("div",{className:p,children:[a.jsx(X,{}),a.jsx("span",{children:"Trip Summary"})]}),a.jsxs("div",{className:j,children:[a.jsxs("div",{className:_,children:[a.jsx("div",{className:v}),a.jsx("span",{children:(null==Y?void 0:Y.origin)||ye.route.origin})]}),a.jsx("div",{className:k}),a.jsxs("div",{className:_,children:[a.jsx("div",{className:`${v} ${y}`}),a.jsx("span",{children:(null==Y?void 0:Y.destination)||ye.route.destination})]})]}),a.jsxs("div",{className:f,children:[((null==Y?void 0:Y.departure_time)||ye.route.departureTime)&&a.jsxs("div",{className:w,children:[a.jsx(ee,{}),a.jsx("span",{children:(null==Y?void 0:Y.departure_time)||(we=ye.route.departureTime,new Date(we).toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}))})]}),ye.passenger&&a.jsxs("div",{className:w,children:[a.jsx(se,{}),a.jsx("span",{children:ye.passenger.name||ye.passenger.full_name})]}),a.jsxs("div",{className:w,children:[a.jsx(ne,{}),a.jsxs("span",{children:["Seat ",ye.seats.join(", ")]})]})]})]}),a.jsxs("div",{className:N,children:[a.jsx("h2",{className:b,children:"Select Payment Method"}),a.jsx("div",{className:M,children:ge.map(e=>a.jsxs("div",{className:`${P} ${de===e.id?S:""}`,onClick:()=>{return s=e.id,le(s),ke(s),void ue(null);var s},children:[a.jsx("div",{className:L,children:de===e.id&&a.jsx(q,{})}),a.jsx("div",{className:I,children:ae[e.icon]?ae[e.icon]():a.jsx(z,{})}),a.jsxs("div",{className:B,children:[a.jsx("div",{className:D,children:e.name}),a.jsx("div",{className:W,children:e.description})]}),e.fees.value>0&&a.jsx("div",{className:F,children:"percentage"===e.fees.type?`${e.fees.value}% fee`:`P${e.fees.value} fee`})]},e.id))})]}),pe&&a.jsxs("div",{className:N,children:[a.jsx("h2",{className:b,children:"Price Breakdown"}),a.jsxs("div",{className:$,children:[a.jsxs("div",{className:O,children:[a.jsx("span",{children:"Ticket Price"}),a.jsx("span",{children:fe(pe.baseAmount)})]}),a.jsxs("div",{className:O,children:[a.jsx("span",{children:"Service Fee"}),a.jsx("span",{children:fe(pe.serviceFee)})]}),pe.paymentFee>0&&a.jsxs("div",{className:O,children:[a.jsx("span",{children:"Payment Fee"}),a.jsx("span",{children:fe(pe.paymentFee)})]}),a.jsx("div",{className:R}),a.jsxs("div",{className:`${O} ${A}`,children:[a.jsx("span",{children:"Total"}),a.jsx("span",{children:fe(pe.total)})]})]})]}),a.jsxs("div",{className:E,children:[a.jsx(ie,{}),a.jsxs("div",{className:V,children:[a.jsx("strong",{children:"Secure Payment"}),a.jsx("span",{children:"Your payment is protected with 256-bit SSL encryption"})]})]}),me&&a.jsx("div",{className:G,children:me}),a.jsx("button",{className:H,onClick:async()=>{var e;he(!0),ue(null);try{fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:174",message:"handlePayment called",data:{hasBooking:!!Z,selectedRouteId:null==Y?void 0:Y.id,userId:null==U?void 0:U.id,selectedSeats:oe,passengerDetailsLength:null==re?void 0:re.length,selectedMethod:de,amount:null==pe?void 0:pe.total},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});let s=null==Z?void 0:Z.id;if(!s&&(null==Y?void 0:Y.id)&&(null==U?void 0:U.id)&&(null==oe?void 0:oe.length)>0&&(null==re?void 0:re.length)>0){fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:180",message:"Creating booking before payment",data:{scheduleId:Y.id,userId:U.id,seatsCount:oe.length,passengersCount:re.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});const e=re[0],n={schedule_id:Y.id,user_id:U.id,seats:oe,passengers:re,total_amount:pe.total,passenger_name:(null==e?void 0:e.fullName)||(null==e?void 0:e.name)||"Guest",passenger_email:(null==e?void 0:e.email)||(null==U?void 0:U.email)||"",passenger_phone:(null==e?void 0:e.phone)||"",origin:Y.origin,destination:Y.destination,departure_time:Y.departure_time,payment_status:"unpaid",status:"pending"},i=await d.createBooking(n);s=i.id,fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:200",message:"Booking created successfully",data:{bookingId:s,bookingRef:i.booking_ref},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{})}if(!s)throw new Error("Unable to create booking. Please try again.");const n=ye.passenger||(null==re?void 0:re[0])||{},i={bookingId:s,amount:pe.total,paymentMethod:de,customerName:n.name||n.fullName||n.full_name||(null==(e=null==U?void 0:U.user_metadata)?void 0:e.full_name)||"Guest",customerEmail:n.email||(null==U?void 0:U.email)||"",customerPhone:n.phone||n.phone_number||"",description:`GOGOBUS: ${(null==Y?void 0:Y.origin)||ye.route.origin} â†’ ${(null==Y?void 0:Y.destination)||ye.route.destination}`};fetch("http://127.0.0.1:7244/ingest/c4c33fba-1ee4-4b2f-aa1a-ed506c7c702f",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"Payment.jsx:212",message:"Initiating payment with bookingId",data:{bookingId:i.bookingId,amount:i.amount,paymentMethod:i.paymentMethod},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});const t=await r.initiatePayment(i);if(!t.success)throw new Error(t.error);"manual"===r.PAYMENT_METHODS[de.toUpperCase()].provider?T(`/booking/confirmation?ref=${t.transactionRef}&method=${de}`):t.paymentUrl?window.location.href=t.paymentUrl:T(`/booking/confirmation?ref=${t.transactionRef}`)}catch(s){o("Payment error",s),ue(s.message||"Payment failed. Please try again.")}finally{he(!1)}},disabled:ce,children:ce?a.jsxs(a.Fragment,{children:[a.jsx(te,{}),"Processing..."]}):a.jsxs(a.Fragment,{children:[a.jsx(K,{}),"Pay ",pe?fe(pe.total):""]})}),a.jsxs("p",{className:J,children:["By proceeding, you agree to our"," ",a.jsx("a",{href:"/terms",children:"Terms of Service"})," and"," ",a.jsx("a",{href:"/privacy",children:"Privacy Policy"})]})]})]}):a.jsx("div",{className:l,children:a.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[a.jsx("p",{children:"Loading payment information..."}),a.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9rem",color:"#666"},children:"Redirecting to booking summary..."})]})});var we}export{oe as default};
