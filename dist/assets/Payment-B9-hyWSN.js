import{u as e,i as s,c as i,m as n,r,j as t,b as a}from"./index-BKhXCF24.js";import{p as o}from"./paymentService-cJvjjQSk.js";import{b as l}from"./bookingService-Dkbri9jD.js";import"./validation-DjNTQiWP.js";const d="_paymentPage_1g60n_6",c="_header_1g60n_13",h="_backBtn_1g60n_25",x="_headerTitle_1g60n_42",m="_secureIcon_1g60n_49",u="_content_1g60n_60",g="_tripSummary_1g60n_68",j="_tripHeader_1g60n_76",_="_tripRoute_1g60n_86",v="_routePoint_1g60n_92",p="_routeDot_1g60n_100",k="_destination_1g60n_108",y="_routeLine_1g60n_113",f="_tripDetails_1g60n_121",w="_tripDetail_1g60n_121",N="_section_1g60n_144",M="_sectionTitle_1g60n_148",b="_methodsList_1g60n_157",L="_methodCard_1g60n_163",P="_selected_1g60n_180",S="_methodRadio_1g60n_185",B="_methodIcon_1g60n_203",C="_brandLogos_1g60n_213",T="_providerLogo_1g60n_225",W="_methodInfo_1g60n_233",F="_methodName_1g60n_238",$="_methodDesc_1g60n_245",D="_methodFee_1g60n_250",E="_priceCard_1g60n_261",I="_priceRow_1g60n_268",R="_total_1g60n_277",V="_priceDivider_1g60n_283",G="_securityBadge_1g60n_291",H="_securityText_1g60n_307",A="_errorMessage_1g60n_325",O="_payButton_1g60n_338",U="_spinner_1g60n_371",z="_terms_1g60n_382",Z=()=>t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),t.jsx("line",{x1:"1",y1:"10",x2:"23",y2:"10"})]}),Y=()=>t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",ry:"2"}),t.jsx("path",{d:"M9 22v-4h6v4"}),t.jsx("path",{d:"M8 6h.01M16 6h.01M12 6h.01M12 10h.01M12 14h.01M16 10h.01M16 14h.01M8 10h.01M8 14h.01"})]}),q=()=>t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2"}),t.jsx("circle",{cx:"12",cy:"12",r:"2"}),t.jsx("path",{d:"M6 12h.01M18 12h.01"})]}),J=()=>t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M20 6 9 17l-5-5"})}),K=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),t.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),Q=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"m12 19-7-7 7-7"}),t.jsx("path",{d:"M19 12H5"})]}),X=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M8 6v6m8-6v6M5 18v2m14-2v2M3 6h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6ZM3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2"}),t.jsx("circle",{cx:"7",cy:"15",r:"1"}),t.jsx("circle",{cx:"17",cy:"15",r:"1"})]}),ee=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),t.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),t.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),t.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),se=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),t.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),ie=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),t.jsx("path",{d:"M13 5v2"}),t.jsx("path",{d:"M13 17v2"}),t.jsx("path",{d:"M13 11v2"})]}),ne=()=>t.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),t.jsx("path",{d:"m9 12 2 2 4-4"})]}),re=()=>t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:U,children:t.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),te={card:()=>t.jsxs("div",{className:C,children:[t.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/120px-Visa_Inc._logo.svg.png",alt:"Visa"}),t.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/120px-Mastercard-logo.svg.png",alt:"Mastercard"})]}),orange:()=>t.jsx("div",{className:T,style:{background:"#FF6600"},children:t.jsx("span",{style:{color:"white",fontWeight:700},children:"Orange"})}),myzaka:()=>t.jsx("div",{className:T,style:{background:"#00A651"},children:t.jsx("span",{style:{color:"white",fontWeight:700},children:"MyZaka"})}),smega:()=>t.jsx("div",{className:T,style:{background:"#003366"},children:t.jsx("span",{style:{color:"white",fontWeight:700},children:"Smega"})}),bank:()=>t.jsx(Y,{}),cash:()=>t.jsx(q,{})};function ae(){var C;const T=e();s();const{user:U}=i(),{booking:Y,selectedRoute:q,selectedSeats:ae,passengerDetails:oe}=n(),[le,de]=r.useState("card"),[ce,he]=r.useState(!1),[xe,me]=r.useState(null),[ue,ge]=r.useState([]),[je,_e]=r.useState(null),ve=((null==q?void 0:q.price)||150)*((null==ae?void 0:ae.length)||1),pe=Math.round(.05*ve*100)/100,ke=Y||{tripId:(null==q?void 0:q.id)||"mock-trip-id",route:q||{origin:"Gaborone",destination:"Maun",departureTime:new Date(Date.now()+864e5).toISOString()},seats:ae||["2A"],passenger:oe&&oe[0]||{name:(null==(C=null==U?void 0:U.user_metadata)?void 0:C.full_name)||"Guest",phone:"+267 71 234 567",email:(null==U?void 0:U.email)||"guest@example.com"},basePrice:ve,serviceFee:pe},ye=e=>{const s=o.calculateTotal(ke.basePrice,ke.serviceFee,e);_e(s)};r.useEffect(()=>{const e=o.getEnabledPaymentMethods();ge(e),ke.basePrice&&ke.serviceFee&&ye("card")},[ke.basePrice,ke.serviceFee]);const fe=e=>`P${e.toFixed(2)}`;return r.useEffect(()=>{if(!q||!ae||0===ae.length){const e=setTimeout(()=>{T("/booking/summary")},500);return()=>clearTimeout(e)}},[q,ae,T]),q&&ae&&0!==ae.length?t.jsxs("div",{className:d,children:[t.jsxs("header",{className:c,children:[t.jsx("button",{className:h,onClick:()=>T(-1),children:t.jsx(Q,{})}),t.jsx("h1",{className:x,children:"Payment"}),t.jsxs("div",{className:m,children:[t.jsx(K,{}),t.jsx("span",{children:"Secure"})]})]}),t.jsxs("div",{className:u,children:[t.jsxs("div",{className:g,children:[t.jsxs("div",{className:j,children:[t.jsx(X,{}),t.jsx("span",{children:"Trip Summary"})]}),t.jsxs("div",{className:_,children:[t.jsxs("div",{className:v,children:[t.jsx("div",{className:p}),t.jsx("span",{children:(null==q?void 0:q.origin)||ke.route.origin})]}),t.jsx("div",{className:y}),t.jsxs("div",{className:v,children:[t.jsx("div",{className:`${p} ${k}`}),t.jsx("span",{children:(null==q?void 0:q.destination)||ke.route.destination})]})]}),t.jsxs("div",{className:f,children:[((null==q?void 0:q.departure_time)||ke.route.departureTime)&&t.jsxs("div",{className:w,children:[t.jsx(ee,{}),t.jsx("span",{children:(null==q?void 0:q.departure_time)||(we=ke.route.departureTime,new Date(we).toLocaleDateString("en-BW",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}))})]}),ke.passenger&&t.jsxs("div",{className:w,children:[t.jsx(se,{}),t.jsx("span",{children:ke.passenger.name||ke.passenger.full_name})]}),t.jsxs("div",{className:w,children:[t.jsx(ie,{}),t.jsxs("span",{children:["Seat ",ke.seats.join(", ")]})]})]})]}),t.jsxs("div",{className:N,children:[t.jsx("h2",{className:M,children:"Select Payment Method"}),t.jsx("div",{className:b,children:ue.map(e=>t.jsxs("div",{className:`${L} ${le===e.id?P:""}`,onClick:()=>{return s=e.id,de(s),ye(s),void me(null);var s},children:[t.jsx("div",{className:S,children:le===e.id&&t.jsx(J,{})}),t.jsx("div",{className:B,children:te[e.icon]?te[e.icon]():t.jsx(Z,{})}),t.jsxs("div",{className:W,children:[t.jsx("div",{className:F,children:e.name}),t.jsx("div",{className:$,children:e.description})]}),e.fees.value>0&&t.jsx("div",{className:D,children:"percentage"===e.fees.type?`${e.fees.value}% fee`:`P${e.fees.value} fee`})]},e.id))})]}),je&&t.jsxs("div",{className:N,children:[t.jsx("h2",{className:M,children:"Price Breakdown"}),t.jsxs("div",{className:E,children:[t.jsxs("div",{className:I,children:[t.jsx("span",{children:"Ticket Price"}),t.jsx("span",{children:fe(je.baseAmount)})]}),t.jsxs("div",{className:I,children:[t.jsx("span",{children:"Service Fee"}),t.jsx("span",{children:fe(je.serviceFee)})]}),je.paymentFee>0&&t.jsxs("div",{className:I,children:[t.jsx("span",{children:"Payment Fee"}),t.jsx("span",{children:fe(je.paymentFee)})]}),t.jsx("div",{className:V}),t.jsxs("div",{className:`${I} ${R}`,children:[t.jsx("span",{children:"Total"}),t.jsx("span",{children:fe(je.total)})]})]})]}),t.jsxs("div",{className:G,children:[t.jsx(ne,{}),t.jsxs("div",{className:H,children:[t.jsx("strong",{children:"Secure Payment"}),t.jsx("span",{children:"Your payment is protected with 256-bit SSL encryption"})]})]}),xe&&t.jsx("div",{className:A,children:xe}),t.jsx("button",{className:O,onClick:async()=>{var e;he(!0),me(null);try{let s=null==Y?void 0:Y.id;if(!s&&(null==q?void 0:q.id)&&(null==U?void 0:U.id)&&(null==ae?void 0:ae.length)>0&&(null==oe?void 0:oe.length)>0){const e=oe[0],i={schedule_id:q.id,user_id:U.id,seats:ae,passengers:oe,total_amount:je.total,passenger_name:(null==e?void 0:e.fullName)||(null==e?void 0:e.name)||"Guest",passenger_email:(null==e?void 0:e.email)||(null==U?void 0:U.email)||"",passenger_phone:(null==e?void 0:e.phone)||"",origin:q.origin,destination:q.destination,departure_time:q.departure_time,payment_status:"unpaid",status:"pending"};s=(await l.createBooking(i)).id}if(!s)throw new Error("Unable to create booking. Please try again.");const i=ke.passenger||(null==oe?void 0:oe[0])||{},n={bookingId:s,amount:je.total,paymentMethod:le,customerName:i.name||i.fullName||i.full_name||(null==(e=null==U?void 0:U.user_metadata)?void 0:e.full_name)||"Guest",customerEmail:i.email||(null==U?void 0:U.email)||"",customerPhone:i.phone||i.phone_number||"",description:`GOGOBUS: ${(null==q?void 0:q.origin)||ke.route.origin} â†’ ${(null==q?void 0:q.destination)||ke.route.destination}`},r=await o.initiatePayment(n);if(!r.success)throw new Error(r.error);"manual"===o.PAYMENT_METHODS[le.toUpperCase()].provider?T(`/booking/confirmation?ref=${r.transactionRef}&method=${le}`):r.paymentUrl?window.location.href=r.paymentUrl:T(`/booking/confirmation?ref=${r.transactionRef}`)}catch(s){a("Payment error",s),me(s.message||"Payment failed. Please try again.")}finally{he(!1)}},disabled:ce,children:ce?t.jsxs(t.Fragment,{children:[t.jsx(re,{}),"Processing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(K,{}),"Pay ",je?fe(je.total):""]})}),t.jsxs("p",{className:z,children:["By proceeding, you agree to our"," ",t.jsx("a",{href:"/terms",children:"Terms of Service"})," and"," ",t.jsx("a",{href:"/privacy",children:"Privacy Policy"})]})]})]}):t.jsx("div",{className:d,children:t.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[t.jsx("p",{children:"Loading payment information..."}),t.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9rem",color:"#666"},children:"Redirecting to booking summary..."})]})});var we}export{ae as default};
